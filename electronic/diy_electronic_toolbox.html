
<!DOCTYPE html>
<html lang="fr">
	<head>
	  <meta name="Electronic DIY toolbox" content="Electronic DIY toolbox"/>
	  <meta charset="utf-8" />
	  <title>Electronic DIY toolbox</title>
	  <style>
	    body{
		background-color:#E5E8D4;
		font-family:sans-serif;
	    }
	    article{
	      display:inline-block;
	    }
	    #corps{
		display:inline-block;
		text-align:center;
		width:100%;
	    }
	    .app{
			display:none;
			width:80%;
			position:absolute;
			left:2%;
		}
	    .app ul{
	      text-align:left;
	    }
	    app header h3{
	      text-align:center;
	      background-color:rgba(173,173,173,0.25);
	      font-size:small;
	      
	      margin:0;
	    }
	    #titre{
	      position : relative;
	      top:0;
	      left:0;
	      width:100%;
	    }
	    .cadre{
		display:inline-block;
		text-align:center;
	    }
	    /* Block de calcul des combinaisons de resistance */
	    .stock{
	    }
	    .formule{
		width: 40%;
	    }
	    .valeur{
		width: 10%;
	    }
	    footer {
		position:fixed;
		top:97%;
		bottom:auto;
		font-size: small;
		color: #7F7F7F;
		background-color:black;
		width:100%;
	    }
	    footer:hover {
		bottom:0;
		top:auto;
		}
	    footer div{
		display:inline-block;
		margin-left:2vw;
		width:47%;
	    }
	    footer a{
	      font-size: 1em;
	      color:green;
	      padding:0.5em;
	      margin:0.5em;
	      border:2px solid green;
	    }
	    footer a:hover{
	      color:#90EE90;
	      border:2px solid #90EE90;
	    }
	    footer ul{
	      list-style:none;text-align:right;
	    }
	    footer ul li {
	      margin-top:1.5em;
	    }
	    .block_stock {
	      position:relative;
	      display:inline-block;
	    }
	    .block_stock .title{
	      
	      left:20%;
	    }
	    .block_stock input{
	      width:99%;
	    }
	    .block_form0 .title{
	      left:10%;
	      text-align:left;
	    }
	    .block_form0 .view{
	      position:relative;
	      left:20%;
	    }
	    .block_form0 input{
	      margin:0;
	      padding:0;
	    }
	    .block_form1 {
	      position:relative;
	      text-align:left;
	    }
	    
	    .block_form1 button{
	      position:absolute;
	      left:60%;
	    }
	    .block_form1 input{
	      position:absolute;
	      left:60%;
	      width:10em;
	    }
	    .block_form2 {
	      position:relative;
	      left:10%;
	      text-align:left;
	      color:#2D2D2D;
	    }
	    .block_form2 input{
	      position:relative;
	      width:16em;
	    }
	    /*Les boutons */
	    button{
	      border: 1.5px solid gray;
	      background-color:white;
	      cursor:default;
	      min-width:1.75em;
	    }
	    button:active{
	      transform: translate(-5px,0px);
	      -webkit-transform: translate(-5px,0px);
	      -ms-transform: translate(-5px,0px);
	    }
	    button:hover{
	      border: 1.5px solid black;
	      background-color:#40FF40;
	      cursor:pointer;
	    }
	    .button_waiting{
	      cursor:wait !important;
	      background-color:gray;
	    }
	    .button_hidden{
	      display:none;
	    }
	    .button_deprecated{
	      background-color:gray;
	      border: 1.5px solid black;
	      color:white;
	    }
	    .button_deprecated:hover{
	      border: 1.5px solid black;
	      background-color:red;
	      cursor:pointer;
	    }
	    .button_disabled{
	      background-color:gray;
	      border: 1.5px solid gray;
	      opacity:0.1;
	    }
	    .button_disabled:hover{
	      background-color:gray;
	    }
	    .button_waiting:hover{
	      cursor:wait !important;
	      background-color:gray;
	    }
	   /* Block de déchiffrage d'une résistance */
	    .resistor_block {
	      display:inline;
	      border-bottom:1px solid black;
	      text-align:left;
	      width:100%;
	      display:none;
	    }
	    
	    #resistor_settings {
	      display:inline-block;
	      padding:0.2em;
	      max-width:40em;
	      text-align:left;
	    }
	    #resistor_settings .cei_color_list{
			text-align:center;
	    }
	    .resistor_prop_title{
	      list-style-type: none;
	      padding-left:0.5em;
	      padding-right:0.5em;
	      border: none;
	      font-weight:bold;
	      font-size:small;
	      text-align:center;
	    }
	    .cei_color_block {  
	      display: block;
	      margin: 0;
	      padding: 0;
	      float:left;
	      }
	    .cei_color_block ul{
		  display: inline-block;
		  margin: 0;
	      padding: 0;
	      float:left;
		}	
	    .cei_color_block li{  
	      list-style-type: none;
	      border : 1px solid black;
	      margin: 1.5px;
	      min-width:1.2em;
	      text-align:center;
	      font-size:small;
	     
	      cursor:pointer;
	      opacity:0.7;}
	      
	    .cei_color_block li:hover {
	      opacity:1;
	    }
	    .cei_color_list {  
	      display: inline-block;
	      margin: 0;
	      padding: 0;
	      float:left;}
	    .cei_color_list li {
	      list-style-type: none;
	      border : 1px solid black;
	      margin: 2px;
	      min-width:1.5em;
	      text-align:center;
	      font-size:small;
	      border-radius: 0.2em;
	      cursor:pointer;
	      opacity:0.7;
	    }
	    .cei_color_list li:hover {
	      opacity:1;
	    }
	    .font-small li{
	      font-size:x-small;
	      padding:0.1em;
	    }
	    .resistor_mode_list {  
	      border-bottom : 1px solid black;
	      display: inline;
	      margin: 0;
	      padding: 0;
	      float:left;
	      list-style-type: none;
	      text-align:left;
	      width:100%;}
	    .resistor_mode_list li:hover {
			opacity:1;
		}
	    .resistor_mode_list .active,#pow .active{
	      opacity:1;
	      font-weight:bold;
	      border : 3px solid #4D4D4D;
		}
		.resistor_mode_list .title{
	      border : none;
		}
	    .resistor_mode_list li {
	      list-style-type: none;
	      display: inline-block;
	      padding-left:0.25em;
	      padding-right:0.25em;
	      text-align:center;
	      font-size:small;
	      border : 1px solid grey;
	      cursor:pointer;
	      min-width:1em;
	      opacity:0.7;
	    }
	    .cei_color_Black{  background-color: black ; color: white; border:  1px solid black; -moz-user-select: none;}
	    .cei_color_Brown{  background-color: brown ; border:  1px solid black;-moz-user-select: none;}
	    .cei_color_Red{  background-color: red; border:  1px solid black;-moz-user-select: none;}
	    .cei_color_Orange{ background-color: #FF7000; border:  1px solid black; -moz-user-select: none;}
	    .cei_color_Yellow{  background-color: yellow; border:  1px solid black; -moz-user-select: none;}
	    .cei_color_Green{ background-color: green; color: white;border:  1px solid black; -moz-user-select: none;}
	    .cei_color_Blue{ background-color: blue; color: white;border:  1px solid black; -moz-user-select: none;}
	    .cei_color_Violet{  background-color:  violet; border:  1px solid black; -moz-user-select: none;}
	    .cei_color_Gray{  background-color: gray; border:  1px solid black; -moz-user-select: none;}
	    .cei_color_White{  background-color: white; border:  1px solid black; -moz-user-select: none;}
	    .cei_color_Gold{  background-color: gold; border:  1px solid black; -moz-user-select: none;}
	    .cei_color_Silver{  background-color: silver; border:  1px solid black;  -moz-user-select: none;}
	    .cei_color_None{  background-color: rgba(0,0,0,0.0); border:  1px solid rgba(0,0,0,0); -moz-user-select: none; }
	    .cei_color_Transparent{  background-color: rgba(175,175,175,0.2); border:  1px solid rgba(175,175,175,0.1) ; -moz-user-select: none; }
	    .cei_color_Beige{  background-color:  #FFFFAD ; -moz-user-select: none;}
	    .cei_color_Cyan{  background-color: #1E90FF; -moz-user-select: none;}
	    .cei_color_Pink{  background-color:  #FF778F ; -moz-user-select: none;}
	    .cei_color_CapGreen{  background-color:  #90EE90 ; -moz-user-select: none;}
	    
	    .resistor_blink_val{ display:inline-block;border: 2px solid rgba(0,255,0,0.9) ; -moz-user-select: none; }
	    .resistor_blink_val_hidden{ display:inline-block;border: 2px solid rgba(255,255,0,0) ; -moz-user-select: none; }
	    
	    .resistor_value_title{
	      padding:0.5em;
	    }
	    .resistor_value_selector{
	      opacity:0.7;
	      display:inline-block;
	      float:left;
	      border: 2px solid #DCDFCC;
	    }
	    .resistor_value_selector:hover{
	      opacity:1;
	      border: 2px solid black;
	    }
	    .resistor_value_selector_hightlight{
	      opacity:1;
	      display:inline-block;
	      float:left;
	    }
	    #value1,#value2,#value3,#pow{
	      display:inline-block;
	    }
	    #pow{
	      max-width:6em;
	      display: inline;
	      float:left;	      
	    }
	    #pow li{
	      padding:0;
	      margin:0;
	      list-style-type: none;
	      border-color:white;
	      border-bottom:1px solid black;
	      background-color:white;
	      display: inline-block;
	      text-align:center;
	      font-size:small;
	      cursor:pointer;
	      opacity:0.7;
	    }
	    /*Image/aperçue de la résistance*/
	    #resistor_value,#_cms_resistor_value,#bobine_resistor_value{
	      min-width:4em;
	      max-width:10em;
	    }
	    .resistor_view_canvas{
	      display:inline-block;
	      text-align:center;
	      border: 1px dashed gray;
	      background-color:rgba(255,255,255,0.25);
	    }
	    .resistor_view_canvas_resistor_small{
	      border: 1px dashed gray;
	      background-color:rgba(255,255,255,0.25);
	      margin:0.5em;
	      padding:0em;
	    }
	    .resistor_view_canvas_item{
	      margin-top:0.5em;
	      margin-bottom:0.5em;
	      padding:0;
	      margin-left:0;
	      margin-right:0;
	      display:inline-block;
	    }
	     .resistor_view_canvas_resistor_small .resistor_view{
	      color:red;
	      margin-top:1em;
	    }
	    .resistor_view_canvas input{
	      background-color:rgba(255,255,255,0);
	      border:none;
	    }
	    .resistor_view{
	      border:2px solid black;
	      box-shadow: 2px 2px 5px #888888;
	      border-radius:0.25em;
	    }
	    .bobine_resistor_view{
	      border:2px solid yellow;
	      box-shadow: 2px 2px 5px #888888;
	    }
	    .eletrolytic_pkg_view_round{
	      border-radius:10em;
	      margin:0;
	      padding:0;
	    }
	    .eletrolytic_pkg_view_cylinder input {
	      font-size:0.5em;
	      margin-top:1em;
	      margin-bottom:1em;
	      padding:0;
	      border:none;
	    }
	    .eletrolytic_pkg_view_cylinder{
	      border-radius:10em;
	      margin:0;
	      padding:0;
	      box-shadow: 5px 1px 5px rgba(136,136,136,0.5);
	    }
	    .cms_pkg_view{
	      box-shadow: 2px 2px 5px rgba(136,136,136,0.5);
	    }
	    .plastic_pkg_view{
	      box-shadow: 2px 2px 5px #888888;
	    }
	    .cms_pkg_view .relief_right{
	      border-bottom:3px solid #4D4D4D;
	      border-top:2px solid #E5E5E5;
	      border-right:2px solid #E5E5E5;
	    }
	    .cms_pkg_view .relief_left{
	      border-bottom:3px solid #4D4D4D;
	      border-top:2px solid #E5E5E5;
	      border-left:2px solid #E5E5E5;
	    }
	    .cms_pkg_view .relief{
	      border-top:3px solid black;
	      box-shadow: 2px 2px 5px #888888;
	    }
	    .cms_pkg_view input{
	      font-size:0.5em;
	    }
	    .resistor_small{
	      font-size:x-small;
	    }
	    .resistor_inline{
	      display:inline-block;
	    }
	    /* Block de visualisation du stock*/
	  #stock_view_resistor, #stock_view_capacitor {
		    left:0;
		    overflow:auto;
		    text-align:left;
		    padding-top:0.25em;
		    padding-bottom:0.25em;
	  }
	   #stock_view_resistor .div_button , #stock_view_capacitor.div_button{
		   opacity:0;
		   display:block;
	   }
	   #stock_view_resistor .div_article:hover, #stock_view_capacitor .div_article:hover{
	    background-color:white;
	   }
	    #stock_view_resistor .div_article:hover .div_button,
	    #stock_view_capacitor .div_article:hover .div_button {
		    opacity:1;
	    }
	    #stock_view_resistor .div_article .div_button button
	    #stock_view_capacitor .div_article .div_button button{
		    margin:0px;
		    padding:0px;
		    display:inline;
		    opacity:0.7;
		    position:relative;
	    }
	    #stock_view_resistor .div_article .div_button button:hover,
	    #stock_view_capacitor .div_article .div_button button{
		    opacity:1;
	    }
	    @media screen and (min-width: 1320px) {
	        #stock_view_resistor .resistor_view_canvas{
		       font-size:small;
			}
			#stock_view_resistor .resistor_view_canvas{
				margin-left:0.5em;
				margin-right:0.5em;
				margin-bottom:5px;
			}
	     }
	     @media screen and (max-width: 1320px) {
		  #stock_view_resistor .resistor_view_canvas{
		    font-size:x-small;
		  }
		  #stock_view_resistor .div_article .shown_data {
		    font-size:0.7em;
		  }
		  #stock_view_resistor .div_article .blink_data {
		    font-size:0.7em;
		  }
		  #stock_view_resistor .resistor_view_canvas{
		    margin-left:0.2em;
		    margin-right:0.2em;
		    margin-bottom:0.2em;
		  }
	     }
	    #stock_view_resistor .div_button{
	      display:none;
	    }
	    #stock_view_resistor:hover .div_button{
		display:block;
	    }
	    #taken_stock_view_resistor {
	      padding-top:1em;
	      padding-bottom:1em;
	      width:100%;
	      height:10em;
	      overflow:auto;
	    }
	    .draggable{
	      cursor:move;
	    }
	    .droppable{
	      cursor:cell;
	    }
	    .border_round{
	      border-radius:1em;
	    }
	    .rotate_item_unvertical {
	      transform: rotate(90deg);
	      -webkit-transform: rotate(90deg);
	      -ms-transform: rotate(90deg);
	      display:inline-block;
	    }
	    .up_big_item{
	      position:relative;
	      bottom:0.5em;
	    }
	    .up_small_item{
	      position:relative;
	      bottom:0.25em;
	    }
	    .down_small_item{
	      position:relative;
	      bottom:-0.25em;
	    }
	    .rotate_item_vertical {
	      transform: rotate(-90deg);
	      -webkit-transform: rotate(-90deg);
	      -ms-transform: rotate(-90deg);
	      display:inline-block;
	    }
	    .rotate_item_shake {
	      transform: rotate(-10deg);
	      -webkit-transform: rotate(-10deg);
	      -ms-transform: rotate(-10deg);
	    }
	    .rotate_item_hurt1 {
	      transform: rotate(-45deg);
	      -webkit-transform: rotate(-45deg);
	      -ms-transform: rotate(-45deg);
	    }
	    .rotate_item_hurt2 {
	      transform: rotate(-120deg);
	      -webkit-transform: rotate(-120deg);
	      -ms-transform: rotate(-120deg);
	    }
	    .rotate_item_hurt3 {
	      transform: rotate(180deg);
	      -webkit-transform: rotate(180deg);
	      -ms-transform: rotate(180deg);
	    }
	    .rotate_item_hurt4 {
	      transform: rotate(120deg);
	      -webkit-transform: rotate(120deg);
	      -ms-transform: rotate(120deg);
	    }
	    .rotate_item_hurt5 {
	      transform: rotate(45deg);
	      -webkit-transform: rotate(45deg);
	      -ms-transform: rotate(45deg);
	    }
	    /*Element d'aide*/
	    .hidden_data{
		opacity:0;
	    }
	    .blink_data{
		opacity:0.25;
	    }
	    .shown_data{
		opacity:0.9;
	    }
	    big{
	      font-size:2em;
	    }
	    .info{
	      font-size:small;
	      text-align:left;
	      margin-left:10%;
	    }
	    .info li{
	      font-size:small;
	      text-align:left;
	    }
	    #menu{
	      position: fixed;
	      right:0;
	      top:0;
	      text-align:center;
	      width:15em;
	      font-size:small;
	    }
	    #menu .active{
		  background-color:yellow;
	    }
	    #menu li{
		 padding:0.5vw;
		 margin-top:0.2vw;
		 border:1px solid green;
	    }
	    
	    nav ul ul {
		display: none;
	    }
	    nav ul li > ul:hover {
		display: none;
	    }
	    nav ul li:hover > ul {
		display: block;
	    }
	    nav ul {
		list-style: none;
		margin:0;
	    }
	    nav ul:after {
		content: ""; clear: both; display: block;
	    }
	    a{
	      font-size:1.2vw;
	      padding:0.1vw;
	      margin:0.1vw;
	      text-decoration:none;
	    }
	    #notes {
		display:none;
	    }
	    #mini_calc div{
			text-align:left;
		}

	    .radio_redzone{
		border-top:2px dashed red;
	    }
	    .radio_orangezone{
		border-top:2px dashed orange;
	    }
	    .radio_greenzone{
		border-top:2px dashed green;
	    }
	    .deprecated{
		background-color:gray;
		
	    }
	    .todo{
		color:red;
		border:2px dashed red;
		background-color:white;
		font-weight:bold;
		font-size:small;
		position:relative;
		left:-4em;
		top:0.8em;
		transform: rotate(-18deg);
		-webkit-transform: rotate(-18deg);
		-ms-transform: rotate(-18deg);
		max-width:4em;
	    }
	  </style>
	 </head>
    <body>
     <nav id="menu">
	 <ul>
	    <div class='todo'>TODO</div>
	    <li id='nav_resistor_decoder' ondragover="switch_app('resistor_decoder')" onmouseover="switch_app('resistor_decoder')">Lecture/déchiffrage</li>
	    <li id='nav_mini_calc' onmouseover="switch_app('mini_calc')">Mini calculatrice</li>
	    <h3 title="Resistances">&mdash;[/\/\/]&mdash;</h3>
	    <li id='nav_block_stock_resistor' ondragover="switch_app('block_stock_resistor')" onmouseover="switch_app('block_stock_resistor')">Stock</li>
	    <li id='nav_calc_combi_resistance' onmouseover="switch_app('calc_combi_resistance')">Combinaisons</li>
	    <li id='nav_calcul_puissance' onmouseover="switch_app('calcul_puissance')">Puissance</li>
	    <li id='nav_diviseur_tension' onmouseover="switch_app('diviseur_tension')">Diviseur de tension</li>
	    <li id='nav_notes' onmouseover="switch_app('notes')">Notes</li>
	    <h3 title="Condensateurs">&mdash;| |&mdash;</h3>
	    <div class='todo'>TODO</div>
	    <li id='nav_block_stock_capacitor' ondragover="switch_app('block_stock_capacitor')" onmouseover="switch_app('block_stock_capacitor')">Stock</li>
	    

   	 </ul>
     </nav> 
       
       <section id='corps'>
	  <article class='app' id='notes'>
	    <header><h3>Notes</h3></header>
	      <ul>
		  <li>Soit
		  <ul>
		  <li>v -> valeurs</li>
		  <li>m -> multiple</li>
		  <li>t -> tolérance</li>
		  <li>d -> indicatifs (R : resistance; C : condensateur; c : carbone; m : metal; v:vert ; r:rouge) </li>
		  </ul> 
		  </li>  
	      <li> on désigne des composants ainsi :
			 <ul>
		  <li>V[v,v,v,m,t,d] -> composants cylindriques à bandes </li>
	      <li>R[P,t] -> résistances bobinées</li>
	      <li>R[vvm] -> résistances CMS</li>
	      <li>C[vvm,t,d] -> condensateurs céramiques</li>
		  <li>C[v,t,d] -> autres condensateurs</li>
	      </ul>
		  <li>! Vérifiez les valeurs de la résistance au multimètre avant utilisation !</li>
			 On peut aussi deviner que des résistances de grosse taille vont dissiper plus de puissance, que des résistances de même couleur de plus petite taille.</li>
	      </ul>
	   </article>
	<article class='app' id='resistor_decoder' >
	  <header><h3>Lecture/déchiffrage</h3></header>
	  <section class='cadre'>

	  <div class='resistor_mode_list'>
	  <label for='component_value' class='title'>Valeur :</label>
	   <span type='text' id='component_value'>?</span>
	    <button onClick='store_resistance()' id='stock_add_btn' class='button_disabled' title="Ajouter au stock" disabled>+</button>
	  </p><p>
	  <label for='component_desc'>Desc.:</label>
	   <input class='view' type='text' id='component_desc' size=12
		  ondragover="document.getElementById('resistor_desc').value='';" onClick='get_resistance();' onblur='get_resistance();' onKeyDown='run_get_resistance(event);'></input>
		  </p>
	  </div>
	  
	    	   <section  id='resistor_settings'>
	    <div>
	    <style>
	    #resistor_settings  div + ul li{
	      font-size:large;
	    }
	    </style>

		<div>
	    <ul class='resistor_mode_list'>
		<li class='title'>Package</li>
<!--
		 axial component : resistor and axial capacitor 
-->
		<li id='PACKAGE_RING' name='PACKAGE' >
		  <small>
		  <div class='' id='resistor_img' >&mdash;<span
		  id='resistor_body' class='resistor_view cei_color_Beige'><span
		  id='border_view_val1' class='resistor_blink_val_hidden'
		  onmouseover="document.getElementById('value1').className='resistor_value_selector_hightlight';"
		  onmouseout="document.getElementById('value1').className='resistor_value_selector';"><span
		  id='view_val1' class='cei_color_None' >&nbsp;</span></span><span
		  id='border_view_val2' class='resistor_blink_val_hidden'
		  onmouseover="document.getElementById('value2').className='resistor_value_selector_hightlight';"
		  onmouseout="document.getElementById('value2').className='resistor_value_selector';"><span
		  id='view_val2' class='cei_color_None'>&nbsp;</span></span><span
		  id='border_view_val3' class='resistor_blink_val_hidden'
		  onmouseover="document.getElementById('value3').className='resistor_value_selector_hightlight';"
		  onmouseout="document.getElementById('value3').className='resistor_value_selector';"><span
		  id='view_val3' class='cei_color_None'>&nbsp;</span></span><span
		  id='border_view_mult' class='resistor_blink_val_hidden'
		  onmouseover="document.getElementById('mult').className='resistor_value_selector_hightlight';"
		  onmouseout="document.getElementById('mult').className='resistor_value_selector';"><span
		  id='view_mult' class='cei_color_None'
		  >&nbsp;</span></span><span
		  id='border_view_tol' class='resistor_blink_val_hidden'
		  onmouseover="document.getElementById('tol').className='resistor_value_selector_hightlight';"
		  onmouseout="document.getElementById('tol').className='resistor_value_selector';"><span
		  id='view_tol' class='cei_color_None'>&nbsp;</span></span><span
		  id='view_ppm'class='cei_color_None'>&nbsp;</span>
		</span>&mdash;</div>
			
			</small></li>
<!--
		power resistor
-->
		<li id='PACKAGE_BOBINE' name='PACKAGE' ><div class='up_small_item'>
			o-<small><input class='bobine_resistor_view cei_color_Gold' type='text' id='power_resistor_desc' size=8
		 ondragover="event.preventDefault();" placeholder='&nbsp;R>1W&nbsp;'></input></small>-o
			
			</div></li>
<!--
		CMS
-->
		<li id='PACKAGE_CMS' name='PACKAGE'  >
			<div class='up_small_item'><small>
		  	<span class='cms_pkg_view'>
			<span class='cei_color_Silver relief_left'>&nbsp;&nbsp;</span>
			<input class='cei_color_Black relief' type='text' id='cms_resistor_desc' size=2 maxlength=3
		 ondragover="event.preventDefault();" placeholder='CMS'></input>
			<span class='cei_color_Silver relief_right'>&nbsp;&nbsp;</span></span>
			</small></div></li>
<!--
		ceramic capacitor
-->
		<li id='PACKAGE_CERAMIC' name='PACKAGE' >

		 <div class='eletrolytic_pkg_view_cylinder cei_color_Brown down_small_item' >
		      &nbsp;<input class='cei_color_Brown' type='text' id='ceramic_capacitor_desc' size=1 maxlength=3
		 ondragover="event.preventDefault();" placeholder='104'></input>&nbsp;</span>
		  </div>
		  <div class=''>||</div>
		  </li>
<!--
		plastic capacitor
-->
		<li id='PACKAGE_PLASTIC' name='PACKAGE'  >
			<small>
				<div class='up_small_item'>
					<input class='plastic_pkg_view cei_color_Blue' type='text' id='plastic_capacitor_desc' size=3 maxlength=5
		 ondragover="event.preventDefault();" placeholder='&mu;'></input>
				</div>
			</small>
		</li>
<!--
		electrolytic capacitor
-->
		<li id='PACKAGE_ELECTROLYTIC'>
		  <span><div class='up_big_item'><div class='rotate_item_unvertical'>
		  <span><span class='eletrolytic_pkg_view_cylinder cei_color_Black' >
		    <small><span class='eletrolytic_pkg_view_round cei_color_Silver'>&nbsp;&nbsp;&nbsp;</span><strong>===</strong></small>
		  </div>
		  </div>
		  <div class=''>||</div></span>
		  <input  type='text' id='electrolytic_capacitor_desc' size=5 maxlength=68
		 ondragover="event.preventDefault();" placeholder='10&mu;f 50v'></input>
		  </li>
		</ul>
		</div>
		<div id='pkg_color' class=''>
	    <ul class='resistor_mode_list'>
			<li class='title'>Couleur</li>
			<li id="RESISTOR_CARBON" name='PKG_COLOR' >R 0,5W</li>
			<li id="RESISTOR_METAL_BLUE" name='PKG_COLOR'>R 0,4W</li>
			<li id="RESISTOR_METAL_GREEN" name='PKG_COLOR'>R 0,4W</li>
			<li id="RESISTOR_METAL_RED" name='PKG_COLOR'>R 1W</li>
			<li id="CAPACITOR_PINK" name='PKG_COLOR'>C</li>
			<li id="CAPACITOR_GREEN" name='PKG_COLOR'>C</li>
		</ul>
		</div>
		<div id='nb_ring' class=''>
		<ul class='resistor_mode_list '>
			<li class='title'>Nombre d'anneaux</li>
			<li onClick="mode_set(3);" id='nba3'>3</li>
			<li onClick="mode_set(4);" id='nba4'>4</li>
			<li onClick="mode_set(5);" id='nba5'>5</li>
			<li onClick="mode_set(6);" id='nba6'>6</li>
		</ul>
	    </div>
	  </div>
	    

	    <div class=' cei_color_block'>
	      <div class='resistor_prop_title '>Valeur</div>
	      <div class="resistor_value_selector" id="value1"
		    onmouseover="document.getElementById('border_view_val1').className='resistor_blink_val';"
		    onmouseout="document.getElementById('border_view_val1').className='resistor_blink_val_hidden';">
		<ul >
		  <li class='cei_color_Black'    onClick='val1_set(0)'>0</li>
		  <li class='cei_color_Brown'    onClick='val1_set(1)'>1</li>
		  <li class='cei_color_Yellow'   onClick='val1_set(4)'>4</li>
		  <li class='cei_color_Violet'   onClick='val1_set(7)'>7</li>
		</ul>
		<ul >
		  <li>&nbsp; </li>
		  <li class='cei_color_Red'      onClick='val1_set(2)'>2</li>
		  <li class='cei_color_Green'    onClick='val1_set(5)'>5</li>
		  <li class='cei_color_Gray'     onClick='val1_set(8)'>8</li>
		</ul>
		<ul >
		  <li>&nbsp; </li>
		  <li class='cei_color_Orange '  onClick='val1_set(3)'>3</li>
		  <li class='cei_color_Blue'     onClick='val1_set(6)'>6</li>
		  <li class='cei_color_White'    onClick='val1_set(9)'>9</li>
		</ul>
		 </div>
<!--
	      <br>
-->
	      <div id='value2' class='resistor_value_selector'
		    onmouseover="document.getElementById('border_view_val2').className='resistor_blink_val';"
		    onmouseout="document.getElementById('border_view_val2').className='resistor_blink_val_hidden';"
		    >
		<ul >
		  <li class='cei_color_Black'    onClick='val2_set(0)'>0</li>
		  <li class='cei_color_Brown'    onClick='val2_set(1)'>1</li>
		  <li class='cei_color_Yellow'   onClick='val2_set(4)'>4</li>
		  <li class='cei_color_Violet'   onClick='val2_set(7)'>7</li>
		</ul>
		<ul >
		  <li>&nbsp; </li>
		  <li class='cei_color_Red'      onClick='val2_set(2)'>2</li>
		  <li class='cei_color_Green'    onClick='val2_set(5)'>5</li>
		  <li class='cei_color_Gray'     onClick='val2_set(8)'>8</li>
		  
		</ul>
		<ul >
		  <li>&nbsp; </li>
		  <li class='cei_color_Orange '  onClick='val2_set(3)'>3</li>
		  <li class='cei_color_Blue'     onClick='val2_set(6)'>6</li>
		  <li class='cei_color_White'    onClick='val2_set(9)'>9</li>
		</ul>
	      </div>
<!--
	      <br>
-->
	      <div class='resistor_value_selector' id='value3' 
		    onmouseover="document.getElementById('border_view_val3').className='resistor_blink_val';"
		    onmouseout="document.getElementById('border_view_val3').className='resistor_blink_val_hidden';"
		    >
		<ul id='value3'>
		  <li class='cei_color_Black'    onClick='val3_set(0)'>0</li>
		  <li class='cei_color_Brown'    onClick='val3_set(1)'>1</li>
		  <li class='cei_color_Yellow'   onClick='val3_set(4)'>4</li>
		  <li class='cei_color_Violet'   onClick='val3_set(7)'>7</li>
		</ul>
		<ul >
		  <li>&nbsp; </li>
		  <li class='cei_color_Red'      onClick='val3_set(2)'>2</li>
		  <li class='cei_color_Green'    onClick='val3_set(5)'>5</li>
		  <li class='cei_color_Gray'     onClick='val3_set(8)'>8</li>
		</ul>
		<ul >
		  <li>&nbsp; </li>
		  <li class='cei_color_Orange '  onClick='val3_set(3)'>3</li>
		  <li class='cei_color_Blue'     onClick='val3_set(6)'>6</li>
		  <li class='cei_color_White'    onClick='val3_set(9)'>9</li>
		</ul>
	      </div>
	    </div>
	    <div id='mult' class='resistor_value_selector'
		onmouseover="document.getElementById('border_view_mult').className='resistor_blink_val';"
		onmouseout="document.getElementById('border_view_mult').className='resistor_blink_val_hidden';">
	      <ul class='cei_color_block'>
		<div class='resistor_prop_title'>Multiple</div>
		<li class='cei_color_Gold'   onClick='mult_set(0.01)'>x0.01</li>
		<li class='cei_color_Silver' onClick='mult_set(0.1)'>x0.1</li>
		<li class='cei_color_Black'  onClick='mult_set(1)'>x1</li>
		<li class='cei_color_Brown'  onClick='mult_set(10)'>x10</li>
		<li class='cei_color_Red'    onClick='mult_set(100)'>x100</li>
		<li class='cei_color_Orange' onClick='mult_set(1000)'>x1k</li>
		<li class='cei_color_Yellow' onClick='mult_set(10000)'>x10k</li>
		<li class='cei_color_Green'  onClick='mult_set(100000)'>x100k</li>
		<li class='cei_color_Blue'   onClick='mult_set(1000000)'>x1M</li>
		<li class='cei_color_Violet' onClick='mult_set(10000000)'>x10M</li>
	      </ul>
	    </div>
	    <div id='tol' class='resistor_value_selector'
		onmouseover="document.getElementById('border_view_tol').className='resistor_blink_val';"
		onmouseout="document.getElementById('border_view_tol').className='resistor_blink_val_hidden';">
	      <ul class='cei_color_block'>
		<div class='resistor_prop_title'>Tolérance</div>
		<li class='cei_color_None'  onClick='tolerance_set(0.20)'>~20%</li>
		<li class='cei_color_Silver' onClick='tolerance_set(0.10)'>~10%</li>
		<li class='cei_color_Gold' onClick='tolerance_set(0.05)'>~5%</li>
		<li class='cei_color_Brown' onClick='tolerance_set(0.01)'>~1%</li>
		<li class='cei_color_Red' onClick='tolerance_set(0.02)'>~2%</li>
		<li class='cei_color_Green' onClick='tolerance_set(0.005)'>~0.5%</li>
		<li class='cei_color_Blue' onClick='tolerance_set(0.0025)'>~0.25%</li>
		<li class='cei_color_Violet' onClick='tolerance_set(0.001)'>~0.1%</li>
	      </ul>
	    </div>
	    <div class='cei_color_block'>
	     <div id='pow' class='resistor_value_selector'>
		<div class='resistor_prop_title'>Charge<br>admissible</div>
		<ul id='pow'>
		  <li onClick='pow_set(1)' id='pow1'>1W</li>
		  <li onClick='pow_set(2)' id='pow2'>2W</li>
		  <li onClick='pow_set(2.5)' id='pow2_5'>2.5W</li>
		  <li onClick='pow_set(3)' id='pow3'>3W</li>
		  <li onClick='pow_set(4)' id='pow4'>4W</li>
		  <li onClick='pow_set(5)' id='pow5'>5W</li>
		  <li onClick='pow_set(7)' id='pow7'>7W</li>
		  <li onClick='pow_set(11)' id='pow11'>11W</li>
		  <li onClick='pow_set(12)' id='pow12'>12W</li>
		  <li onClick='pow_set(20)' id='pow20'>20W</li>
		  <li onClick='pow_set(25)' id='pow25'>25W</li>
		  <li onClick='pow_set(30)' id='pow30'>30W</li>
		  <li onClick='pow_set(50)' id='pow50'>50W</li>
		  <li onClick='pow_set(90)' id='pow90'>90W</li>
		  <li onClick='pow_set(100)' id='pow100'>100W</li>
		  <li onClick='pow_set(180)' id='pow180'>180W</li>
		  <li onClick='pow_set(250)' id='pow250'>250W</li>
		  <li onClick='pow_set(300)' id='pow300'>300W</li>
		</ul>
	      </div>
	    </div>
	    <ul class='cei_color_list font-small resistor_value_selector' id='coef-temp'>
	      <div class='resistor_prop_title'>Coef.temp.</div>
	      <li class='cei_color_Black' onClick='ppm_set(200,"cei_color_Black")'>200ppm</li>
	      <li class='cei_color_Brown' onClick='ppm_set(100,"cei_color_Brown")'>100ppm</li>
	      <li class='cei_color_Red' onClick='ppm_set(50,"cei_color_Red")'>50ppm</li>
	      <li class='cei_color_Orange' onClick='ppm_set(15,"cei_color_Orange")'>15ppm</li>
	      <li class='cei_color_Yellow' onClick='ppm_set(25,"cei_color_Yellow")'>25ppm</li>
	    </ul>

	</section>
	<script>
	     	function store_resistance(){
		  //~ console.log('store');
		  if (update_value(true)){
		    shake(((my_component_mode==PACKAGE_CMS)?'cms_':((my_component_mode==PACKAGE_BOBINE)?'power_':''))+'resistor_img');
		    updateStock();
		    shake(get_resistor_ref());
		  } else {
		     hurt(((my_component_mode==PACKAGE_CMS)?'cms_':((my_component_mode==PACKAGE_BOBINE)?'power_':''))+'resistor_img');
		  }
		}
	  	function get_resistance(){
		  var desc=document.getElementById('resistor_desc').value;
		  var tab_desc=get_tab_desc_in_desc(desc);
		  //~ console.log(tab_desc);
		  if (tab_desc.length>=5){
		    if (tab_desc[0]=='') {
		      delete my_component.val1;
		    }else{
		      my_component_mode=((tab_desc[2]!='')&&(tab_desc[1]!=''))?5:((tab_desc[1]!='')?4:3);
		    }
		    if (tab_desc[3]=='') {
		      delete my_component.mult;
		    }
		    if (tab_desc[4]=='') {
		      delete my_component.tolerance;
		    }
		    mode_set(my_component_mode);//imply update value and delete useless values
		  
		    if (!tab_desc[0]=='') {
		      val1_set(tab_desc[0]);
		    }
		    if (!tab_desc[1]=='') {
		      val2_set(tab_desc[1]);
		    }
		    if (!tab_desc[2]=='') {
		      val3_set(tab_desc[2]);
		    }
		    if (!tab_desc[3]=='') {
		      mult_set(tab_desc[3]);
		    }
		    if (!tab_desc[4]=='') {
		      tolerance_set(tab_desc[4]);
		    }
		    if (!tab_desc[5]=='') {
		      corps_set(tab_desc[5]);
		    }
		    
		  } else {
		    alert("Format de référence non reconnu");
		  }
		}
		function run_get_resistance(event) {
		  if (event.which == 13 || event.keyCode == 13) {
		    get_resistance();
		    return false;
		  }
		  return true;
		}
	   </script>
	</article>
	<article class='app'  id="calc_combi_resistance" >
		<header><h3>Recherche de combinaisons</h3></header>
		<section class="cadre">
		<section class='block_form1'>
	      <form>
	      <label for="resistance">Résistance souhaitée <small>(en Ohm)</small></label><input type="number" value="10500" name="resistance" id="resistance"
		  onchange="document.getElementById('resistance_link').value=this.value;"
		  ></input>
	      <br>
	      <label for="ecart">Tolérance approximative <small>(en %)</small></label><input type="number" value="2" name="ecart" id="ecart" min="0.5" step="0.5" max="25"
		  onchange="document.getElementById('ecart_link').value=this.value;"
		   ></input>
	      <br>
	      <label for="nbresistances">Nombre maximum de resistances</label><input type="number" value="4" min=1 max=8 name="nbresistances" id="nbresistances"
		  onchange="document.getElementById('nbresistances_link').value=this.value;"
		  ></input>
	      <br>
	      </form>
	      <button OnClick="start_calcul_combinaisons();" id="button_chercher">Chercher !</button>
	      <button class="button_hidden" id="button_chercher_loading"></button>
	      <br>
	    </section>
	    <section class='block_form2'>
	      <label for="grp_resistance1">Solution 1 : </label><input class="formule" type="text" name="grp_resistance1" id="grp_resistance1" disabled></input>
	      <span class="valeur" type="text" name="grp_resistance_val1" id="grp_resistance_val1"></span>
	      <button OnClick="prendre_grp(1)" id='prendre_grp1_btn' class="button_hidden">Mettre de coté</button>
	      <br>
	      <label for="grp_resistance2">Solution 2 : </label><input class="formule" type="text" name="grp_resistance2" id="grp_resistance2" disabled></input>
	      <span class="valeur" type="text" name="grp_resistance_val2" id="grp_resistance_val2"></span>
	      <button OnClick="prendre_grp(2)" id='prendre_grp2_btn' class="button_hidden">Mettre de coté</button>
	      
	      <br>
	      <label for="grp_resistance3">Solution 3 : </label><input class="formule" type="text" name="grp_resistance3" id="grp_resistance3" disabled></input>
	      <span class="valeur" type="text" name="grp_resistance_val3" id="grp_resistance_val3"></span>
	      <button OnClick="prendre_grp(3)" id='prendre_grp3_btn' class="button_hidden">Mettre de coté</button>
	      <br>
	    </section>
	    <section class='block_stock' id='cadre_taken_stock_view_resistor'>
		<label for="taken_stock_view_resistor">Resistances mises de coté :<br></label>
		<section id='taken_stock_view_resistor'></section>
		<form>
		  <input type="string"
		  value=""
		  class="stock"
		  name="my_stock_resistor_pris"
		  id="my_stock_resistor_pris"
		  onClick="makeViewFromFormattedTakenStock();" ></input>
		</form>
		<br>
		
		</section>
	    </section>
	    <p class="info">Légende :  ( R1 <strong>+</strong> R2 ) &rarr; résistances en série; ( R1 <strong>//</strong> R2 ) &rarr; résistances en parallèle.</p>
	    <script>
	    <!-- functions in gui -->
	    function start_calcul_combinaisons(){
		setTimeout(function(){
		    document.getElementById('button_chercher').className='button_hidden';
		    document.getElementById('button_chercher_loading').innerHTML='Recherche en cours...';
		    document.getElementById('button_chercher_loading').className='button_waiting';
		    },0);
		setTimeout(function(){
		  
		  trouver_solutions();
		  setTimeout(function(){
		    document.getElementById('button_chercher').className='';
		    document.getElementById('button_chercher_loading').className='button_hidden';
		    },100);
		},100);
	    }
	    function trouver_solutions(){
	      var v_resistance=parseInt(document.getElementById('resistance').value);
	      var v_tolerance=(parseFloat(document.getElementById('ecart').value)*v_resistance)/100;
	      var max_qte=parseInt(document.getElementById('nbresistances').value);
	      // reinitialization of the output
	      var i;
	      reformat_input_stock();// include quantification between { }
	      for (i=1; i<(3+1);i++){
		document.getElementById('grp_resistance'+i).value="";
		document.getElementById('grp_resistance_val'+i).innerHTML="";
		document.getElementById('prendre_grp'+i+'_btn').className="button_hidden";
	      }
	      var comb_final_set=calcul_combinaisons(max_qte);
	      // search the nearests
	     
	      var v_solution=SearchGroup(v_resistance,v_tolerance,comb_final_set);
	      //~ console.log(v_solution);
	      // displaying results
	      for (i=0; i<((v_solution.length<3)?v_solution.length:3);i++){
		document.getElementById('prendre_grp'+(i+1)+'_btn').className="";
		document.getElementById('grp_resistance'+(i+1)).value=v_solution[i][1];
		document.getElementById('grp_resistance_val'+(i+1)).innerHTML='='.concat(v_solution[i][0],
		  ' (+/- ',
		  Math.round((v_solution[i][2]/v_solution[i][0])*10000)/100,"%)") ;
	      }
	    }
	    function prendre_grp(n){
	      document.getElementById('my_stock_resistor_pris').value=document.getElementById('my_stock_resistor_pris').value.concat(" "
		,extractStockFromFormattedInput(document.getElementById('grp_resistance'+n).value)
		).replace(')(',') (');
	      document.getElementById('grp_resistance'+n).value="";
	      document.getElementById('grp_resistance_val'+n).innerHTML="";
	      document.getElementById('prendre_grp'+n+'_btn').className="button_hidden";
	      makeViewFromFormattedTakenStock();
	    }
		</script>
      </article>
	  <article class='app'  id="calcul_puissance">
		<header><h3>Vérification de puissance</h3></header>
		<section class='block_form0 cadre'>
	    <form>
	      <label for="resistance_link">Résistance</label><input size=8 name="resistance" id="resistance_link"></input>
	      <label for="tension">Tension aux bornes<small>(en Volt)</small></label>
	      <input size=6 value="9" name="tension" id="tension"></input>
	      <label for="puissance">Puissance à dissiper<small>(en Watt)</small></label>
	      <input size=6 value="" name="puissance" id="puissance" disabled></input>
	      <button OnClick="calcul_puissance();return false;" title="Vérifier la puissance">Calculer !</button>
	    </form>
	    <span ><small id="indication_puissance"> </small></span>
	    </section>
	  <script>
	  document.getElementById('resistance_link').value=document.getElementById('resistance').value;
	  
	  function calcul_puissance(){
	    var v_U=unit_conv(document.getElementById('tension').value);
	    var v_R=unit_conv(document.getElementById('resistance_link').value);
	    var v_P=(v_U*v_U)/v_R;
	    var msg="ndef";
	    
	    if (v_P>=1){
	      msg="Attention : seul des resistances de puissance".concat(((v_P>=3)?" bobinées ":" "),"peuvent supporter plus de ",((v_P>=3)?3:1), "W !");
	    } else if (v_P>=0.5){
	      msg="Attention : il faut utiliser des résistances haute tension ou des résistances de puissance pour supporter plus de 0,5W !";
	    } else {
	      msg="Note : les résistances métalliques (bleu ou vert) génèrent moins de bruit que des résistances carbone (marron).";
	    }
	    document.getElementById('puissance').value=Math.round(v_P*1000)/1000;
	    document.getElementById('indication_puissance').innerHTML=msg;
	  }
	  </script>
      </article>
      <article class='app'  id="mini_calc">
	    <header><h3>Mini calculatrice</h3></header>
		<section class='block_form0'>
	    <p class="info">Opérateurs :  ( R1 <strong>+</strong> R2 ) &rarr; composants en série; ( R1 <strong>//</strong> R2 ) &rarr; composants en parallèle.</p>
	    <p class="info">Grandeurs : <strong>p</strong>ico(10^-12); <strong>n</strong>ano(10^-9); <strong>u</strong>:micro(10^-6); <strong>m</strong>illi(10^-3); <strong>k</strong>ilo(10^3); <strong>M</strong>ega(10^-6) </p>
		 <div>
	    Résistance &mdash;[/\/\/]- 
	     <span> <input type="text" value="" name="calc_in_resistance" id="calc_in_resistance" size=20 onchange="mini_calc_resistance()" placeholder="r // ( ((a+b)*(a-b)) / c )"></input>=<span id="calc_out_resistance"></span> Ohm</span>
	     </div>
	     <div>Capacitance &mdash;| |&mdash;
	     <span> <input type="text" value="" name="calc_in_capacitance" id="calc_in_capacitance" size=20 onchange="mini_calc_capacitance()" placeholder="r // ( ((a+b)*(a-b)) / c )"></input>=<span id="calc_out_capacitance"></span> Farad</span>
	     </div>

	    <section>
		
	    <script>
	      function parse_and_compute_generic(formule,funcadd,funcpar){/* // -> funcpar;  + -> funcadd */
		//enleve les espace inutiles
		var res=formule.replace(/\([\s]*([0-9.]+[Mmknup]?[0-9]*(e[-]?[1-9][0-9]?)?[Mmknup]?)[\s]*\)/,function(x,y){return y;});
		if (! (/(\/\/|\+|-|\*|\/)/.test(res)) ){//si pas d'operateur binaire
			res=parseFloat(unit_conv(res));
		} else { // sinon
		while ((/(^|\()[\s]*([0-9.]+[Mmknup]?[0-9]*(e[-]?[1-9][0-9]?)?[Mmknup]?)[\s]*(\/\/|\+|-|\*|\/)[\s]*([0-9.]+[Mmknup]?[0-9]*(e[-]?[1-9][0-9]?)?[Mmknup]?)[\s]*(\)|$)/.test(res))){
		 res=res.replace(/(^|\()[\s]*([0-9.]+[Mmknup]?[0-9]*(e[-]?[1-9][0-9]?)?[Mmknup]?)[\s]*\/\/[\s]*([0-9.]+[Mmknup]?[0-9]*(e[-]?[1-9][0-9]?)?[Mmknup]?)[\s]*(\)|$)/g,
			function(a,b,c,d,e,f,g,h,i){
					return funcpar(parseFloat(unit_conv(c)),parseFloat(unit_conv(e)));
				    }
		    ).replace(/(^|\()[\s]*([0-9.]+[Mmknup]?[0-9]*(e[-]?[1-9][0-9]?)?[Mmknup]?)[\s]*\+[\s]*([0-9.]+[Mmknup]?[0-9]*(e[-]?[1-9][0-9]?)?[Mmknup]?)[\s]*(\)|$)/g,
		    function(a,b,c,d,e,f,g,h,i){
					return funcadd(parseFloat(unit_conv(c)),parseFloat(unit_conv(e)));
				    }
		    ).replace(/(^|\()[\s]*([0-9.]+[Mmknup]?[0-9]*(e[-]?[1-9][0-9]?)?[Mmknup]?)[\s]*-[\s]*([0-9.]+[Mmknup]?[0-9]*(e[-]?[1-9][0-9]?)?[Mmknup]?)[\s]*(\)|$)/g,
			function(a,b,c,d,e,f,g,h,i){
					return parseFloat(unit_conv(c))-parseFloat(unit_conv(e));
				    }
		    ).replace(/(^|\()[\s]*([0-9.]+[Mmknup]?[0-9]*(e[-]?[1-9][0-9]?)?[Mmknup]?)[\s]*\*[\s]*([0-9.]+[Mmknup]?[0-9]*(e[-]?[1-9][0-9]?)?[Mmknup]?)[\s]*(\)|$)/g,
		    function(a,b,c,d,e,f,g,h,i){
					return parseFloat(unit_conv(c))*parseFloat(unit_conv(e));
				    }
		    ).replace(/(^|\()[\s]*([0-9.]+[Mmknup]?[0-9]*(e[-]?[1-9][0-9]?)?[Mmknup]?)[\s]*\/[\s]*([0-9.]+[Mmknup]?[0-9]*(e[-]?[1-9][0-9]?)?[Mmknup]?)[\s]*(\)|$)/g,
		    function(a,b,c,d,e,f,g,h,i){
					return parseFloat(unit_conv(c))/parseFloat(unit_conv(e));
				    }
		    );
		  }
		  }
		  return res;
	    }
	    function mini_calc_resistance(){
	      var user_input=document.getElementById('calc_in_resistance').value.replace(
	      /[abcdfghijloqrstvwxyzABCDEFGHIJKLNOPQRSTUVWXYZ]+[a-zA-Z]*/g,'');
	      document.getElementById('calc_out_resistance').innerHTML=unit_format(parse_and_compute_generic(user_input,resistances_en_serie,getValueOfParallelResistor));
	    }
	    function mini_calc_capacitance(){
	      var user_input=document.getElementById('calc_in_capacitance').value.replace(
	      /[abcdfghijloqrstvwxyzABCDEFGHIJKLNOPQRSTUVWXYZ]+[a-zA-Z]*/g,'');
		  
		  while (/(e[0-9]+)([^Mkmnup]|$)/.test(user_input)){ // unite standard : picofarad
				user_input=user_input.replace(/(^|[^0-9])([0-9]+e[0-9]+)([^Mkmnup]|$)/g,
					function (a,b,c,d){
						return b + c + "p" + d;
				});
		  }
		  document.getElementById('calc_out_capacitance').innerHTML=unit_format(parse_and_compute_generic(user_input,condensateurs_en_serie,condensateurs_en_parallele));
	    }
	  </script>
      </article>
      <article class='app'  id="diviseur_tension">
	     <header><h3>Calcul des résistances d'un pont diviseur de tension</h3></header>
	     <section class='block_form0 cadre'>
	      <form>
		<label for="ecart_link">Tolérance approximative <small>(en %)</small></label><input size=4  id="ecart_link" disabled></input>
		<label for="nbresistances_link">Nb. max. de resistances par R</label><input size=4 id="nbresistances_link" disabled></input>
		<br>
		<label for="t_in">Ue <small>(en V)</small></label>
		<input type="text" size=4  value="9" name="t_in" id="t_in"></input>
		<label for="t_out">Us <small>(en V)</small></label>
		<input type="text" size=4 value="0.2" name="t_out" id="t_out"></input>
		<br>
		<label for="charge_in">Re <small>(en Ohm)</small></label>
		<input type="text" size=4 value="0" name="charge_in" id="charge_in"></input>
		<label for="charge_out">Rs <small>(en Ohm)</small></label>
		<input type="text" size=4 value="20k" name="charge_out" id="charge_out"></input>
				<br>
				<small>
		<label for="influence_percent">Faible influence de Rs</label>
		<span class='radio_redzone'>
		<input type="radio" value="1" name="influence_percent" title="1%" ></input>
		<input type="radio" value="2" name="influence_percent" title="2%"></input>
		<input type="radio" value="3" name="influence_percent" title="3%"></input>
		<input  type="radio" value="4" name="influence_percent" title="4%"></input>
		</span>
		<span class='radio_orangezone'>
		<input type="radio" value="5" name="influence_percent" title="5%"></input>
		<input type="radio" value="10" name="influence_percent" title="10%"></input>
		<input type="radio" value="15" name="influence_percent" title="15%"></input>
		<input type="radio" value="20" name="influence_percent" title="20%"></input>
		</span>
		<span class='radio_greenzone'>
		<input type="radio" value="25" name="influence_percent" title="25%"></input>
		<input type="radio" value="30" name="influence_percent" title="30%" checked="checked"></input>
		<input type="radio" value="35" name="influence_percent" title="35%"></input>
		<input type="radio" value="40" name="influence_percent" title="40%"></input>
		<input type="radio" value="45" name="influence_percent" title="45%"></input>
		<input type="radio" value="50" name="influence_percent" title="50%"></input>
		</span>
		<span class='radio_orangezone'>
		<input type="radio" value="60" name="influence_percent" title="60%"></input>
		<input  type="radio" value="70" name="influence_percent" title="70%"></input>
		</span>
		<span class='radio_redzone'>
		  <input type="radio" value="90" name="influence_percent" title="90%"</input>
		<input type="radio" value="100" name="influence_percent" title="100%"></input>
		</span>
		
		<label for="influence_percent">Faible consommation</label></small><br>
		<button OnClick="calcul_div_tension();return false;">Chercher !</button>
		<button OnClick="cherche_div_tension_stock();return false;">Chercher dans le stock!</button>
	      </form>
	      <style>
		#block_charge_opt{
		  display:none;
		}
	      </style>
	      <p id="formule_div_tension">Us=Ue*( R'2 / (R'1+R'2) ) avec R'1=R1+Re et R'2=R2//Rs</p>
	      <p id="solution_div_tension"></p>
	      <br>
	      <canvas id="monCanvas" width="200" height="150" style="border:1px solid #c3c3c3;">
  Votre navigateur ne supporte pas l'élément &lt;canvas&gt;.
  </canvas>
	      <script>
		document.getElementById('ecart_link').value=document.getElementById('ecart').value;
		document.getElementById('nbresistances_link').value=document.getElementById('nbresistances').value;
		// Equation (without charge) :
		//Us=Ue*(R2)/(R1+R2) ->
		//Us/R2=Ue/(R1+R2) ->
		//R2/U2=(R1+R2)/Ue ->
		//R2=(R1+R2)Us/Ue ->
		//R2-(R2*Us/Ue)=R1*Us/Ue ->
		//R2*Ue/Us - R2 = R1 -> R1 !!!
		//R2*(Ue/Us - 1) = R1 ->
		//R2= R1/(Ue/Us - 1) -> R2 !!!
	        // with charge : sub R2 by R2' = (R2 // Rs) (we can compute R2')
		function calcul_div_tension(){
		    var v_entree=unit_conv(document.getElementById("t_in").value);
		    var v_sortie=unit_conv(document.getElementById("t_out").value);
		    var r_entree=unit_conv(document.getElementById("charge_in").value);
		    var r_sortie=unit_conv(document.getElementById("charge_out").value);
		    var rs_influence=getCheckedElementByName(document,"influence_percent").value;
		    // reinitialization of the output
		    var v_solution=[];
		    var v_r1=-1;
		    var v_r2=0;
		    var v_r2rl;
		    var r=Math.round(rs_influence*(r_sortie+r_entree)/100);
		    var r_round=(r>10000)?1000:((r>1000)?100:((r>100)?10:1));
		    r=(Math.round(r/r_round)*r_round);
		    while ((v_r1<0) && (r>0)){
		    //R1 + Re  = (R2 // Rs)*Ue/Us - (R2 // Rs)
		    v_r2=r;
		    v_r2rl=getValueOfParallelResistor(v_r2,r_sortie);
		    v_r1=Math.round((((v_r2rl*v_entree)/v_sortie)-v_r2rl)-r_entree);
		    r=r-r_round;
		    }
		    
		    if (v_r1>0){//solution avec forte influence de Rs...
		      document.getElementById("solution_div_tension").innerHTML="".concat(
		      "<strong>R1</strong>"," = ",unit_format(v_r1),"<br>",
		      "<strong>R2</strong>"," = ",unit_format(v_r2));
		      shake("solution_div_tension");
		    } else {
		      document.getElementById("solution_div_tension").innerHTML="Pas de solution trouvée. Essayez de faire varier l'influence de Rs.";
		    }
		    

		    
		    return false;
		}
		function cherche_div_tension_stock(){
		    var v_entree=unit_conv(document.getElementById("t_in").value);
		    var v_sortie=unit_conv(document.getElementById("t_out").value);
		    var r_entree=unit_conv(document.getElementById("charge_in").value);
		    var r_sortie=unit_conv(document.getElementById("charge_out").value);
		    var rs_influence=getCheckedElementByName(document,"influence_percent").value;
		    
		    var stock={};
		    var stock_parse_tab=document.getElementById('my_stock_resistor').value.split(" ");
		    var max_qte=parseInt(document.getElementById('nbresistances').value);
		    var ecart=parseFloat(document.getElementById('ecart').value);
		    var v_tolerance;

		    // reinitialization of the output
		    reformat_input_stock();// include quantification between { }
		    var comb_final_set=calcul_combinaisons(max_qte);
		    var v_solution=[];
		    var v_r1;
		    var v_r2;
		    var v_r2rl;
		    var v_solution_r;
		    var r_virtual=Math.round(rs_influence*(r_sortie+r_entree)/100);
		    var r_virtual_round=(r>10000)?1000:((r>1000)?100:((r>100)?10:1));
		    var r_min=r_virtual-(r_virtual_round)*10;
		    var r_max=r_virtual+(r_virtual_round)*10;
		    
		    for (var r in comb_final_set){
			if ((r > r_max) || (r < r_min)){continue;}
			v_tolerance=(ecart*r)/100;
			//R1' = R2'*U/U2 - R2'
			//  R1' = (R1 + Re)      R2' = (R2 // Rs)
			v_r2rl=getValueOfParallelResistor(r,r_sortie);
			v_r1=(((v_r2rl*v_entree)/v_sortie)-v_r2rl)-r_entree;
			if ((v_r1<0)){continue;}
			//~ console.log(r,v_entree,v_sortie,v_r1);
			v_solution_r=SearchGroup(r,v_tolerance,comb_final_set);
			if (v_solution_r.length>0){//check if the tolerance for the current resistor is enough
			  v_solution=SearchGroup(v_r1,v_tolerance,comb_final_set);
			  if (v_solution.length>0){
			    document.getElementById("solution_div_tension").innerHTML="".concat(
			    "<strong>R1</strong>"," = ",unit_format(r)," = ",v_solution_r[0][1],"<br>",
			    "<strong>R2</strong>"," = ",unit_format(Math.round(v_r1))," = ",v_solution[0][1]);
			    shake("solution_div_tension")
			    return true;
			  }
			}
		    }
		    document.getElementById("solution_div_tension").innerHTML="Pas de solution trouvée en fouillant dans le stock. Essayez de faire varier l'influence de Rs.";
		    return false;
		}
		
		var c=document.getElementById("monCanvas");
		var canvOK=1;
		try {c.getContext("2d");}
		catch (er) {canvOK=0;}
		if (canvOK==1){
		  var ctx=c.getContext("2d");
		  var x=0;
		  var y=0;
		  
		  ctx.fillStyle="black";
		  ctx.font="10px Sans-Serif";
		  
		  ctx.beginPath();
		  ctx.moveTo(30,y+10);
		  ctx.lineTo(30,y+20);
		  ctx.strokeRect(20,y+20,20,40);
		  ctx.moveTo(30,y+60);
		  ctx.lineTo(30,y+70);
		  ctx.moveTo(20,y+70);
		  ctx.lineTo(40,y+70);
		  ctx.moveTo(25,y+80);
		  ctx.lineTo(35,y+80);
		  ctx.moveTo(30,y+80);
		  ctx.lineTo(30,y+130);
		  
		  ctx.moveTo(30,y+10);
		  ctx.lineTo(85,y+10);
		  ctx.lineTo(85,y+20);
		  ctx.strokeRect(75,y+20,20,40);
		  ctx.moveTo(85,y+60);
		  ctx.lineTo(85,y+80);
		  ctx.moveTo(85,y+70);
		  ctx.lineTo(135,y+70)
		  ctx.moveTo(85,y+130);
		  ctx.strokeRect(75,y+80,20,40);
		  ctx.moveTo(85,y+120);
		  ctx.lineTo(85,y+130)
		  ctx.moveTo(30,y+130);
		  ctx.lineTo(135,y+130);
		  ctx.strokeRect(170,y+80,20,40);
		  ctx.moveTo(180,y+80);
		  ctx.lineTo(180,y+70)
		  ctx.lineTo(145,y+70);
		  ctx.moveTo(180,y+120);
		  ctx.lineTo(180,y+130)
		  ctx.lineTo(145,y+130);
		  ctx.stroke();
		  ctx.fillText ("Re", 25, y+30); 
		  ctx.fillText ("R1", 80, y+30); 
		  ctx.fillText ("R2", 80, y+90);
		  ctx.fillText ("Rs", 175, y+90);
		  //tensions
		  ctx.fillStyle="green";
		  ctx.strokeStyle=ctx.fillStyle;
		  ctx.beginPath();
		  ctx.moveTo(125,y+85);
		  ctx.lineTo(125,y+120);
		  ctx.stroke(); 
		  ctx.beginPath();
		  ctx.moveTo(125,y+80);
		  ctx.lineTo(120,y+85);
		  ctx.lineTo(130,y+85);
		  ctx.fill();
		  ctx.fillText ("Us", 130, y+105);
		  ctx.beginPath();
		  ctx.moveTo(60,y+25);
		  ctx.lineTo(60,y+120);
		  ctx.stroke(); 
		  ctx.beginPath();
		  ctx.moveTo(60,y+20);
		  ctx.lineTo(55,y+25);
		  ctx.lineTo(65,y+25);
		  ctx.fill(); 
		  ctx.fillText ("Ue", 40, y+80);

		  
		  }
	      </script>
	    </section>
      </article>
      <article class="app" id='block_stock_resistor'>
      <section class="droppable" id='stock_view_resistor' ondrop="dropOnStock(event)" ondragover="allowDrop(event)">
      </section>
      <section class='block_stock'>
	      <div class='title'>
			  <label for="my_stock_resistor">Stock de resistances <small>(en Ohm, séparées par des espaces)</small>:<br></label>
		 </div>
	      <form >
		<textarea
		  ondrop="add_to_stock(event.dataTransfer.getData('text'));"
	      ondragover="allowDrop(event);"
	      id="my_stock_resistor"
	      title="Aide : les notations k=*1000 M=*1000000 sont authorisées"
	      onmouseout="updateStock(); is_valid_stock(this);"
	      onblur="updateStock(); is_valid_stock(this);"
	      rows="4" cols="50"
		>
		21k[2,1,,1k,0.01]{2} 1k[1,,,1k,0.01] 10k[1,0,,1k,0.01] 20k[2,0,,1k,0.01] 7k[7,,,1k,0.01] 9k[9,,,1k,0.01] 10500[1,0,5,100,0.01,c]{1}
	      </textarea>
	      
	      </form>
      </section>
      </article>
      <article class="app" id='block_stock_capacitor'>
      <section class="droppable" id='stock_view_capacitor' ondrop="dropOnStock(event)" ondragover="allowDrop(event)">
      </section>
      <section class='block_stock'>
	      <div class='title'>
			  <label for="my_stock_capacitor">Stock de condensateurs <small>(en Farad, séparées par des espaces)</small>:<br></label>
		 </div>
	      <form>
		  <textarea
		  ondrop="add_to_stock(event.dataTransfer.getData('text'));"
	      ondragover="allowDrop(event);"
	      id="my_stock_capacitor"
	      title="Aide : les notations u=e-6 n=e-9 p=e-12  sont authorisées"
	      onmouseout="updateStock(); is_valid_stock(this);"
	      onblur="updateStock(); is_valid_stock(this);"
	      rows="4" cols="50"
		  >
			 21n[2,1,,1k,0.01]{2} 1u[1,,,1M,0.01]
			 </textarea>
	      </form>
      </section>
      
      
      </article>  
      <footer>	    
		<div> <p>DIY. Die what ?</p>
		
		<p>Ceci est une série d'outils visant à faciliter de la récup' de composants électroniques.
		</p>
		<p>
		2015 Copyleft : <br> Sébastien Gillot
		</p>
		
			<p>Tests navigateurs : <br>
			Chromium : Ok; <br>
			Mozilla : Ok;<br>
			Webkit:fonctionnel.
			</p>
		</div>
		<div>
		<ul>
		<li><a  href="http://www.sonelec-musique.com/electronique_theorie_resistance.html">Infos sur les résistances</a></li>
	    <li><a  href="https://fr.wikipedia.org/wiki/CEI_60757">Infos sur les codes valeurs</a></li>
   	
		<li><a  onClick="if (confirm('Download lastest version?')){window.location='https://github.com/luffah/diy-heaven/archive/master.zip';};">Download lastest version</a></li>
	    <li><a  href="https://github.com/luffah/diy-heaven/issues">Report a bug !</a> <br></li>
	    </ul>
		</div>

      </footer>
      <!--Javascript-->
    	<script>
    <!--facilities-->
	function getCheckedElementByName(doc,elem_name){
	  var radios=doc.getElementsByName(elem_name);
	  var res;
	  for (var i = 0, length = radios.length; i < length; i++) {
	    if (radios[i].checked) {
	      res=radios[i];
	      break;
	    }
	  }
	  return res;
	}
	<!-- functions for reading the value of a resistance -->
	 function parse_input(r_val){
	  var res=r_val.replace(/(\[.*)/,'');
	  var pos_mult=res.search(/(k|M)/i);
	  if (pos_mult>-1){
	    var v_mult=(res.charAt(pos_mult)=='M'?1000000:1000);
	    res=parseFloat(res.replace(/(k|M)$/i,'').replace(/(k|M)/i,'.'))*v_mult;
	  } else {
	    res=parseFloat(res);
	  }
	  return res;
	}
	</script>
	<!-- Fonctions de calcul -->	
	<script>
	<!-- functions for computing combinations -->

	
	function unit_conv(a){
	  var res;
	  var pos_mult=a.search(/(k|M|m|n|u|p)/i);
	  if (pos_mult>-1){
		res=a.charAt(pos_mult);
	    res=parseFloat(a.replace(/(k|M|m|n|u|p)( |$)/i,'').replace(/(k|M|m|n|u|p)/i,'.'))
	    *
	    (res=='M'?1000000:
					(res=='k'?1000:
					(res=='m'?parseFloat(Math.pow(10,-3)):
					(res=='u'?parseFloat(Math.pow(10,-6)):
					(res=='n'?parseFloat(Math.pow(10,-9)):
					(res=='p'?parseFloat(Math.pow(10,-12)):1))))));
	  } else {
	    res=parseFloat(a);
	  }
	  return res;
	}
	
	function unit_format(a){
	   var res=a;
	   var p=4;//precision
	   if (a>-1){
	   if (a>=1000000){
		    res=Math.round(a*Math.pow(10,p))/Math.pow(10,p+6)+'M';
	   } else if (a>=1000){
		    res=Math.round(a*Math.pow(10,p))/Math.pow(10,p+3)+'k';
	   } else if (a>=1){
		    res=Math.round(a*Math.pow(10,p))/Math.pow(10,p);	   
	   } else if (a>=Math.pow(10,-3)){
		    res=Math.round(a*Math.pow(10,3+p))/Math.pow(10,p)+'m';	   
	   } else if (a>=Math.pow(10,-6)){
		    res=Math.round(a*Math.pow(10,6+p))/Math.pow(10,p)+'u';	   
	   } else if (a>=Math.pow(10,-9)){
		   p=6;
		   res=Math.round(a*Math.pow(10,6+p))/Math.pow(10,p)+'u';	   
	       res=res + ' ou ' + Math.round(a*Math.pow(10,9+p))/Math.pow(10,p)+'n';	   
	   } else {
		   p=8;
		   res=Math.round(a*Math.pow(10,6+p))/Math.pow(10,p)+'u';	   
	       res=res + ' ou ' + Math.round(a*Math.pow(10,9+p))/Math.pow(10,p)+'n';	   
	       res=res + ' ou ' + Math.round(a*Math.pow(10,12+p))/Math.pow(10,p)+'p' ;	   
	   }
	   }
	  return res;
	}
	
	function resistances_en_serie(a,b){
	  return parseFloat(a)+parseFloat(b);
	}
	function getValueOfParallelResistor(a,b){
	  var v_a=parseFloat(a);
	  var v_b=parseFloat(b);
	  if (v_a==v_b){
	    return v_a/2;
	  } else {
	    return ((v_a*v_b)/(v_a+v_b));
	  }
	}
	
	function condensateurs_en_parallele(a,b){
	  return parseFloat(a)+parseFloat(b);
	}
	function condensateurs_en_serie(a,b){
	  var v_a=parseFloat(a);
	  var v_b=parseFloat(b);
	  if (v_a==v_b){
	    return v_a/2;
	  } else {
	    return ((v_a*v_b)/(v_a+v_b));
	  }
	}
	</script>
<!--Effets graphique et animations-->
	<script>
	var anim={};
	var last_shown='';
	var current_interval=0;
	
	function shake(elem_id){
	  if (!(elem_id in anim)){
	    var elem=document.getElementById(elem_id);
	    anim[elem_id]=elem.className;
	    setTimeout(function(){
		elem.className=anim[elem_id]+" rotate_item_shake";
	      },0);
	    setTimeout(function(){
		elem.className=anim[elem_id];
	      },100);
	    setTimeout(function(){
		elem.className=anim[elem_id]+" rotate_item_shake";
	      },200);
	    setTimeout(function(){
		elem.className=anim[elem_id];
		delete anim[elem_id];
	      },300);
	  }
	}
	function hurt(elem_id){
	  if (!(elem_id in anim)){
	    var elem=document.getElementById(elem_id);
	    anim[elem_id]=elem.className;
	    setTimeout(function(){
		elem.className=anim[elem_id]+" rotate_item_hurt1";
	      },0);
	    setTimeout(function(){
		elem.className=anim[elem_id]+" rotate_item_hurt2";;
	      },100);
	    setTimeout(function(){
		elem.className=anim[elem_id]+" rotate_item_hurt3";
	      },200);
	    setTimeout(function(){
		elem.className=anim[elem_id]+" rotate_item_hurt4";
	      },300);
	    setTimeout(function(){
		elem.className=anim[elem_id]+" rotate_item_hurt5";
	      },400);
	    setTimeout(function(){
		elem.className=anim[elem_id];
		delete anim[elem_id];
	      },500);
	  }
	}
	function blink_data(elem_id,time1,class1,time2,class2,timeinterval){
	    if(current_interval>0){
	      unblink();
	    }
	    var elem=document.getElementById(elem_id);
	    var orig_class=elem.className;
	    //~ console.log(orig_class);
	    current_interval=setInterval(function (){
			  setTimeout(function(){
				elem.className=orig_class+((class1.length>0)?("( "+class1):"");
			    },time1);
			  setTimeout(function(){
				elem.className=orig_class+((class2.length>0)?("( "+class2):"");
			    },time2);
			},timeinterval);
	}
	function unblink(){
	    clearInterval(current_interval);
	    current_interval=0;
	}
	function switch_app(elem_id){
		if (last_shown!=elem_id){
			if (last_shown!=''){
				document.getElementById(last_shown).style.display='none';
				document.getElementById('nav_'+last_shown).className='inactive';
			}
			document.getElementById(elem_id).style.display='inline-block';
			document.getElementById('nav_'+elem_id).className='active';
			last_shown=elem_id;
			
		}
	}
	
	function switch_class(array_id_a,class_a,array_id_b){
		var idx;
		for (idx=0;idx<array_id_a.length;idx++) {
			document.getElementById(array_id_a[idx]).className=document.getElementById(array_id_a[idx]).className+' '+class_a;
		}
		for (idx=0;idx<array_id_b.length;idx++) {
			document.getElementById(array_id_b[idx]).className=document.getElementById(array_id_b[idx]).className.replace(' '+class_a,"");
		}		
	}
	</script>

    <script>
	<!--(Pour le calcul des combinaisons)-->
	<!-- Important note : this program use the concept of stock, 2 type of stock are used:
	<!-- 	- simple stock represents the reserves
	<!-- 	- computed stock represents all combinations possibles
	<!--
	<!-- Moreover the stock contains the value of the componants represented by the different formula (or set of componants) avaible :
	<!--     { "formula1" : {"componant1":qte,"componant2":qte}, "formula2" : {"componant3":qte,"componant2":qte} }
	<!-- So we have set of value associated to a set of set of componants.
	<!--	
	<!-- Here the structure of the stock concept.
	<!--   simple stock = { value1 : { "componant1" : {"componant1":qte}},
	<!--             	value2 : { "componant2" : {"componant2":qte}},... }
	<!--   computed stock = { value1 : { "formula1" : {"componant1":qte,"componant2":qte}},
	<!--             value2 : { "formula2" : {"componant1":qte,... }},"formula3" : {"componant1":qte,... }},... }
	-->
	
	<!--stock related functions-->
	function formula_copy(a){
	  var res={'_nb_':0};
	  var v_k;
	  for (v_k in a){
	    if (v_k!='_nb_'){
	      res[v_k]=a[v_k];
	      res['_nb_']=res['_nb_']+a[v_k];
	    }
	  }
	  return res;
	}

	function formula_set_copy(a){// input : 1 set of formulas 
	  var res={};
	  var v_k;
	  for (v_k in a){
	    res[v_k]=formula_copy(a[v_k]);
	  }
	  return res;
	}

	function formula_union(a,b){// input : 2 formulas
	  var res=formula_copy(a);
	  var v_k;
	  for (v_k in b){
	    if (v_k!='_nb_'){
	      if (v_k in res){
		  res[v_k]=res[v_k]+b[v_k];
	      } else {
		  res[v_k]=b[v_k];
	      }
	      res['_nb_']=res['_nb_']+b[v_k];
	    }
	  }
	  return res;
	}

	function formula_equal(a,b){// input : 2 formulas
	  if (a['_nb_']!=b['_nb_']){
	    return false;
	  }
	  var v_k;
	  for (v_k in a){
	    if ((!v_k in b) || (a[v_k]!=b[v_k])){
	      return false;
	    }
	  }
	  return true;
	}
	
	function exist_equal_formula(a,b){//input : b is a set of formulas,  "a" is a formula {"componant1":qte,"componant2":qte}
	  for (var f in b){
	      if (formula_equal(a,b[f])){
		return true;
	      }
	  }
	  return false;
	}
	
	function test_a_in_stock_b(a,b){//input : "b" is a stock, "a" is a formula {"componant1":qte,"componant2":qte}
	  var v;
	  for (var k in a){
	    if (k!='_nb_'){
	      v=parseInt(parse_input(k));
	      if (!(v in b)  || (a[k] > b[v][k][k])) {
		return false;
	      }
	    } 
	  }
	  return true
	}
	
	function need_better_solution(a,max_qte){// input : { "formula1" : {"componant1":qte,"componant2":qte,'_nb_':x}, "formula2" : ...}
	  var i=0;
	  for (var k in a){
	      if ( a[k]['_nb_'] < (max_qte/2) + 1 ) {//minimum number of components wished is under half of the max quantity
		i++;
		if (i==3){
		  return false;
		}
	      }
	  }
	  return true;
	}
	function remove_useless_solutions(a){// input : { "formula1" : {"componant1":qte,"componant2":qte,'_nb_':x}, "formula2" : ...}
	  var i=0;
	  var nb_solution=[];
	  for (var k in a){
	      nb_solution[i]=[a[k]['_nb_'],k];
	      i++;
	  }
	  if (i>3){
	    nb_solution.sort(function(a,b){return a[0]-b[0];});
	    while (i>3){
	      delete a[nb_solution.pop()[1]];
	      i--;
	    }
	  }
	  return a;
	}
	
	<!-- functions to prepare all possible results of combinations -->
	function populateCombineStock(t_stock,orig_stock,func_combi,symb_combi,max_qte){
	    //~ console.log(t_stock,orig_stock,func_combi,symb_combi,max_qte);
	    var v;
	    var res={};
	    var formula;
	    var formula_stock={};
	    for (var k in t_stock) {
	      if (k!="_nb_"){
		res[Math.round(k*100)/100]=formula_set_copy(t_stock[k]);
	      }
	    }
	    for (var h in t_stock) {  for (var k in t_stock[h]) {
	      for (var i in t_stock) { for (var j in t_stock[i]){
		v=Math.round(func_combi(h,i)*100)/100;
		//~ if((!(v in res))||(need_better_solution(res[v],max_qte))){
		//~ if((!(v in res))||(need_better_solution(res[v],max_qte))){
		  formula_stock=formula_union(t_stock[h][k],t_stock[i][j]);
		  if ( (formula_stock['_nb_']<=max_qte) &&
		    test_a_in_stock_b(formula_stock,orig_stock) ){
		      formula='('+k+' '+symb_combi+' '+j+')';
		      if(!(v in res)){
			res[v]={};
			res[v][formula]=formula_stock;
		      } else if (!exist_equal_formula(formula_stock,res[v])){
			res[v][formula]=formula_stock;
			res[v]=remove_useless_solutions(res[v]);
		      }
		  }
		//~ }
	      }}
	    }}
	    return res;
	}
	function build_stock(stock_txt,is_root_stock){
	  var i;
	  var v_nb;
	  var v_k;
	  var k;
	  var qte;
	  var stock={'_nb_':0};//all components avaible with their quantity
	  var stock_parse_tab=stock_txt.split(" ");
	  for (i=0; (i <stock_parse_tab.length); i++){
	    //~ console.log(stock_parse_tab[i]);
	    k=stock_parse_tab[i];
	    qte=parseInt(k.replace(/(.*\{)/,'').replace(/(\})/,''));
	    k=k.replace(/(\{.*)/,'');
	    if (is_root_stock){// is a stock for search component and combinations
	      stock['_nb_']=stock['_nb_']+qte;
	      
	      v_k=parse_input(k);
	      if (!(v_k in stock)){
		stock[v_k]={};
	      }
	      if (k in stock[v_k]){
		   stock[v_k][k][k]=stock[v_k][k][k]+qte;
	      } else {
		  stock[v_k][k]={'_nb_':qte};
		  stock[v_k][k][k]=qte;
	      }
	      
	    } else {// is a formula to compute
	      stock['_nb_']=stock['_nb_']+qte;
	      stock[k]=(k in stock)?stock[k]+qte:qte;
	    }
	  }
	  return stock;
	}
	
	function calcul_combinaisons(max_qte){
	  // stocks representation
	  var stock=build_stock(document.getElementById('my_stock_resistor').value,true);
	  var init_set={'_nb_':0};//representation all components avaible without their quantity
	  //values to iterate
	  var v_k;
	  var k;
	  var i;
	  for (v_k in stock){
	    if (init_set['_nb_'] < 32){// for best perfomance we limit the number of different resistor
	      i=0;
	      for (k in stock[v_k]){
		  if (i<3){
		  init_set['_nb_']=init_set['_nb_']+1;
		  init_set[v_k]={};
		  init_set[v_k][k]={};
		  init_set[v_k][k]['_nb_']=1;
		  init_set[v_k][k][k]=1;
		  i++;
		  }
	      }
	    } else { break ; }
	  }
	  //~ console.log(stock);
	  //~ console.log(init_set);
	  // build combinations
	  var comb_serial_set=populateCombineStock(init_set,stock,resistances_en_serie,'+',max_qte);
	  var comb_parallel_set=populateCombineStock(comb_serial_set,stock,getValueOfParallelResistor,'//',
	  (init_set['_nb_']>10)?2:max_qte);// for best perfomance we limit the number of combinations
	  //~ console.log(comb_parallel_set);
	  return populateCombineStock(comb_parallel_set,stock,resistances_en_serie,'+',max_qte);
	}
	function ParseRecomputeFormula(formule,f_stock){
	  var res=formule;
	  res=res.replace(/(^|[ \(\/\+])([0-9.]+([kmMnup][0-9]*)?(\[[a-z0-9.,]*\])?)/ig,
	      function(x,y,z){
				  //~ console.log('xyz get values->',x,y,z,'=',f_stock[z]);
				  return y.concat(f_stock[z]);
			    }
	  );
	  while (/\([\s]*([0-9.]+)[\s]*(\/\/|\+)[\s]*([0-9.]+)[\s]*\)/.test(res)){
	    res=res.replace(/\([\s]*([0-9.]+)[\s]*\/\/[\s]*([0-9.]+)[\s]*\)/g,
		function(x,y,z){
				    //~ console.log('xyz compute parrallel->',x,y,z,'=',getValueOfParallelResistor(y,z));
				    return getValueOfParallelResistor(y,z);
		}
	      ).replace(/\([\s]*([0-9.]+)[\s]*\+[\s]*([0-9.]+)[\s]*\)/g,
		function(x,y,z){
		  
				    //~ console.log('xyz compute serial->',x,y,z,'=',resistances_en_serie(y,z));
				    return resistances_en_serie(y,z);
		}
	      );
	  }
	  return parseFloat(res);
	}

	function getMinMaxValuesOfGroup(formula,formula_stock){
	  var min_val_stock={};
	  var max_val_stock={};
	  var tol;
	  var val;
	  var tab_desc;
	  for (var c in formula_stock){
	      if (c=="_nb_"){
		  continue;
	      }
	      if (!(c in min_val_stock)) {
		tol="";
		if (c.indexOf("[")>0){ 
		  tab_desc=get_tab_desc_in_desc(c);
		  val=compute_value(tab_desc[0],tab_desc[1],tab_desc[2],tab_desc[3],tab_desc[4],tab_desc[5]);
		  tol=tab_desc[4];
		} else {
		  val=parse_input(c);
		}
		if (tol==""){
		  min_val_stock[c]=val;
		  max_val_stock[c]=val;
		} else {
		  //~ console.log(c,tab_desc,val,tol,parseFloat(tol)*val);
		  min_val_stock[c]=(val-(parseFloat(tol)*val));
		  max_val_stock[c]=(val+(parseFloat(tol)*val));
		}
	      }
	  }
	  return [ParseRecomputeFormula(formula,min_val_stock),ParseRecomputeFormula(formula,max_val_stock)];
	}
	<!-- functions to find bests results of combinations -->
	function SearchGroup(v_resistance,v_ecart,stock){
	  var res=[];
	  var i=0;
	  var diff;
	  var min_val_stock={};
	  var max_val_stock={};
	  var min_max_val_tab;
	  var val;
	  var tab_desc;
	  var tol;
	  for (var k in stock) {
	      //~ console.log(k,stock[k],v_ecart);
	      var diff=Math.abs(k - v_resistance );
	      if ( diff <= v_ecart ){
		for (var formula in stock[k]){
		  //~ console.log(k,stock[k],formula,v_ecart);
		  if (formula.indexOf("[")>0) {
		    min_max_val_tab=getMinMaxValuesOfGroup(formula,stock[k][formula]);
		    diff=Math.abs(min_max_val_tab[0] - v_resistance );
		    var diff_max=Math.abs(min_max_val_tab[1] - v_resistance );
		    if(diff<diff_max){
			diff=diff_max;
		    }
		  }
		  if ( diff <= v_ecart ){ 
		    res[i]=[Math.round(k),formula,Math.round(diff)];
		    i++;
		  }
		}
	      }
	  }
	  //~ console.log(res);
	  res.sort(function(a, b){return a[2]-b[2]})
	  return res;
	}
    </script>
<!---->
<!--Déchiffrage d'une résistance-->
<script>
	//memory for last activated buttons
  	var last_button={
	  'mode':[],
	  'mult':[],
	  'val1':[],
	  'val2':[],
	  'val3':[],
	  'tol':[],
	  'pow':[],
	  'pkg':[],
	  'pkg_color':[]
	  };
	//
	var my_component={};
        var my_component_mode;
	//mode values
    var PKG_ID_TO_CHAR={
       'PACKAGE_RING':'r',
       'PACKAGE_BOBINE':'b',
       'PACKAGE_CMS':'s',
       'PACKAGE_CERAMIC':'c',
       'PACKAGE_ELECTROLYTIC':'e',
       'PACKAGE_PLASTIC':'p'};
    var PKG_ID_TO_MODE={
       'PACKAGE_RING':3,//>=3
       'PACKAGE_BOBINE':1,//1
       'PACKAGE_CMS':2,//2
       'PACKAGE_CERAMIC':2,//2
       'PACKAGE_ELECTROLYTIC':1,//1
       'PACKAGE_PLASTIC':1};//1
    var PKG_ID_TO_TYPE={
       'PACKAGE_RING':'RESISTOR',
       'PACKAGE_BOBINE':'RESISTOR',
       'PACKAGE_CMS':'RESISTOR',
       'PACKAGE_CERAMIC':'CAPACITOR',
       'PACKAGE_ELECTROLYTIC':'CAPACITOR',
       'PACKAGE_PLASTIC':'CAPACITOR'};
    var PKG_CHAR_TO_VALUE={
       'r':PACKAGE_RING,//>=3
       'b':PACKAGE_BOBINE,//1
       's':PACKAGE_CMS,//2
       'c':PACKAGE_CERAMIC,//2
       'e':PACKAGE_ELECTROLYTIC,//1
       'p':PACKAGE_PLASTIC};//1
    // body colors for RING resistor      
      var PKG_COLOR_CHAR_TO_ID;
      var PKG_COLOR_ID_TO_CHAR={
      'RESISTOR_CARBON':'C',
      'RESISTOR_METAL_BLUE':'B',
      'RESISTOR_METAL_GREEN':'V',
      'RESISTOR_METAL_RED':'R',
      'CAPACITOR_PINK':'P',
      'CAPACITOR_GREEN':'G'};
	// RESISTOR with rings mode=number of rings
	//  norme CEI 60757 pour les codes valeurs
	var color_tab_val={"":"cei_color_None",
			    0:"cei_color_Black",
			    1:"cei_color_Brown",
			    4:"cei_color_Yellow",
			    7:"cei_color_Violet",
			    2:"cei_color_Red",
			    5:"cei_color_Green",
			    8:"cei_color_Gray",
			    3:"cei_color_Orange",
			    6:"cei_color_Blue",
			    9:"cei_color_White"};
			    
	var color_tab_mult={"":"cei_color_None",
			    0.1:"cei_color_Gold",
			    0.01:"cei_color_Silver",
			    1:"cei_color_Black",
			    10:"cei_color_Brown",
			    100:"cei_color_Red",
			    1000:"cei_color_Orange",
			    10000:"cei_color_Yellow",
			    100000:"cei_color_Green",
			    1000000:"cei_color_Blue",
			    10000000:"cei_color_Violet"};
	var color_tab_tolerance={"":"cei_color_None",
				  0.20:"cei_color_Transparent",
				  0.10:"cei_color_Silver",
				  0.05:"cei_color_Gold",
				  0.01:"cei_color_Brown",
				  0.02:"cei_color_Red",
				  0.005:"cei_color_Green",
				  0.0025:"cei_color_Blue",
				  0.001:"cei_color_Violet"};
	var color_tab_corps={"":"cei_color_None",
				  'RESISTOR_CARBON':"cei_color_Beige",
				  'RESISTOR_METAL_BLUE':"cei_color_Cyan",
				  'RESISTOR_METAL_GREEN':"cei_color_Green",
				  'RESISTOR_METAL_RED':"cei_color_Red",
				  'CAPACITOR_PINK':"cei_color_Pink",
				  'CAPACITOR_GREEN':"cei_color_CapGreen"};
	//
	function reverse_dict(dict){
	  var res={};
	   for (var k in dict){
	      res[dict[k]]=k;
	  }
	  return res;
	}
	function init_decoder_tool(){
	  var elems;


	  PKG_COLOR_CHAR_TO_ID=reverse_dict(PKG_COLOR_ID_TO_CHAR);
	  
	  elems=document.getElementsByName('PKG_COLOR');
	  for (var i = 0, length = elems.length; i < length; i++) {
	    elems[i].className=color_tab_corps[elems[i].id];
	    elems[i].setAttribute('onClick','corps_set("'+elems[i].id+'")');
	  }
	  elems=document.getElementsByName('PACKAGE');
	  for (var i = 0, length = elems.length; i < length; i++) {
	    elems[i].setAttribute('onClick','package_set("'+elems[i].id+'")');
	  }

	  package_set('PACKAGE_RING');
	}
	init_decoder_tool();
	function get_resistor_desc(){
	  var desc="";
	  if (my_component_mode>2){
	    desc=desc.concat(
	    ('val1' in my_component) ? my_component['val1']:"",
	    ",",('val2' in my_component) ? my_component['val2']:"",
	    ",",('val3' in my_component) ? my_component['val3']:"",
	    ",",('mult' in my_component) ? (my_component['mult']+'').replace(/000000$/,'M').replace(/000$/,'k'):"",
	    ",",('tolerance' in my_component) ? my_component['tolerance']:"",
	    ",",('corps' in my_component) ? my_component['corps']:"c");
	  } else if (my_component_mode==PACKAGE_CMS){
	    desc=desc.concat(
	    ('val1' in my_component) ? my_component['val1']:" ",
	    ('val2' in my_component) ? my_component['val2']:" ",
	    ('val3' in my_component) ? my_component['val3']:" ");
	  } else if (my_component_mode==PACKAGE_BOBINE){
	    desc=desc.concat(unit_format(get_resistor_value()),
	    ",",('pow' in my_component) ? my_component['pow']:" ",
	    ",",('tolerance' in my_component) ? my_component['tolerance']:"");
	    
	  }
	  return desc;
	}
	function compute_value(val1,val2,val3,mult,tolerance,type){
	  var val="";
	  if (val1.length>0) {
	    val=parseInt(val1);
	    if (val2.length>0) {
	      val=(val*10)+parseInt(val2);
	    }
	    if (val3.length>0) {
	      if (type=="s"){
		val=val*Math.pow(10,val3);
	      } else {
		val=(val*10)+parseInt(val3);
	      }
	    }
	    if (mult.length>0){
	      val=val*parseFloat(mult);
	    }
	  }
	  //~ console.log(val1,val2,val3,mult,tolerance,type,'->',val)
	  return val;
	}
	function get_resistor_value(){	  
	  return compute_value(
		  ('val1' in my_component)?""+my_component['val1']:"",
		  ('val2' in my_component)?""+my_component['val2']:"",
		  ('val3' in my_component)?""+my_component['val3']:"",
		  ('mult' in my_component)?""+my_component['mult']:"",
		  ('tol' in my_component)?""+my_component['tol']:"",
		  (my_component_mode==PACKAGE_CMS)?"s":""
		  );
	}
	function format_component_value_with_tolerance(val,lettre,unite){
	  if ('tolerance' in my_component){
	      var tol=val*my_component['tolerance'];
	      val=unit_format(val-tol) + ' <small>'+ unite +
	      '</small> &le; ' + lettre +' &le; '+
	      unit_format(val+tol) +' <small>'+unite+'</small>';
	  }
	  else{
	      val=lettre + '= ' +unit_format(val) +' <small>'+ unite+'</small>';
	  }
	  return val;
	}
	function get_resistor_ref(){
	  return unit_format(get_resistor_value()).concat('[',get_resistor_desc(),']');
	}
	function get_value_from_tab_desc(tab_desc){//tab_desc format=[val1,val2,val3,mult,tolerance,type];
	  return compute_value(tab_desc[0],tab_desc[1],tab_desc[2],tab_desc[3],tab_desc[4],tab_desc[5]);
	}
	function get_cei_color_tab(desc){
	  var color_tab=['cei_color_None',
			  'cei_color_None',
			  'cei_color_None',
			  'cei_color_None',
			  'cei_color_None',
			  'cei_color_None'];
	  
	  var tab_desc=get_tab_desc_in_desc(desc);
	  color_tab[0]=color_tab_val[tab_desc[0]];
	  color_tab[1]=color_tab_val[tab_desc[1]];
	  color_tab[2]=color_tab_val[tab_desc[2]];
	  color_tab[3]=color_tab_mult[tab_desc[3]];
	  color_tab[4]=color_tab_tolerance[tab_desc[4]];
	  color_tab[5]=color_tab_corps[tab_desc[5]];
	  return color_tab;
	}
	
	function get_tab_desc_in_desc(desc){//tab_desc format=[val1,val2,val3,mult,tolerance,type];
	  //R[v,v,v,m,t] pour les résistances à bandes
	  //R[vvvm,P,t] pour les résistances bobinées
	  //R[vvm] pour les résistances CMS
	  var pos1=desc.indexOf('[');
	  var pos2=desc.indexOf(']',pos1);
	  var v_desc=((pos1 > -1) &&(pos2 > -1))?desc.substring(pos1+1,pos2):desc;
	  var tab_desc;
	  if (/^[0-9]{3}$/.test(v_desc)){//Type = CMS
	    tab_desc=[v_desc.charAt(0),v_desc.charAt(1),v_desc.charAt(2),"","0","s"];
	  } else {
	    var def;
	    var tab_val=[];
	    tab_desc=v_desc.split(',');
	    //~ console.log(desc,tab_desc);
	    if (/^[0-9.]+[kmMnup]*,[0-9.]+W,[0-9.]+$/i.test(v_desc)){//Type = Bobine
	      tab_desc[4]=tab_desc[2];
	      tab_desc[6]=tab_desc[1];
	      def=["0","","","1","0.01","b","1W"];
	    } else {//Type = ring (we assume we don't need to get the desc of others resistor types)
	      def=["0","","","1","0.01","c",""];
	    }
	    for (var i=0; i<def.length;i++){//set default if not defined
	      if ((tab_desc.length<i+1) || (!(i in tab_desc)) || (tab_desc[i]=="")){
		  tab_desc[i]=def[i];
	      }
	    }
	    if (tab_desc[0].length>1){
	      pos1=tab_desc[0].search(/(k|m)/);
	      pos1=((pos1==-1) && (tab_desc[0].length>3))? 3 : pos1;
	      tab_desc[1]=(pos1>1)? tab_desc[0].charAt(1):"";
	      tab_desc[2]=(pos1>2)? tab_desc[0].charAt(2):"";
	      if (pos1>0){
		if ((/^[0]*[kmMnup]$/).test(tab_desc[0].substr(pos1))){
		  tab_desc[3]="1".concat(tab_desc[0].substr(pos1));
		} // else there is an hybrid notation like 7k4 for 7400
	      }
	      tab_desc[0]=tab_desc[0].charAt(0);
	    } 
	    if (tab_desc[3].length>1){
	      tab_desc[3]=tab_desc[3].replace('k','000').replace('M','000000');
	    }
	  }
	  return tab_desc;
	}
	function my_component_is_complete(){
	   return ( ('val1' in my_component) &&
	    (('val2' in my_component)||((my_component_mode!=PACKAGE_CMS)&&(my_component_mode<4))) &&
	    (('val3' in my_component)||((my_component_mode!=PACKAGE_CMS)&&(my_component_mode<5))) &&
	    (('mult' in my_component)||(my_component_mode==PACKAGE_CMS)) &&
	    (('tolerance' in my_component)||(my_component_mode==PACKAGE_CMS)) &&
	    (('pow' in my_component)||(my_component_mode!=PACKAGE_BOBINE)) );
	}
	function update_value(do_store){
	  var desc=get_resistor_desc();
	  //~ var desc_field_id=(my_component_mode>2)?'resistor_desc':(my_component_mode==PACKAGE_BOBINE)?'bobine_resistor_desc':'cms_resistor_desc';
	  var desc_field_id='component_desc';
	  //~ var value_field_id=(my_component_mode>2)?'resistor_value':(my_component_mode==PACKAGE_BOBINE)?'bobine_resistor_value':'cms_resistor_value';
	  var value_field_id='component_value';
	  document.getElementById(desc_field_id).value=desc;
	  if (my_component_is_complete() && do_store){
	    var ref=get_resistor_ref();
	    if (is_acceptable(ref)){
	      document.getElementById('my_stock_resistor').value=document.getElementById('my_stock_resistor').value.concat(" ",ref);
	      return true;
	    }
	  } else {
	    var val=get_resistor_value();
	    document.getElementById(value_field_id).innerHTML=( val != "" )?(
		  format_component_value_with_tolerance(val,'R','Ohm')):"?";
	    document.getElementById('stock_add_btn').disabled=( !(my_component_is_complete()) );
	    document.getElementById('stock_add_btn').className=( my_component_is_complete() )?'':'button_disabled';
	  }
	  return false;
	}
	function mode_get(){
		return my_component_mode;
	}
	function mode_set(val){
	  my_component_mode=val;
	  document.getElementById('mult').style.visibility = ((val>2)||(val==PACKAGE_BOBINE)) ? 'visible' :'hidden';
	  document.getElementById('tol').style.visibility = ((val>2)||(val==PACKAGE_BOBINE)) ? 'visible' :'hidden';
	  document.getElementById('nb_ring').style.visibility = (val>2) ? 'visible' :'hidden';
	  document.getElementById('pkg_color').style.visibility = (val>2) ? 'visible' :'hidden'; 
	  document.getElementById('value1').style.visibility = (((val>2)||(val<=2)) ? 'visible' :'hidden');
	  document.getElementById('value2').style.visibility = (((val>3)||(val<=2)) ? 'visible' :'hidden');
	  document.getElementById('value3').style.visibility = (((val>4)||(val<=2)) ? 'visible' :'hidden');
	  document.getElementById('coef-temp').style.visibility = ((val>5) ? 'visible' :'hidden');
	  document.getElementById('pow').style.visibility = ((val==PACKAGE_BOBINE) ? 'visible' :'hidden');
	  document.getElementById('view_val2').style.visibility=((val>3) ? 'visible' :'hidden');
	  document.getElementById('view_val3').style.visibility=((val>4) ? 'visible' :'hidden');
	  document.getElementById('view_ppm').style.visibility=((val>5) ? 'visible' :'hidden');
	  
		if (val<6){
			document.getElementById('view_ppm').className="cei_color_None";
			if (val<5){
			  document.getElementById('view_val3').className="cei_color_None";
			  delete my_component.val3;
			  if (val<4){
				document.getElementById('view_val2').className="cei_color_None";
				delete my_component.val2;
			  }
			  if (val==PACKAGE_CMS){
				delete my_component.tolerance;
				delete my_component.mult;
			  }
			}
		}
		if (val>2){
			switch_class(['nba'+val],'active',last_button['mode']);
			last_button['mode'][0]='nba'+val;
		}
		  update_value();
	}
	<!--Setters-->
	function val1_set(val){
	  if (my_component_mode>2){
	    document.getElementById('view_val1').className=color_tab_val[val];
	  }
	  set_my_component('val1',val);
	}
	function val2_set(val){
	  if (my_component_mode>2){
	    document.getElementById('view_val2').className=color_tab_val[val];
	  }
	  set_my_component('val2',val);
	}
	function val3_set(val){
          if (my_component_mode>2){
			document.getElementById('view_val3').className=color_tab_val[val];
		  }
          set_my_component('val3',val);
	}
        function mult_set(val){
          document.getElementById('view_mult').className=color_tab_mult[val];
          set_my_component('mult',val);
        }
        var tolerance_set_last_button=[];
        function tolerance_set(val){
          document.getElementById('view_tol').className=color_tab_tolerance[val];
          set_my_component('tolerance',val);
        }
        function pow_set(val){
          set_my_component('pow',val+'W');
          var tmpid='pow'+(val+'').replace('.','_');
          switch_class([tmpid],'active',last_button['pow']);
	  last_button['pow'][0]=tmpid;
          
        }
        function package_set(val){
	  set_my_component('package',PKG_ID_TO_CHAR[val]);
	  if (val=='PACKAGE_RING'){
		mode_set(4);
	  } else {
	      mode_set(PKG_ID_TO_MODE[val]);
	      set_my_component('type',PKG_ID_TO_TYPE[val]);
	  }
	  switch_class([val],'active',last_button['pkg']);
	  last_button['pkg'][0]=val;
        }
        function corps_set(val){
	  if (my_component_mode>2){
		 document.getElementById('resistor_body').className="resistor_view "+color_tab_corps[val];
	  }
	  set_my_component('type',val.match(/^(CAPACITOR|RESISTOR)/)[0]);
          set_my_component('corps',PKG_COLOR_ID_TO_CHAR[val]);

	  switch_class([val],'active',last_button['pkg_color']);
	  last_button['pkg_color'][0]=val;
        }
        function ppm_set(val,view_class){
          document.getElementById('view_ppm').className=view_class;
        }
	function set_my_component(key,val){
	  unblink();
	  //~ console.log(key,val);
	  my_component[key]=val;
	  update_value();
	}
	</script>
<!--Pour la gestion du stock-->
      <script>
	function add_to_stock(data) {
	    document.getElementById('my_stock_resistor').value=document.getElementById('my_stock_resistor').value.concat(" ",data);
	    //~ console.log(document.getElementById('my_stock_resistor').value);
	    updateStock();
	}
	function secure_data(data){
	  return data.replace(/</g,'&lt;').replace(/>/g,'&gt;');
	}
	function is_standard(data){
	  //~ console.log(data,data.search(/^[0-9]+[kmMnup]?\[[0-9],[0-9]*,[0-9]*,[0-9]+[kmMnup]?,[a-z0-9.]*(,[a-z0-9.]*)?\]$/i));
	  return (/^[0-9.]+([kmMnup][0-9]*)?\[[0-9],[0-9]*,[0-9]*,[01.]+[kmMnup]?,[a-z0-9.]*(,[a-z0-9.]*)?\]$/i).test(data);
	}
	function get_standard_mode(data){
	  var tab_desc=get_tab_desc_in_desc(data);
	  var mode=3;
	  if (tab_desc[1]!=""){
	    mode=4;
	  }
	  if (tab_desc[2]!=""){
	    mode=5;
	  }
	  if (tab_desc[6]!=""){
	    mode=6;
	  }
	  return mode;
	}
	function is_bobine_resistor(data){
	  return (/^[0-9.]+([km][0-9]*)?\[[0-9.]+([kmMnup][0-9]*)?,[0-9.]*w(,[a-z0-9.]*)?\]$/i).test(data);
	}
	function is_cms_resistor(data){
	  return (/^[0-9.]+([km][0-9]*)?\[[0-9]{3}\]$/i).test(data);
	}
	function is_acceptable(data){
	  return (/^[0-9.]+([km][0-9]*)?(\[[a-z0-9.,]*\])?$/i).test(data);
	}
	function format_for_acceptable(data){
	  return data.replace(/(^|$)/g,' ').replace(/ [^0-9 ]+[^ ]* /,' ');
	}
	function is_valid_stock(inputField){
	  var isValid = (/^(\s)*[0-9.]+([kmMnup][0-9]*)?(\[[a-z0-9.,]*\])?(\{[0-9]+\})?((\s)*[0-9.]+([kmMnup][0-9]*)?(\[[a-z0-9.,]*\])?(\{[0-9]+\})?)*(\s)*$/i).test(inputField.value);

	  if (isValid) {
	      inputField.style.backgroundColor = '#bfa';
	  } else {
	      inputField.style.backgroundColor = '#fba';
	  }

	  return isValid;
	}
	function remove_operators(data){
	  return data.replace(/(\(|\)|\+|\/\/)+/g," ").replace(/(\s)+/g," ").replace(/(^\s|\s$)/g,"");
	}
	function reformat_stock(v_stock){
	  var stock_parse_tab=format_for_acceptable(secure_data(remove_operators(v_stock))).split(" ");
	  var v_stock_hash={};
	  var i;
	  var k;
	  var qte;
	  for (i=0; (i <stock_parse_tab.length); i++){
	      k=stock_parse_tab[i];
	      if (k.search('{')>0){
		qte=parseInt(k.replace(/(.*\{)/,'').replace(/(\})/,''));
		k=k.replace(/(\{.*)/,'');
	      } else {
		qte=1;
	      }
	      if (k in v_stock_hash){
		v_stock_hash[k]=v_stock_hash[k]+qte;
	      } else {
		v_stock_hash[k]=qte;
	      }
	  }
	  v_stock="";
	  delete v_stock_hash[''];
	  for (k in v_stock_hash){
	    v_stock=v_stock.concat(k,"{",v_stock_hash[k],"} ");
	  }
	  return v_stock.replace(/(^\s|\s$)/g,"");
	}
	function reformat_input_stock(){
	   document.getElementById('my_stock_resistor').value=reformat_stock(document.getElementById('my_stock_resistor').value);
	   document.getElementById('my_stock_capacitor').value=reformat_stock(document.getElementById('my_stock_capacitor').value);
	}
	function make_view_from_formatted_input_stock(){
		make_view_from_formatted_stock('my_stock_resistor','stock_view_resistor');
		make_view_from_formatted_stock('my_stock_capacitor','stock_view_capacitor');
	}
	function make_view_from_formatted_stock(stock_txt_id,stock_view_id){
	  var stock_parse_tab=document.getElementById(stock_txt_id).value.split(" ");
	  var i;
	  var k;
	  var qte;
	  var node=document.getElementById(stock_view_id);
	  while (node.hasChildNodes()) {
	    node.removeChild(node.lastChild);
	  }
	  for (i=0; (i <stock_parse_tab.length); i++){
	      k=stock_parse_tab[i];
	      qte=parseInt(k.replace(/(.*\{)/,'').replace(/(\})/,''));
	      k=k.replace(/(\{.*)/,'');
	      if (k!=""){
			  
			node.appendChild(get_component_view(k,qte));
	      }
	  }
	}
	
	function makeViewFromFormattedTakenStock(){
	  var stock_parse_tab=document.getElementById('my_stock_resistor_pris').value.replace(
	  /\(\s*/g,"(").replace(
	  /\s*\)/g,")").replace(
	  /\s*\+\s*/g,"+").replace(
	  /\s*\/\/\s*/g,"//").split(" ");
	  var i;
	  var formula;
	  var formula_stock;
	  var value_min_max_tab;
	  var formula_value;
	  var formula_tol;
	  
	  var node=document.getElementById('taken_stock_view_resistor');
	  while (node.hasChildNodes()) {
	    node.removeChild(node.lastChild);
	  }
	  
	  for (i=0; (i <stock_parse_tab.length); i++){
	    formula=stock_parse_tab[i];
	    if (formula!=""){
	      formula_stock=build_stock(reformat_stock(formula),false);
	      value_min_max_tab=getMinMaxValuesOfGroup(formula,formula_stock);
	      formula_value=(value_min_max_tab[0]+value_min_max_tab[1])/2;
	      formula_tol=Math.round((Math.abs(formula_value-value_min_max_tab[0])/formula_value)*100);
	      add_to_taken_stock_view_resistor(formula,"<em>=".concat(formula_value," (+/- ",formula_tol,"%) Ohm</em>"));
	    }
	  }
	}
	function new_resistor_img_div(data_id,data_list,article_prop,figure_prop,item_prop,caption_html,aside_html){
	  var div = document.createElement('tmp_div');
	  var tmp_html="<article ".concat(article_prop,"><figure id='",data_id,"'", figure_prop,">");
	  var i;
	  var data;
	  for (i=0;i<data_list.length;i++){
	    data=data_list[i];
	    if (data=="//"){
	      tmp_html = tmp_html.concat("<br>");
	    } else if (data=="("){
	      tmp_html = tmp_html.concat("<div class='resistor_inline'>");
	    } else if (data==")"){
	      tmp_html = tmp_html.concat("</div>");
	    } else if (is_standard(data)){
	      var mode=get_standard_mode(data);
	      var span_base=["<span class='","'>&nbsp;&nbsp;</span> "];
	      var cei_coloration=get_cei_color_tab(data);
	      //~ console.log("-"+data+"-");
	      tmp_html = tmp_html.concat("<div ",item_prop," >&mdash;<span class='resistor_view ",
	      cei_coloration[5],"'> ",
	      span_base[0],cei_coloration[0],span_base[1],
	      span_base[0],cei_coloration[1],span_base[1],
	      (mode>4)?span_base[0].concat(cei_coloration[2],span_base[1]):"",
	      span_base[0],cei_coloration[3],span_base[1],
	      span_base[0],cei_coloration[4],span_base[1],
	      (mode==6)?(span_base[0],'cei_color_None',span_base[1]):"",
	      "</span>&mdash;</div>");
	    } else if (is_bobine_resistor(data)){
	      tmp_html = tmp_html.concat("<div ",item_prop," >&mdash;",
	      "<span class='cei_color_Green bobine_resistor_view'>&nbsp;&nbsp;",data.replace(/.*\[/,"").replace(/\]/,""),"&nbsp;&nbsp;</span>",
	      "&mdash;</div>"
	      );
	    } else if (is_cms_resistor(data)){
	      var tab_desc=get_tab_desc_in_desc(data);
	      tmp_html = tmp_html.concat("<div ",item_prop," >",
	      "<span class='cms_pkg_view'>",
	      "<span class='cei_color_Silver relief_left'>&nbsp;&nbsp;</span>",
	      "<span class='cei_color_Black relief'>&nbsp;",tab_desc[0],tab_desc[1],tab_desc[2],"&nbsp;</span>",
	      "<span class='cei_color_Silver relief_right'>&nbsp;&nbsp;</span>"
	      ,"</span></div>"
	      );
	    } else {
	      tmp_html = tmp_html.concat("&mdash;",
	      "<span class='cei_color_Black'>&nbsp;&nbsp;",data,"&nbsp;&nbsp;</span>",
	      "&mdash;"
	      );
	    }
	  }
	  tmp_html=tmp_html.concat("<figcaption>",caption_html,"</figcaption>",
	    "</figure>",aside_html,"</article>");
	  div.innerHTML=tmp_html;
	  return div
	} 
	function get_component_view(data,qte){
		return new_resistor_img_div(
	    /*id*/ data 
	    /*components to show*/,[data] 
	    /* article prop */,"class='div_article'" 
	    /* figure prop */," ".concat("class='resistor_view_canvas'",
		" draggable='true'",
		" ondragstart=\"event.dataTransfer.setData('text','",data,"');\"")
	    /* item (component) prop */,"class='div_item'" 
	    /* caption */,data.concat("<span class='shown_data' id='qte",data,"'><big> &times; ",qte,"</big></span>") 
	    /* aside */,"".concat("<div class='div_button' onmouseover=\"blink_data('qte",data,"',0,'blink_data',200,'shown_data',500);\" onmouseout=\"unblink();\" >",
	      "<button  onclick=\"unblink();add_to_stock('",data,"');\"><large>+</large></button>",
	      "<button  onclick=\"unblink();extractStockFromFormattedInput('"+data+"');\"",
	      ((qte>1)? (">-"):("class='button_deprecated'>x")),
	      "</button>",
	      "</div>")
	    );
	}
	function add_to_taken_stock_view_resistor(data,info){//
	  var formatted_caption=data.replace(
	  /(\(.*)(\()/g, function(a,x,y){return x+"<br>"+y;}).replace(
	  /^(\()(.*)(\))$/g,function(a,b,x,c){return x;}).replace(
	  /(\(|\))/g,function(x){return "&#8239;<small>"+x+"</small>&#8239;";}).replace(
	  /(\/\/|\+)/g,function(x){return "&#8239;<strong>"+x+"</strong>&#8239;";});
	  document.getElementById('taken_stock_view_resistor').appendChild(
	    new_resistor_img_div(
	    /*id*/ data
	    /*components to show*/,data.match(/(\(|\)|\/\/|[a-z0-9.,\[\]]+)/g)
	    /* article prop */,"class='resistor_view_canvas_resistor_small'"
	    /* figure prop */," ".concat("class=' resistor_small'",
		" draggable='true'",
		" ondragstart=\"event.dataTransfer.setData('text','",data,"');\"")
	    /* item (component) prop */," class='resistor_view_canvas_item' " 
	    /* caption */,formatted_caption.concat("<span class='shown_data' id='",data,"'><br>",info,"</span>"
	    ).concat("<div  >",
	      "<button  onclick=\"add_to_stock('",data,"');taken_stock_remove('"+data+"');\">Remettre</button>",
	      "<button  onclick=\";taken_stock_remove('"+data+"');\" class='button_deprecated'>x</button>",
	      "</div>")
	    /* aside */,""
	    )
	  );
	}
	
	function updateStock(){
	    reformat_input_stock();
	    make_view_from_formatted_input_stock();
	}
	function taken_stock_remove(formule){
	  document.getElementById('my_stock_resistor_pris').value=document.getElementById('my_stock_resistor_pris').value.replace(formule,"");
	  makeViewFromFormattedTakenStock();
	}
	function extractStockFromFormattedInput(formule){
	  var grp_parse_tab=formule.replace(/[(+)]/g,function(x){return ' '+x+' '}).replace(/(\s)+/g," ").split(" ");
	  var i;
	  var new_stock=document.getElementById('my_stock_resistor').value.replace(/(^|$)/g," ");
	  var pos, pos2, pos3;
	  var qte;
	  var detailled_componant;
	  var taken_stock="";
	  for (i=0;i<grp_parse_tab.length;i++){
	    if ((grp_parse_tab[i]=='')||(grp_parse_tab[i]=='(')||(grp_parse_tab[i]==')')||(grp_parse_tab[i]=='+')||(grp_parse_tab[i]=='//')){
	      taken_stock=taken_stock.concat(grp_parse_tab[i]);
	    } else {
	      //~ console.log("|"+grp_parse_tab[i]+"|","|"+new_stock+"|");
	      //check if stock still avaible
	      pos=new_stock.indexOf(" "+grp_parse_tab[i]+"{");
	      if (pos<0){//obsolete : alternative checking : usefull if the formula doesn't contains details
		pos=new_stock.indexOf(" "+grp_parse_tab[i]+"\\[");
		if (pos<0){//if not found, exit
		  return "";
		}
		pos2=new_stock.indexOf("]",pos);
		if (pos2<0){
		  alert(new_stock.slice(pos,pos+grp_parse_tab[i].length+2), " est incomplet. Le format pour indiquer la référence est 'valeur[référence]'. ");
		  return "";
		}

		detailled_componant=new_stock.slice(pos+1,pos2+1);
		taken_stock=taken_stock.concat(detailled_componant);
	      
	      } else {
		taken_stock=taken_stock.concat(grp_parse_tab[i]);
	      }
	      pos2=new_stock.indexOf("{",pos);
	      pos3=new_stock.indexOf("}",pos2);
	      qte=new_stock.substring(pos2+1,pos3);
	      //~ console.log(qte,new_stock,pos,pos2,pos3);
	      if (qte=="1"){
		new_stock=new_stock.substring(0,pos+1)+new_stock.substr(pos3+2);
	      } else {
		new_stock=new_stock.substring(0,pos2+1)+(parseInt(qte)-1)+new_stock.substr(pos3);
	      }
	      //~ console.log(taken_stock,"<",new_stock);
	    }
	  }
	  document.getElementById('my_stock_resistor').value=new_stock.replace(/(^\s|\s$)/g,"");
	  updateStock();
	  return taken_stock;
	}
	
	updateStock();
	makeViewFromFormattedTakenStock();
	</script>
<!-- Drag and drop et deplacement des vues de résistance-->
	<script>
	function dragResitorFromInput(ev,elem_input) {
	    if ((elem_input.value!="")&&(is_acceptable(elem_input.value))){
	      ev.dataTransfer.setData("text", elem_input.value);
	    }
	}
	function dragResitor(ev) {
	    if (get_resistor_value()!=""){
	      ev.dataTransfer.setData("text", get_resistor_ref());
	    }
	}
	function dropOnStock(ev) {
	    ev.preventDefault();
	    var data = ev.dataTransfer.getData("text");
	    //~ shake('resistor_img');
	    add_to_stock(data);
	    shake(data);
	}
	function allowDrop(ev) {
	    ev.preventDefault();
	}
      </script>
    </body>
</html>
