<!DOCTYPE html>
<html lang="fr">
	<head>
	  <meta name="Resistance finder" content="DIY heaven resistance finder"/>
	  <meta charset="utf-8" />
	  <title>Resistance finder</title>
	  <style>
	    body{
		background-color:#E5E8D4;
		font-family:sans-serif;
	    }
	    article{
	      display:inline-block;
	    }
	    #corps{
		display:inline-block;
		text-align:center;
		width:100%;
	    }
	    .cadre{
		border-left: 2px solid #B2B5A6;
		/*border-radius:5em;
		box-shadow: 10px 10px 5px #888888;
		background-color:#E6E6FA;*/
		display:inline-block;
		width:50%;
	    }
	    .cadre-left{
		display:inline-block;
		width:40%;
		float:left;
	    }
	    
	    .cadre-right{
	      display:inline-block;
		width:50%;
		float:right;
	    }
	    header{
	      text-align:center;
	      background-color:rgba(173,173,173,0.25);
	      font-size:small;
	    }
	    #titre{
	      position : relative;
	      top:0;
	      left:0;
	      width:100%;
	    }
	    /* Block de calcul des combinaisons de resistance */
	    .cadre h2{
	      border: 1.5px solid black;
	    }
	    .stock{
		width: 90%;
	    }
	    
	    .formule{
		width: 40%;
	    }
	    
	    .valeur{
		width: 10%;
	    }
	    footer {
		position:relative;
		bottom:0;
		font-size: small;
		color: #7F7F7F;
		background-color:black;
		width:100%;
		text-align:center;
	    }
	    footer div{
		display:inline-block;
		margin-left:2vw;
	    }
	    footer div div{
		display:inline-block;
	    }
	    footer a{
	      color:green;
	      border:2px solid green;
	      padding:0.5em;
	      margin:0.5em;
	      text-decoration:none;
	    }
	    footer a:hover{
	      color:#90EE90;
	      border:2px solid #90EE90;
	    }
	    .block_stock {
	      position:relative;
	      left:10%;
	      text-align:left;
	    }
	    .block_form0 .title{
	      left:10%;
	      text-align:left;
	    }
	    .block_form0 .view{
	      position:relative;
	      left:20%;
	    }
	    .block_form0 input{
	      margin:0;
	      padding:0;
	    }
	    .block_form1 {
	      position:relative;
	      left:10%;
	      text-align:left;
	    }
	    
	    .block_form1 button{
	      position:absolute;
	      left:60%;
	    }
	    .block_form1 input{
	      position:absolute;
	      left:60%;
	      width:10em;
	    }
	    .block_form2 {
	      position:relative;
	      left:10%;
	      text-align:left;
	      color:#2D2D2D;
	    }
	    .block_form2 input{
	      position:relative;
	      width:16em;
	    }
	    /*Les boutons */
	    button{
	      border: 1.5px solid gray;
	      background-color:white;
	      cursor:default;
	      min-width:1.75em;
	    }
	    button:active{
	      transform: translate(-5px,0px);
	      -webkit-transform: translate(-5px,0px);
	      -ms-transform: translate(-5px,0px);
	    }
	    button:hover{
	      border: 1.5px solid black;
	      background-color:#40FF40;
	      cursor:pointer;
	    }
	    .button_waiting{
	      cursor:wait !important;
	      background-color:gray;
	    }
	    .button_hidden{
	      display:none;
	    }
	    .button_deprecated{
	      background-color:gray;
	      border: 1.5px solid black;
	      color:white;
	    }
	    .button_deprecated:hover{
	      border: 1.5px solid black;
	      background-color:red;
	      cursor:pointer;
	    }
	    .button_disabled{
	      background-color:gray;
	      border: 1.5px solid gray;
	      opacity:0.1;
	    }
	    .button_disabled:hover{
	      background-color:gray;
	    }
	    .button_waiting:hover{
	      cursor:wait !important;
	      background-color:gray;
	    }
	   /* Block de déchiffrage d'une résistance */
	    #resistor_settings {
	      display:inline-block;
	      border : 1px solid black;
	      border-radius: 0.5em;
	      padding:0.2em;
	      max-width:26em;
	      text-align:center;
	    } 
	    .resistor_mode{
	      list-style-type: none; 
	      border : 1px solid black;
	      border-radius: 0.5em;
	      display:inline-block;
	      min-width:1em;
	      opacity:0.7;
	      }
	    .resistor_mode:hover{
	      opacity:1;
	      }
	    .resistor_prop_title{
	      list-style-type: none;
	      padding-left:0.5em;
	      padding-right:0.5em;
	      border: none;
	      font-weight:bold;
	      font-size:small;
	      text-align:center;
	    }
	    .resistor_color_list {  
	      border : 1px solid black;
	      display: inline-block;
	      margin: 0;
	      padding: 0;
	      border-radius: 0.2em;
	      float:left;
	      max-width:7em;}
	    .resistor_color_list li {
	      list-style-type: none;
	      border : 1px solid black;
	      margin: 2px;
	      min-width:1.5em;
	      text-align:center;
	      font-size:small;
	      border-radius: 0.2em;
	      cursor:pointer;
	      opacity:0.7;
	    }
	    .resistor_color_list li:hover {
	      opacity:1;
	    }
	    .font-small li{
	      font-size:x-small;
	      padding:0.1em;
	    }
	    .resistor_mode_list {  
	      border-bottom : 1px solid black;
	      display: inline;
	      margin: 0;
	      padding: 0;
	      float:left;list-style-type: none;
	      text-align:center;
	      width:100%;}
	    .resistor_mode_list li {
	      list-style-type: none;
	      display: inline-block;
	      padding-left:0.25em;
	      padding-right:0.25em;
	      text-align:center;
	      font-size:small;
	      border-radius: 0.2em;
	      cursor:pointer;
	      opacity:0.7;
	    }
	    .resistor_color_Black{  background-color: black ; color: white; border:  1px solid black; -moz-user-select: none;}
	    .resistor_color_Brown{  background-color: brown ; border:  1px solid black;-moz-user-select: none;}
	    .resistor_color_Red{  background-color: red; border:  1px solid black;-moz-user-select: none;}
	    .resistor_color_Orange{ background-color: orange; border:  1px solid black; -moz-user-select: none;}
	    .resistor_color_Yellow{  background-color: yellow; border:  1px solid black; -moz-user-select: none;}
	    .resistor_color_Green{ background-color: green; color: white;border:  1px solid black; -moz-user-select: none;}
	    .resistor_color_Blue{ background-color: blue; color: white;border:  1px solid black; -moz-user-select: none;}
	    .resistor_color_Violet{  background-color:  violet; border:  1px solid black; -moz-user-select: none;}
	    .resistor_color_Gray{  background-color: gray; border:  1px solid black; -moz-user-select: none;}
	    .resistor_color_White{  background-color: white; border:  1px solid black; -moz-user-select: none;}
	    .resistor_color_Gold{  background-color: gold; border:  1px solid black; -moz-user-select: none;}
	    .resistor_color_Silver{  background-color: silver; border:  1px solid black;  -moz-user-select: none;}
	    .resistor_color_None{  background-color: rgba(175,175,175,0.2); border:  1px solid rgba(175,175,175,0.1) ; -moz-user-select: none; }
	    .resistor_color_Beige{  background-color:  #FFFFAD ; -moz-user-select: none;}
	    .resistor_color_Cyan{  background-color: #1E90FF; -moz-user-select: none;}

	    .resistor_blink_val{ display:inline-block;border: 5px solid rgba(0,255,0,0.9) ; -moz-user-select: none; }
	    .resistor_blink_val_hidden{ display:inline-block;border: 5px solid rgba(255,255,0,0) ; -moz-user-select: none; }
	    

	    .resistor_value_title{
	      padding:0.5em;
	    }
	    .resistor_value_selector{
	      opacity:0.7;
	      display:inline-block;
	      float:left;
	    }
	    
	    .resistor_value_selector:hover{
	      opacity:1;
	    }
	    .resistor_value_selector_hightlight{
	      opacity:1;
	      display:inline-block;
	      float:left;
	    }
	    #value1,#value2,#value3{
	      display:inline-block;
	    }
	    /*Image/aperçue de la résistance*/
	    #resistor_value,#_cms_resistor_value,#power_resistor_value{
	      min-width:4em;
	      max-width:10em;
	    }
	    .resistor_view_canvas{
	      display:inline-block;
	      text-align:center;
	      border: 1px dashed gray;
	      background-color:rgba(255,255,255,0.25);
	    }
	    .resistor_view_canvas input{
	      background-color:rgba(255,255,255,0);
	      border:none;
	    }
	    .resistor_view{
	      border:3px solid black;
	      box-shadow: 2px 2px 5px #888888;
	    }
	    .power_resistor_view{
	      border:2px solid green;
	      box-shadow: 2px 2px 5px #888888;
	      border-radius:1em;
	    }
	    .cms_resistor_view{
	      box-shadow: 2px 2px 5px #888888;
	    }
	    
	    .cms_resistor_view{
	      box-shadow: 2px 2px 5px rgba(136,136,136,0.5);
	    }
	    .cms_resistor_view .relief_right{
	      border-bottom:3px solid #4D4D4D;
	      border-top:2px solid #E5E5E5;
	      border-right:2px solid #E5E5E5;

	    }
	    .cms_resistor_view .relief_left{
	      border-bottom:3px solid #4D4D4D;
	      border-top:2px solid #E5E5E5;
	      border-left:2px solid #E5E5E5;
	    }
	    .cms_resistor_view .relief{
	      border-top:3px solid black;
	      box-shadow: 2px 2px 5px #888888;
	    }
	    .resistor_big{
	      display:inline-block;
	      font-size:2em;
	    }
	    
	    /* Block de visualisation du stock*/
	    .cadre-view{
		border: 3px solid black;
		background-color:#E6E6FA;
		display:inline-block;
		width:55%;
		height:6%;
		position:absolute;
		top:0%;
		left:23%;
		border-radius:0.1em;
		box-shadow: 10px 10px 5px #888888;
		opacity:0.20;
		overflow:auto;
	    }
	    .cadre-view:hover{
		opacity:0.9;
		height:80%;
	    }
	    #stock_view {
	      padding-top:2em;
	      padding-bottom:2em;
	      background: linear-gradient(to bottom, #feffe8 0%,#d6dbbf 100%);
	    }
	    .draggable{
	      cursor:move;
	    }
	    .droppable{
	      cursor:cell;
	    }
	    .border_round{
	      border-radius:1em;
	    }
	    .rotate_item {
	      transform: rotate(-20deg);
	      -webkit-transform: rotate(-20deg);
	      -ms-transform: rotate(-20deg);
	    }
	    .rotate_item:active {
	      transform: rotate(0);
	      -webkit-transform: rotate(0);
	      -ms-transform: rotate(0);
	    }
	    .rotate_item_shake {
	      transform: rotate(-10deg);
	      -webkit-transform: rotate(-10deg);
	      -ms-transform: rotate(-10deg);
	    }
	    .rotate_item_hurt1 {
	      transform: rotate(-45deg);
	      -webkit-transform: rotate(-45deg);
	      -ms-transform: rotate(-45deg);
	    }
	    .rotate_item_hurt2 {
	      transform: rotate(-120deg);
	      -webkit-transform: rotate(-120deg);
	      -ms-transform: rotate(-120deg);
	    }
	    .rotate_item_hurt3 {
	      transform: rotate(180deg);
	      -webkit-transform: rotate(180deg);
	      -ms-transform: rotate(180deg);
	    }
	    .rotate_item_hurt4 {
	      transform: rotate(120deg);
	      -webkit-transform: rotate(120deg);
	      -ms-transform: rotate(120deg);
	    }
	    .rotate_item_hurt5 {
	      transform: rotate(45deg);
	      -webkit-transform: rotate(45deg);
	      -ms-transform: rotate(45deg);
	    }
	    /*Element d'aide*/
	    .hidden_data{
		opacity:0;
		font-size:2em;
	    }
	    .blink_data{
		opacity:0.25;
		font-size:2em;
	    }
	    .shown_data{
		opacity:0.9;
		font-size:2em;
	    }
	    .info{
	      font-size:small;
	      text-align:left;
	      margin-left:10%;
	    }
	    .info li{
	      font-size:small;
	      text-align:left;
	    }
	    #help{
	      position: fixed;
	      right:0;
	      top:0;
	      text-align:right;

	    }
	    nav ul li a{
	       background-color:rgba(255,255,255,0.5);
	    }
	    nav ul ul {
		display: none;
	    }
	    nav ul li > ul:hover {
		display: none;
	    }
	    nav ul li:hover > ul {
		display: block;
	    }
	    nav ul {
		list-style: none;
		margin:0;
	    }
	    nav ul:after {
		content: ""; clear: both; display: block;
	    }
	    a{
	      color:green;
	      font-size:1.2vw;
	      border:1px solid green;
	      padding:0.1vw;
	      margin:0.1vw;
	      text-decoration:none;
	    }
	    nav a:hover{
	      background-color:white;
	      text-decoration:underline;
	    }
	  </style>
	 </head>
    <body>
       <header id="titre">
	   <h1>Explorateur de stock électronique</h1>
	   <h2>Les résistances</h2>
       </header>
       <nav id="help">
	 <ul>
	  
	  <li><a  href="#">...</a>
	    <ul>
	    <li><a  href="https://github.com/luffah/diy-heaven/issues">Report a bug !</a></li>
	    <li><a  href="http://www.sonelec-musique.com/electronique_theorie_resistance.html">Infos sur les résistances</a></li>
	    <li><a  href="http://www.sonelec-musique.com/electronique_theorie_resistance_codes_valeur.html">Infos sur les codes valeurs</a></li>
	    </ul>
	  </li>
	 </ul>
       </nav>
      
       <section id='corps'>
	<article class='cadre-left'>

	  <section >
	    	  <header><h3>Formats pour décrire les résistances</h3></header>
	       <ul class='info'>
	      <li>R[v,v,v,m,t] pour les résistances à bandes</li>
	      <li>R[P,t] pour les résistances bobinées</li>
	      <li>R[vvm] pour les résistances CMS</li>
	      </ul>
	      </p>
	  </section>
	  <header><h3>Déchiffrage</h3></header>
	  <section >
	    <div class=''>
	      <ul class='resistor_mode_list'>
		<li>Type</li>
		<li onClick="corps_set('c');" class='resistor_color_Beige  resistor_mode'><small>Carbone 0,5W</small></li>
		<li onClick="corps_set('m');" class='resistor_color_Cyan resistor_mode'><small>Metal 0,4W</small></li>
		<li onClick="corps_set('mv');" class='resistor_color_Green resistor_mode'><small>Metal 0,4W</small></li>
		<li onClick="corps_set('mr');" class='resistor_color_Red resistor_mode '><small>Metal 1W</small></li>
		<li onClick="corps_set('s');" class='resistor_color_Silver resistor_mode' >&nbsp;<span class='resistor_color_Black'>
		  <small> CMS 0,25W </small></span>&nbsp;
		    </li>
		<li onClick="corps_set('b');" class='resistor_color_Green resistor_mode'><small>Bobine >1W</small></li>
	      </ul>
	    </div>
	  <div id='cms_resistor_block'>
	    <figure  class='draggable'  draggable='true'
	    ondragstart="resitor_drag_from_input(event,document.getElementById('cms_resistor_desc'));" >
	    <label  class='title' for='cms_resistor_desc'>Ref. [v,v,m]:</label>
	    <span class='view'>
	      <span class='resistor_view_canvas'  class=' draggable '  draggable='true' ondragstart="resitor_drag(event)" >
		<div id='cms_resistor_img' >
		  <span class='cms_resistor_view'>
		    <span class='resistor_color_Silver relief_left'>&nbsp;&nbsp;</span><span class='resistor_color_Black relief'>
		      <input class='resistor_color_Black' type='text' id='cms_resistor_desc' size=2 maxlength=3
		      ondragover="event.preventDefault();"
		      ondragstart="resitor_drag(event)"></input>
		    </span><span class='resistor_color_Silver relief_right'>&nbsp;&nbsp;</span>
		  </span>
		</div>
		<figcaption><span type='text' id='cms_resistor_value'>?</span></figcaption>
	      </span>
	    </span>
	    <button onClick='store_resistance()' title="Ajouter au stock">+</button>
		</span>      
	    <br>
	    </figure>
	  </div>
	  <div id='power_resistor_block'>
	    <figure >
	    <label class='title' for='power_resistor_desc'>Ref. R[P,t]:</label>
	    <span class='view'><span class='resistor_view_canvas' class=' draggable '  draggable='true'
	    ondragstart="resitor_drag_from_input(event,document.getElementById('power_resistor_desc'));" >
	      <div id='power_resistor_img'>
		&dash;<span class='resistor_color_Green power_resistor_view'>
		<input class='resistor_color_Green' type='text' id='power_resistor_desc' size=16
		 ondragover="event.preventDefault();"></input>
		</span>&dash;
	      </div>
	    <figcaption><span type='text' id='power_resistor_value'>?</span></figcaption>
	    </span>
	     <button onClick='store_resistance()' title="Ajouter au stock">+</button>
	    </span>
	    <br>
	    </figure>
	  </div>
	  <div id='ring_resistor_block'>
	      <label class='title' for='resistor_desc'>Ref.[v,v,v,m,t]:</label>
	       <span class='resistor_view_canvas draggable'  draggable='true'
		ondragstart="resitor_drag(event);" ondragover="allowDrop(event);"
		ondrop="document.getElementById('resistor_desc').value=event.dataTransfer.getData('text');event.preventDefault();get_resistance();"
		>
	      <input class='view' type='text' id='resistor_desc' size=12
	      ondragover="document.getElementById('resistor_desc').value='';" onClick='get_resistance();' onblur='get_resistance();' onKeyDown='run_get_resistance(event);'></input>
<!--
	      <br>Résistance carbone 0,5W
-->
	      <br>
	      <div class='' id='resistor_img' >&mdash;<span class='resistor_view resistor_color_Beige' id='resistor_body'>
		<span id='border_view_val1' class='resistor_blink_val_hidden'
		onmouseover="document.getElementById('value1').className='resistor_value_selector_hightlight';"
		onmouseout="document.getElementById('value1').className='resistor_value_selector';">
		  <span class='resistor_color_None' id='view_val1'>&nbsp;&nbsp;</span></span>
		<span id='border_view_val2' class='resistor_blink_val_hidden'
		onmouseover="document.getElementById('value2').className='resistor_value_selector_hightlight';"
		onmouseout="document.getElementById('value2').className='resistor_value_selector';">
		  <span class='resistor_color_None' id='view_val2'>&nbsp;&nbsp;</span></span>
		<span id='border_view_val3' class='resistor_blink_val_hidden'
		onmouseover=" document.getElementById('value3').className='resistor_value_selector_hightlight';"
		onmouseout="document.getElementById('value3').className='resistor_value_selector';">
		  <span class='resistor_color_None' id='view_val3'>&nbsp;&nbsp;</span></span>
		<span id='border_view_mult' class='resistor_blink_val_hidden'
		onmouseover="document.getElementById('mult').className='resistor_value_selector_hightlight';"
		onmouseout="document.getElementById('mult').className='resistor_value_selector';">
		  <span class='resistor_color_None' id='view_mult'>&nbsp;&nbsp;</span></span>
		<span id='border_view_tol' class='resistor_blink_val_hidden'
		onmouseover="document.getElementById('tol').className='resistor_value_selector_hightlight';"
		onmouseout="document.getElementById('tol').className='resistor_value_selector';">
		  <span class='resistor_color_None' id='view_tol'>&nbsp;&nbsp;</span></span>
		<!--<span class='resistor_color_None' id='view_ppm'>&nbsp;&nbsp;</span>-->
		</span>&mdash;</div>
		<figcaption><span type='text' id='resistor_value'>?</span></figcaption>
	    </span>
	      <button onClick='store_resistance()' id='stock_add_btn' class='button_disabled' title="Ajouter au stock" disabled>+</button>
	  </div>
	  
	  
	  </section>
	  <section  id='resistor_settings'>
	    <div id='nb_ring' class=''>
	      <ul class='resistor_mode_list '>
		<li><small>Nombre d'anneaux</small></li>
		<li onClick='set_mode(3)' class='resistor_mode'>3</li>
		<li onClick='set_mode(4)' class='resistor_mode'>4</li>
		<li onClick='set_mode(5)' class='resistor_mode'>5</li>
		<li onClick='set_mode(6)' class='resistor_mode'>6</li>
	      </ul>
	    </div>
	   
	    <div class='resistor_color_list'>
	      <div class='resistor_prop_title '>Valeur</div>
	      <div class="resistor_value_selector" id="value1"
		    onmouseover="document.getElementById('border_view_val1').className='resistor_blink_val';"
		    onmouseout="document.getElementById('border_view_val1').className='resistor_blink_val_hidden';">
		<ul class='resistor_color_list'>
		  <li class='resistor_color_Black'    onClick='val1_set(0)'>0</li>
		</ul>
		<ul class='resistor_color_list'>
		  <li class='resistor_color_Brown'    onClick='val1_set(1)'>1</li>
		  <li class='resistor_color_Yellow'   onClick='val1_set(4)'>4</li>
		  <li class='resistor_color_Violet'   onClick='val1_set(7)'>7</li>
		</ul>
		<ul class='resistor_color_list'>
		  <li class='resistor_color_Red'      onClick='val1_set(2)'>2</li>
		  <li class='resistor_color_Green'    onClick='val1_set(5)'>5</li>
		  <li class='resistor_color_Gray'     onClick='val1_set(8)'>8</li>
		</ul>
		<ul class='resistor_color_list'>
		  <li class='resistor_color_Orange '  onClick='val1_set(3)'>3</li>
		  <li class='resistor_color_Blue'     onClick='val1_set(6)'>6</li>
		  <li class='resistor_color_White'    onClick='val1_set(9)'>9</li>
		</ul>
	      </div>
	      <br>
	      <div id='value2' class='resistor_value_selector'
		    onmouseover="document.getElementById('border_view_val2').className='resistor_blink_val';"
		    onmouseout="document.getElementById('border_view_val2').className='resistor_blink_val_hidden';"
		    >
		<ul class='resistor_color_list' id='value2'>
		  <li class='resistor_color_Black'    onClick='val2_set(0)'>0</li>
		</ul>
		<ul class='resistor_color_list'>
		  <li class='resistor_color_Brown'    onClick='val2_set(1)'>1</li>
		  <li class='resistor_color_Yellow'   onClick='val2_set(4)'>4</li>
		  <li class='resistor_color_Violet'   onClick='val2_set(7)'>7</li>
		</ul>
		<ul class='resistor_color_list'>
		  <li class='resistor_color_Red'      onClick='val2_set(2)'>2</li>
		  <li class='resistor_color_Green'    onClick='val2_set(5)'>5</li>
		  <li class='resistor_color_Gray'     onClick='val2_set(8)'>8</li>
		  
		</ul>
		<ul class='resistor_color_list'>
		  <li class='resistor_color_Orange '  onClick='val2_set(3)'>3</li>
		  <li class='resistor_color_Blue'     onClick='val2_set(6)'>6</li>
		  <li class='resistor_color_White'    onClick='val2_set(9)'>9</li>
		</ul>
	      </div>
	      <br>
	      <div class="resistor_value_selector" id='value3' 
		    onmouseover="document.getElementById('border_view_val3').className='resistor_blink_val';"
		    onmouseout="document.getElementById('border_view_val3').className='resistor_blink_val_hidden';"
		    >
		<ul class='resistor_color_list' id='value3'>
		  <li class='resistor_color_Black'    onClick='val3_set(0)'>0</li>
		</ul>
		<ul class='resistor_color_list'>
		  <li class='resistor_color_Brown'    onClick='val3_set(1)'>1</li>
		  <li class='resistor_color_Yellow'   onClick='val3_set(4)'>4</li>
		  <li class='resistor_color_Violet'   onClick='val3_set(7)'>7</li>
		</ul>
		<ul class='resistor_color_list'>
		  <li class='resistor_color_Red'      onClick='val3_set(2)'>2</li>
		  <li class='resistor_color_Green'    onClick='val3_set(5)'>5</li>
		  <li class='resistor_color_Gray'     onClick='val3_set(8)'>8</li>
		</ul>
		<ul class='resistor_color_list'>
		  <li class='resistor_color_Orange '  onClick='val3_set(3)'>3</li>
		  <li class='resistor_color_Blue'     onClick='val3_set(6)'>6</li>
		  <li class='resistor_color_White'    onClick='val3_set(9)'>9</li>
		</ul>
	      </div>
	    </div>
	    <div id='mult' class='resistor_value_selector'
		onmouseover="document.getElementById('border_view_mult').className='resistor_blink_val';"
		onmouseout="document.getElementById('border_view_mult').className='resistor_blink_val_hidden';">
	      <ul class='resistor_color_list'>
		<div class='resistor_prop_title'>Multiple</div>
		<li class='resistor_color_Gold'   onClick='mult_set(0.01)'>x0.01</li>
		<li class='resistor_color_Silver' onClick='mult_set(0.1)'>x0.1</li>
		<li class='resistor_color_Black'  onClick='mult_set(1)'>x1</li>
		<li class='resistor_color_Brown'  onClick='mult_set(10)'>x10</li>
		<li class='resistor_color_Red'    onClick='mult_set(100)'>x100</li>
		<li class='resistor_color_Orange' onClick='mult_set(1000)'>x1k</li>
		<li class='resistor_color_Yellow' onClick='mult_set(10000)'>x10k</li>
		<li class='resistor_color_Green'  onClick='mult_set(100000)'>x100k</li>
		<li class='resistor_color_Blue'   onClick='mult_set(1000000)'>x1m</li>
		<li class='resistor_color_Violet' onClick='mult_set(10000000)'>x10m</li>
	      </ul>
	    </div>
	    <div id='tol' class='resistor_value_selector'
		onmouseover="document.getElementById('border_view_tol').className='resistor_blink_val';"
		onmouseout="document.getElementById('border_view_tol').className='resistor_blink_val_hidden';">
	      <ul class='resistor_color_list'>
		<div class='resistor_prop_title'>Tolérance</div>
		<li class='resistor_color_None'  onClick='tolerance_set(0.20)'>~20%</li>
		<li class='resistor_color_Silver' onClick='tolerance_set(0.10)'>~10%</li>
		<li class='resistor_color_Gold' onClick='tolerance_set(0.05)'>~5%</li>
		<li class='resistor_color_Brown' onClick='tolerance_set(0.01)'>~1%</li>
		<li class='resistor_color_Red' onClick='tolerance_set(0.02)'>~2%</li>
		<li class='resistor_color_Green' onClick='tolerance_set(0.005)'>~0.5%</li>
		<li class='resistor_color_Blue' onClick='tolerance_set(0.0025)'>~0.25%</li>
		<li class='resistor_color_Violet' onClick='tolerance_set(0.001)'>~0.1%</li>
	      </ul>
	    </div>
	     <div id='pow' class='resistor_value_selector'>
	    <ul class='resistor_color_list '>
	      <div class='resistor_prop_title'>Charge admissible</div>
	      <li class='resistor_mode' onClick='pow_set(1)'>1W</li>
	      <li class='resistor_mode' onClick='pow_set(2)'>2W</li>
	      <li class='resistor_mode' onClick='pow_set(2.5)'>2.5W</li>
	      <li class='resistor_mode' onClick='pow_set(3)'>3W</li>
	      <li class='resistor_mode' onClick='pow_set(4)'>4W</li>
	      <li class='resistor_mode' onClick='pow_set(5)'>5W</li>
	      <li class='resistor_mode' onClick='pow_set(7)'>7W</li>
	      <li class='resistor_mode' onClick='pow_set(11)'>11W</li>
	      <li class='resistor_mode' onClick='pow_set(12)'>12W</li>
	      <li class='resistor_mode' onClick='pow_set(20)'>20W</li>
	      <li class='resistor_mode' onClick='pow_set(25)'>25W</li>
	      <li class='resistor_mode' onClick='pow_set(30)'>30W</li>
	      <li class='resistor_mode' onClick='pow_set(50)'>50W</li>
	      <li class='resistor_mode' onClick='pow_set(90)'>90W</li>
	      <li class='resistor_mode' onClick='pow_set(100)'>100W</li>
	      <li class='resistor_mode' onClick='pow_set(180)'>180W</li>
	      <li class='resistor_mode' onClick='pow_set(250)'>250W</li>
	      <li class='resistor_mode' onClick='pow_set(300)'>300W</li>
	    </ul>
	    </div>
	    <ul class='resistor_color_list font-small resistor_value_selector' id='coef-temp'>
	      <div class='resistor_prop_title'>Coef.temp.</div>
	      <li class='resistor_color_Black' onClick='ppm_set(200,"resistor_color_Black")'>200ppm</li>
	      <li class='resistor_color_Brown' onClick='ppm_set(100,"resistor_color_Brown")'>100ppm</li>
	      <li class='resistor_color_Red' onClick='ppm_set(50,"resistor_color_Red")'>50ppm</li>
	      <li class='resistor_color_Orange' onClick='ppm_set(15,"resistor_color_Orange")'>15ppm</li>
	      <li class='resistor_color_Yellow' onClick='ppm_set(25,"resistor_color_Yellow")'>25ppm</li>
	    </ul>

	  </section>
	  <p class="info">Notes :
	   <ul class="info">
	     <li>Si la tolérance est élevée ou si vous ne voyez pas clairement les couleurs, vérifiez la valeur de la résistance au multimètre.</li>
	    <li>Les charges admissibles indiquée pour les résistances à anneaux sont purement indicatives, il s'agit normalement des valeurs minimales que peut dissiper le type de résistance représenté. On peut aussi deviner que des résistances de grosse taille vont dissiper plus de puissance, que des résistances de même couleur de plus petite taille.</li>
	    </ul>
	   <script>
	     	function store_resistance(){
		  //~ console.log('store');
		  if (update_value(true)){
		    shake(((my_resistor_mode==RESISTOR_CMS)?'cms_':((my_resistor_mode==RESISTOR_BOBINE)?'power_':''))+'resistor_img');
		    update_stock();
		    shake(get_resistor_ref());
		  } else {
		     hurt(((my_resistor_mode==RESISTOR_CMS)?'cms_':((my_resistor_mode==RESISTOR_BOBINE)?'power_':''))+'resistor_img');
		  }
		}
	  	function get_resistance(){
		  var desc=document.getElementById('resistor_desc').value;
		  var tab_desc=get_tab_desc_in_desc(desc);
		  //~ console.log(tab_desc);
		  if (tab_desc.length>=5){
		    if (tab_desc[0]=='') {
		      delete my_resistor.val1;
		    }else{
		      my_resistor_mode=((tab_desc[2]!='')&&(tab_desc[1]!=''))?5:((tab_desc[1]!='')?4:3);
		    }
		    if (tab_desc[3]=='') {
		      delete my_resistor.mult;
		    }
		    if (tab_desc[4]=='') {
		      delete my_resistor.tolerance;
		    }
		    set_mode(my_resistor_mode);//imply update value and delete useless values
		  
		    if (!tab_desc[0]=='') {
		      val1_set(tab_desc[0]);
		    }
		    if (!tab_desc[1]=='') {
		      val2_set(tab_desc[1]);
		    }
		    if (!tab_desc[2]=='') {
		      val3_set(tab_desc[2]);
		    }
		    if (!tab_desc[3]=='') {
		      mult_set(tab_desc[3]);
		    }
		    if (!tab_desc[4]=='') {
		      tolerance_set(tab_desc[4]);
		    }
		    if (!tab_desc[5]=='') {
		      corps_set(tab_desc[5]);
		    }
		    
		  } else {
		    alert("Format de référence non reconnu");
		  }
		}
		function run_get_resistance(event) {
		  if (event.which == 13 || event.keyCode == 13) {
		    get_resistance();
		    return false;
		  }
		  return true;
		}
	   </script>
	</article>
	<article class="cadre" id="calcul_resistance" >
	    <header><h3>Recherche de combinaisons</h3></header>
	    <div class='block_stock'>
	      <label for="mon_stock">Stock de resistances <small>(en Ohm, séparées par des espaces)</small>:<br></label>
	    </div>
	    <input onblur="update_stock(); is_valid_stock(this);" ondrop="add_to_stock(event.dataTransfer.getData('text'));" ondragover="allowDrop(event);" type="string" value="21k[2,1,,1k,0.01]{2} 1k[1,,,1k,0.01] 10k[1,0,,1k,0.01] 20k[2,0,,1k,0.01] 7k[7,,,1k,0.01] 9k[9,,,1k,0.01] 10500[1,0,5,100,0.01,c]{1}" class="stock" name="mon_stock" id="mon_stock" title="Aide : les notations k=*1000 m=*1000000 sont authorisées" onchange='is_valid_stock(this)' ></input>
	    
	    <br>
	    <br>
	    <div class='block_form1'>
	      <label for="resistance">Résistance souhaitée <small>(en Ohm)</small></label><input type="number" value="10500" name="resistance" id="resistance"
		  onchange="document.getElementById('resistance_link').value=this.value;"
		  ></input>
	      <br>
	      <label for="ecart">Tolérance approximative <small>(en %)</small></label><input type="number" value="2" name="ecart" id="ecart" min="0.5" step="0.5" max="25"
		  onchange="document.getElementById('ecart_link').value=this.value;"
		   ></input>
	      <br>
	      <label for="nbresistances">Nombre maximum de resistances utilisées </label><input type="number" value="4" min=1 max=8 name="nbresistances" id="nbresistances"
		  onchange="document.getElementById('nbresistances_link').value=this.value;"
		  ></input>
	      <br>
	      <button OnClick="start_calcul_combinaisons();" id="button_chercher">Chercher !</button>
	      <button class="button_hidden" id="button_chercher_loading"></button>
	      <br>
	    </div>
	    <br>
	    <div class='block_form2'>
	      <label for="grp_resistance1">Solution 1 : </label><input text='' class="formule" type="text" name="grp_resistance1" id="grp_resistance1" disabled></input>
	      <span class="valeur" type="text" name="grp_resistance_val1" id="grp_resistance_val1"></span>
	      <button OnClick="prendre_grp(1)" id='prendre_grp1_btn' class="button_hidden">Mettre de coté</button>
	      <br>
	      <label for="grp_resistance2">Solution 2 : </label><input text='' class="formule" type="text" name="grp_resistance2" id="grp_resistance2" disabled></input>
	      <span class="valeur" type="text" name="grp_resistance_val2" id="grp_resistance_val2"></span>
	      <button OnClick="prendre_grp(2)" id='prendre_grp2_btn' class="button_hidden">Mettre de coté</button>
	      
	      <br>
	      <label for="grp_resistance3">Solution 3 : </label><input text='' class="formule" type="text" name="grp_resistance3" id="grp_resistance3" disabled></input>
	      <span class="valeur" type="text" name="grp_resistance_val3" id="grp_resistance_val3"></span>
	      <button OnClick="prendre_grp(3)" id='prendre_grp3_btn' class="button_hidden">Mettre de coté</button>
	      <br>
	    </div>
	    <div class='block_stock'>
	      <label for="mon_stock_pris">Resistances mises de coté :<br></label>
	    </div>
	    <input type="string" value="" class="stock" name="mon_stock_pris" id="mon_stock_pris" title="Copier-Coller pour remettre les résistances dans le stock"></input>
	    <br>
	    
	    <p class="info">Légende :  ( R1 <strong>+</strong> R2 ) &rarr; résistances en série; ( R1 <strong>//</strong> R2 ) &rarr; résistances en parallèle.  </p>
	    <script>
	    <!-- functions in gui -->
	    function start_calcul_combinaisons(){
		setTimeout(function(){
		    document.getElementById('button_chercher').className='button_hidden';
		    document.getElementById('button_chercher_loading').innerHTML='Recherche en cours...';
		    document.getElementById('button_chercher_loading').className='button_waiting';
		    },0);
		setTimeout(function(){
		  
		  trouver_solutions();
		  setTimeout(function(){
		    document.getElementById('button_chercher').className='';
		    document.getElementById('button_chercher_loading').className='button_hidden';
		    },100);
		},100);
	    }
	    function trouver_solutions(){
	      var v_resistance=parseInt(document.getElementById('resistance').value);
	      var v_tolerance=(parseFloat(document.getElementById('ecart').value)*v_resistance)/100;
	      var max_qte=parseInt(document.getElementById('nbresistances').value);
	      // reinitialization of the output
	      var i;
	      reformat_input_stock();// include quantification between { }
	      for (i=1; i<(3+1);i++){
		document.getElementById('grp_resistance'+i).value="";
		document.getElementById('grp_resistance_val'+i).innerHTML="";
		document.getElementById('prendre_grp'+i+'_btn').className="button_hidden";
	      }
	      var comb_final_set=calcul_combinaisons(max_qte);
	      // search the nearests
	     
	      var v_solution=search_group(v_resistance,v_tolerance,comb_final_set);
	      //~ console.log(v_solution);
	      // displaying results
	      for (i=0; i<((v_solution.length<3)?v_solution.length:3);i++){
		document.getElementById('prendre_grp'+(i+1)+'_btn').className="";
		document.getElementById('grp_resistance'+(i+1)).value=v_solution[i][1];
		document.getElementById('grp_resistance_val'+(i+1)).innerHTML='='.concat(v_solution[i][0],
		  ' (+/- ',
		  Math.round((v_solution[i][2]/v_solution[i][0])*10000)/100,"%)") ;
	      }
	    }
	    function prendre_grp(n){
	      document.getElementById('mon_stock_pris').value=document.getElementById('mon_stock_pris').value.concat(
		stock_extraction_from_formatted_stock(document.getElementById('grp_resistance'+n).value)).replace(')(',') (');
	      document.getElementById('grp_resistance'+n).value="";
	      document.getElementById('grp_resistance_val'+n).innerHTML="";
	      document.getElementById('prendre_grp'+n+'_btn').className="button_hidden";
	    }
	</script>
      </article>
      <article class="cadre" id="calcul_puissance">
	<header><h3>Vérification de puissance</h3></header>
	  <div class='block_form1'>
	    <label for="resistance_link">Résistance</label><input type="number" name="resistance" id="resistance_link" disabled></input>
	    <br>
	    <label for="tension">Tension aux bornes<small>(en Volt)</small></label>
	    <input type="number" value="9" name="tension" id="tension"></input>
	    <br>
	    <label for="puissance">Puissance à dissiper<small>(en Watt)</small></label>
	    <input type="number" value="" name="puissance" id="puissance" disabled></input>
	    <br>
	    <button OnClick="calcul_puissance();" title="Vérifier la puissance">Calculer !</button>
	    <br>
	    <span ><small id="indication_puissance"> </small></span>
	    </div>
	  <script>
	  document.getElementById('resistance_link').value=document.getElementById('resistance').value;
	  
	  function calcul_puissance(){
	    var v_U=parseFloat(document.getElementById('tension').value);
	    var v_R=parseFloat(document.getElementById('resistance').value);
	    var v_P=(v_U*v_U)/v_R;
	    var msg="ndef";
	    
	    if (v_P>=1){
	      msg="Attention : seul des resistances de puissance".concat(((v_P>=3)?" bobinées ":" "),"peuvent supporter plus de ",((v_P>=3)?3:1), "W !");
	    } else if (v_P>=0.5){
	      msg="Attention : il faut utiliser des résistances haute tension ou des résistances de puissance pour supporter plus de 0,5W !";
	    } else {
	      msg="Note : les résistances métalliques (bleu ou vert) génèrent moins de bruit que des résistances carbone (marron).";
	    }
	    document.getElementById('puissance').value=Math.round(v_P*1000)/1000;
	    document.getElementById('indication_puissance').innerHTML=msg;
	  }
	  </script>
      </article>
      <article class="cadre" id="mini_calc">
	    <header><h3>Mini calculatrice</h3></header>
	    <div class=' '>
	       <span><input type="text" value="" name="calc_in" id="calc_in" size=20 onchange="mini_calc()" placeholder="r // ( ((a+b)*(a-b)) / c )"></input>=<span id="calc_out"></span></span>
	    <div>
	    <script>
	      function parse_and_compute(formule){
		var res=formule.replace(/\([\s]*([0-9.]+)[\s]*\)/,function(x,y){return y;});
		while ((/(^|\()[\s]*([0-9.]+)[\s]*(\/\/|\+|-|\*|\/)[\s]*([0-9.]+)[\s]*(\)|$)/.test(res))){
		 res=res.replace(/(^|\()[\s]*([0-9.]+)[\s]*\/\/[\s]*([0-9.]+)[\s]*(\)|$)/g,
		    function(x,a,y,z,b){
					return resistances_en_parallele(parseFloat(y),parseFloat(z));
				    }
		    ).replace(/(^|\()[\s]*([0-9.]+)[\s]*\+[\s]*([0-9.]+)[\s]*(\)|$)/g,
		    function(x,a,y,z,b){
					return parseFloat(y)+parseFloat(z);
				    }
		    ).replace(/(^|\()[\s]*([0-9.]+)[\s]*-[\s]*([0-9.]+)[\s]*(\)|$)/g,
		    function(x,a,y,z,b){
					return y-z;
				    }
		    ).replace(/(^|\()[\s]*([0-9.]+)[\s]*\*[\s]*([0-9.]+)[\s]*(\)|$)/g,
		    function(x,a,y,z,b){
					return y*z;
				    }
		    ).replace(/(^|\()[\s]*([0-9.]+)[\s]*\/[\s]*([0-9.]+)[\s]*(\)|$)/g,
		    function(x,a,y,z,b){
					return y/z;
				    }
		    );
		  }
		  return res;
	    }
	    function mini_calc(){
	      var v_in=document.getElementById('calc_in').value;
	      document.getElementById('calc_out').innerHTML=parse_and_compute(v_in);
	      //~ document.getElementById('calc_in').innerHTML=parse_and_compute(v_in);
	    }
	  </script>
      </article>
      <article class="cadre" id="diviseur_tension">
	    <header><h3>Calcul des résistances d'un pont diviseur de tension</h3></header>
	     <div class='block_form1'>
<!--
	      <label for="t_out">Charge (résistance en entrée)</label>
	      <input type="float" value="0" name="charge" id="charge"></input>
	      <br>
-->
	      <label for="ecart_link">Tolérance approximative <small>(en %)</small></label><input  id="ecart_link" disabled></input>
	      <br>
	      <label for="nbresistances_link">Nombre max. de resistances pour chaque R</label><input  id="nbresistances_link" disabled></input>
	      <br>
	      <label for="t_in">U : Tension d'entrée <small>(en V)</small></label>
	      <input type="number" step="0.1" value="9" name="t_in" id="t_in"></input>
	      <br>
	      <label for="t_out">U2 : Tension de sortie<small>(en V)</small></label>
	      <input type="number"  step="0.1" value="0.2" name="t_out" id="t_out"></input>
	      <br>
	      <label for="charge_opt">Avec charge ?</label>
	      <input type="checkbox"  name="charge_opt" id="charge_opt" onchange="set_charge_opt(this.checked);"></input>
	      <br>
	      <style>
		#block_charge_opt{
		  display:none;
		}
	      </style>
	      <div id='block_charge_opt' >
		<label for="charge_in">Re : Résistance en entrée <small>(en série avec R1; valeur en Ohm)</small></label>
		<input type="number" step="1" value="0" name="charge_in" id="charge_in"></input>
		<br>
		<label for="charge_out">Rs : Résistance de sortie <small>(valeur en Ohm)</small></label>
		<input type="number" step="1" value="4" name="charge_out" id="charge_out"></input>
		<br>
	      </div>
	      <button OnClick="calcul_div_tension();">Chercher !</button>
	      <br>

<!--
	      		  ctx.strokeStyle=ctx.fillStyle;
		  ctx.fillText("Us =", x+70,18);
		  ctx.fillText("Ue * R2",x+100,10);
		  ctx.fillText("R1 + R2",x+100,25);
		  ctx.beginPath();
		  ctx.moveTo(x+100,15);
		  ctx.lineTo(x+135,15);
		  ctx.stroke();
-->
	      <p id="formule_div_tension"></p>
	      <p id="solution_div_tension"></p>
	      <br>
	      <canvas id="monCanvas" width="200" height="150" style="border:1px solid #c3c3c3;">
  Votre navigateur ne supporte pas l'élément &lt;canvas&gt;.
  </canvas>
	      <script>
		document.getElementById('ecart_link').value=document.getElementById('ecart').value;
		document.getElementById('nbresistances_link').value=document.getElementById('nbresistances').value;
		var bool_charge_set;
		var formule_verif;
		// Equation (without charge) :
		//U2=U*(R2)/(R1+R2) ->
		//U2/R2=U/(R1+R2) ->
		//R2/U2=(R1+R2)/U ->
		//R2=(R1+R2)U2/U ->
		//R2-(R2*U2/U)=R1*U2/U ->
		//R2*U/U2 - R2 = R1 -> R1 !!!
		//R2*(U/U2 - 1) = R1 ->
		//R2= R1/(U/U2 - 1) -> R2 !!!
	        // with charge : sub R2 by R2' = (R2 // Rs) (we can compute R2')

		function set_charge_opt(v_checked){
		  bool_charge_set=v_checked;
		  document.getElementById('block_charge_opt').style.display=(v_checked)?'block':'none';
		  // Equation (without charge) :
		  //U2=U*(R2)/(R1+R2)
		  // Equation (with charge Rs) :
		  //U2=U*(R2*Rs)/((R1*Rs)+(R2*Rs)+ (R1*R2))
		  formule_verif=(v_checked)?"U2=U*( (R2*Rs) / ( ( ((R1+Re)*Rs) + (R2*Rs) ) + ((R1+Re)*R2) ) )":"U2=U*( R2 / (R1+R2) )";//warning ! the function to compute values only accept binary operators
		  document.getElementById("formule_div_tension").innerHTML=formule_verif;
		  
		}
		function calcul_div_tension(){
		    var v_entree=parseFloat(document.getElementById("t_in").value);
		    var v_sortie=parseFloat(document.getElementById("t_out").value);
		    var r_entree=parseFloat(document.getElementById("charge_in").value);
		    var r_sortie=parseFloat(document.getElementById("charge_out").value);
		    
		    var stock={};
		    var stock_parse_tab=document.getElementById('mon_stock').value.split(" ");
		    var max_qte=parseInt(document.getElementById('nbresistances').value);
		    var v_tolerance;

		    // reinitialization of the output
		    reformat_input_stock();// include quantification between { }
		    var comb_final_set=calcul_combinaisons(max_qte);
		    var v_solution=[];
		    var v_r1;
		    var v_r2;
		    var v_r2rl;
		    var v_solution_r;
		    var v_order;
		    var v_formule_verif;
		    // try without any loop with Re as R1
		    if (bool_charge_set){
		      //R2' = R1'/(U/U2 - 1)
		      //  R2 = Rs*R2' / Rs-R2'
		      v_r2rl=((r+r_entree)/((v_entree/v_sortie)-1));
		      v_r2=((r_sortie*v_r2rl)/(r_sortie-v_r2rl));//missing precision
		      v_solution=search_group(v_r2,v_tolerance,comb_final_set);
		      if (v_solution.length>0){
			    //~ console.log(v_solution_r);
			    document.getElementById("solution_div_tension").innerHTML="".concat(
			    "<strong>","R2","</strong>"," = ",r," = ",v_solution[0][1],"<br>",
			    "<strong>","R1","</strong>"," = ",0);

			    v_formule_verif=formule_verif.replace(/R1/g,0).replace(/R2/g,r).replace(/U2/g,v_sortie).replace(/U/g,v_entree).replace(/Re/g,r_entree).replace(/Rs/g,r_sortie);
			    
			    document.getElementById("formule_div_tension").innerHTML=v_formule_verif.concat(" = ",parse_and_compute(v_formule_verif.replace(/^.*=/,"")));
			    shake("solution_div_tension")
			    return true;
		      }
		    }
		    for (var r in comb_final_set){
			v_tolerance=(parseFloat(document.getElementById('ecart').value)*r)/100;
			if (bool_charge_set){
			  //R1' = R2'*U/U2 - R2'
			  //  R1' = (R1 + Re)      R2' = (R2 // Rs)
			  //R2' = R1'/(U/U2 - 1)
			  //  R2 = Rs*R2' / Rs-R2'
			  v_r2rl=resistances_en_parallele(r,r_sortie);
			  v_r1=(((v_r2rl*v_entree)/v_sortie)-v_r2rl)-r_entree;
			  //~ v_r1=-1;//disable the search with R2 as reference
			  v_r2rl=((r+r_entree)/((v_entree/v_sortie)-1));
			  v_r2=((r_sortie*v_r2rl)/(r_sortie-v_r2rl));//missing precision
			  //~ v_r2=-1;//disable the search with R1 as reference
			} else {
			  //R1 = R2*U/U2 - R2
			  //R2 = R1/(U/U2 - 1)
			  v_r1=((r*v_entree)/v_sortie)-r;
			  v_r2=((r)/((v_entree/v_sortie)-1));
			}
			if ((v_r1<0)&&(v_r2<0)){continue;}
			//~ console.log(r,v_entree,v_sortie,v_r1,v_r2);
			v_solution_r=search_group(r,v_tolerance,comb_final_set);
			if (v_solution_r.length>0){//check if the tolerance for the current resistor is enough
			  if (v_r1>0){
			    v_order=["R2","R1",Math.round(v_r1)];
			    v_solution=search_group(v_r1,v_tolerance,comb_final_set);
			  }
			  if ((v_r2>0)&&(v_solution.length==0)){
			    v_order=["R1","R2",Math.round(v_r2)];
			    v_solution=search_group(v_r2,v_tolerance,comb_final_set);
			  }
			  if (v_solution.length>0){
			    v_formule_verif=formule_verif.replace(new RegExp(v_order[0],'g'),r).replace(new RegExp(v_order[1],'g'),v_order[2]).replace(/U2/g,v_sortie).replace(/U/g,v_entree).replace(/Re/g,r_entree).replace(/Rs/g,r_sortie);
			    document.getElementById("formule_div_tension").innerHTML=v_formule_verif.concat(" &asymp; ",Math.round(parse_and_compute(v_formule_verif.replace(/^.*=/,""))*10000)/10000);
			    
			    document.getElementById("solution_div_tension").innerHTML="".concat(
			    "<strong>",v_order[0],"</strong>"," = ",r," = ",v_solution_r[0][1],"<br>",
			    "<strong>",v_order[1],"</strong>"," = ",v_order[2]," = ",v_solution[0][1]);
			    shake("solution_div_tension")
			    return true;
			  }
			}
		    }
		    document.getElementById("solution_div_tension").innerHTML="Pas de solution trouver en fouillant dans le stock. Peut-être avez vous un régulateur de tension dans votre stock...";
		    return false;
		}
		
		var c=document.getElementById("monCanvas");
		var canvOK=1;
		try {c.getContext("2d");}
		catch (er) {canvOK=0;}
		if (canvOK==1){
		  var ctx=c.getContext("2d");
		  var x=0;
		  var y=0;
		  
		  ctx.fillStyle="black";
		  ctx.font="10px Sans-Serif";
		  
		  ctx.beginPath();
		  //~ y=20;
		  ctx.moveTo(30,y+10);
		  ctx.lineTo(85,y+10);
		  ctx.lineTo(85,y+20);
		  ctx.strokeRect(75,y+20,20,40);
		  ctx.moveTo(85,y+60);
		  ctx.lineTo(85,y+80);
		  ctx.moveTo(85,y+70);
		  ctx.lineTo(135,y+70)
		  ctx.moveTo(85,y+130);
		  ctx.strokeRect(75,y+80,20,40);
		  ctx.moveTo(85,y+120);
		  ctx.lineTo(85,y+130)
		  ctx.moveTo(30,y+130);
		  ctx.lineTo(135,y+130);
		  ctx.strokeRect(170,y+80,20,40);
		  ctx.moveTo(180,y+80);
		  ctx.lineTo(180,y+70)
		  ctx.lineTo(145,y+70);
		  ctx.moveTo(180,y+120);
		  ctx.lineTo(180,y+130)
		  ctx.lineTo(145,y+130);
		  ctx.stroke();
		  ctx.fillText ("R1", 80, y+30); 
		  ctx.fillText ("R2", 80, y+90);
		  ctx.fillText ("RS", 175, y+90);
		  //tensions
		  ctx.fillStyle="green";
		  ctx.strokeStyle=ctx.fillStyle;
		  ctx.beginPath();
		  ctx.moveTo(110,y+25);
		  ctx.lineTo(110,y+60);
		  ctx.stroke(); 
		  ctx.beginPath();
		  ctx.moveTo(110,y+20);
		  ctx.lineTo(105,y+25);
		  ctx.lineTo(115,y+25);
		  ctx.fill();
		  ctx.fillText ("U1", 115, y+45);
		  ctx.beginPath();
		  ctx.moveTo(125,y+85);
		  ctx.lineTo(125,y+120);
		  ctx.stroke(); 
		  ctx.beginPath();
		  ctx.moveTo(125,y+80);
		  ctx.lineTo(120,y+85);
		  ctx.lineTo(130,y+85);
		  ctx.fill();
		  ctx.fillText ("U2", 130, y+105);
		  ctx.beginPath();
		  ctx.moveTo(30,y+25);
		  ctx.lineTo(30,y+120);
		  ctx.stroke(); 
		  ctx.beginPath();
		  ctx.moveTo(30,y+20);
		  ctx.lineTo(25,y+25);
		  ctx.lineTo(35,y+25);
		  ctx.fill(); 
		  ctx.fillText ("U", 35, y+70);

		  
		  }
		  set_charge_opt(false);
	      </script>
	    </div>
      </article>
      <article class="cadre-view droppable" id='stock_view' ondrop="drop_on_stock(event)" ondragover="allowDrop(event)">
	</article>
      </section>
      <footer>
	    
	<div> DIY. 2015 Copyleft : Sébastien Gillot</div><div></div>Tests navigateurs :<div>Chromium : Ok; </div><div><br>Mozilla : Ok;<br></div><div>Webkit:fonctionnel.</div></div></div>
	<div>
	     <p>
	     <a  href="https://github.com/luffah/diy-heaven/issues">Report a bug !</a> <br>
	    </p>
	</div>

      </footer>
      <!--Javascript-->
	<!-- functions for reading the value of a resistance -->
	<script>
	function parse_input(r_val){
	  var res=r_val.replace(/(\[.*)/,'');
	  var pos_mult=res.search(/(k|m)/i);
	  if (pos_mult>-1){
	    var v_mult=(res.charAt(pos_mult)=='m'?1000000:1000);
	    res=parseFloat(res.replace(/(k|m)$/i,'').replace(/(k|m)/i,'.'))*v_mult;
	  } else {
	    res=parseFloat(res);
	  }
	  return res;
	}
	</script>
    <script>
	<!--(Pour le calcul des combinaisons)-->
	<!-- Important note : this program use the concept of stock, 2 type of stock are used:
	<!-- 	- simple stock represents the reserves
	<!-- 	- computed stock represents all combinations possibles
	<!--
	<!-- Moreover the stock contains the value of the componants represented by the different formula (or set of componants) avaible :
	<!--     { "formula1" : {"componant1":qte,"componant2":qte}, "formula2" : {"componant3":qte,"componant2":qte} }
	<!-- So we have set of value associated to a set of set of componants.
	<!--	
	<!-- Here the structure of the stock concept.
	<!--   simple stock = { value1 : { "componant1" : {"componant1":qte}},
	<!--             	value2 : { "componant2" : {"componant2":qte}},... }
	<!--   computed stock = { value1 : { "formula1" : {"componant1":qte,"componant2":qte}},
	<!--             value2 : { "formula2" : {"componant1":qte,... }},"formula3" : {"componant1":qte,... }},... }
	-->
	
	<!--stock related functions-->
	function formula_copy(a){
	  var res={'_nb_':0};
	  var v_k;
	  for (v_k in a){
	    if (v_k!='_nb_'){
	      res[v_k]=a[v_k];
	      res['_nb_']=res['_nb_']+a[v_k];
	    }
	  }
	  return res;
	}

	function formula_set_copy(a){// input : 1 set of formulas 
	  var res={};
	  var v_k;
	  for (v_k in a){
	    res[v_k]=formula_copy(a[v_k]);
	  }
	  return res;
	}

	function formula_union(a,b){// input : 2 formulas
	  var res=formula_copy(a);
	  var v_k;
	  for (v_k in b){
	    if (v_k!='_nb_'){
	      if (v_k in res){
		  res[v_k]=res[v_k]+b[v_k];
	      } else {
		  res[v_k]=b[v_k];
	      }
	      res['_nb_']=res['_nb_']+b[v_k];
	    }
	  }
	  return res;
	}

	function formula_equal(a,b){// input : 2 formulas
	  if (a['_nb_']!=b['_nb_']){
	    return false;
	  }
	  var v_k;
	  for (v_k in a){
	    if ((!v_k in b) || (a[v_k]!=b[v_k])){
	      return false;
	    }
	  }
	  return true;
	}
	
	function exist_equal_formula(a,b){//input : b is a set of formulas,  "a" is a formula {"componant1":qte,"componant2":qte}
	  for (var f in b){
	      if (formula_equal(a,b[f])){
		return true;
	      }
	  }
	  return false;
	}
	
	function test_a_in_stock_b(a,b){//input : "b" is a stock, "a" is a formula {"componant1":qte,"componant2":qte}
	  var v;
	  for (var k in a){
	    if (k!='_nb_'){
	      v=parseInt(parse_input(k));
	      if (!(v in b)  || (a[k] > b[v][k][k])) {
		return false;
	      }
	    } 
	  }
	  return true
	}
	
	function need_better_solution(a,max_qte){// input : { "formula1" : {"componant1":qte,"componant2":qte,'_nb_':x}, "formula2" : ...}
	  var i=0;
	  for (var k in a){
	      if ( a[k]['_nb_'] < (max_qte/2) + 1 ) {//minimum number of components wished is under half of the max quantity
		i++;
		if (i==3){
		  return false;
		}
	      }
	  }
	  return true;
	}
	function remove_useless_solutions(a){// input : { "formula1" : {"componant1":qte,"componant2":qte,'_nb_':x}, "formula2" : ...}
	  var i=0;
	  var nb_solution=[];
	  for (var k in a){
	      nb_solution[i]=[a[k]['_nb_'],k];
	      i++;
	  }
	  if (i>3){
	    nb_solution.sort(function(a,b){return a[0]-b[0];});
	    while (i>3){
	      delete a[nb_solution.pop()[1]];
	      i--;
	    }
	  }
	  return a;
	}
	
	<!-- functions to prepare all possible results of combinations -->
	function populate_combine_stock(t_stock,orig_stock,func_combi,symb_combi,max_qte){
	    //~ console.log(t_stock,orig_stock,func_combi,symb_combi,max_qte);
	    var v;
	    var res={};
	    var formula;
	    var formula_stock={};
	    for (var k in t_stock) {
	      if (k!="_nb_"){
		res[Math.round(k*100)/100]=formula_set_copy(t_stock[k]);
	      }
	    }
	    for (var h in t_stock) {  for (var k in t_stock[h]) {
	      for (var i in t_stock) { for (var j in t_stock[i]){
		v=Math.round(func_combi(h,i)*100)/100;
		//~ if((!(v in res))||(need_better_solution(res[v],max_qte))){
		//~ if((!(v in res))||(need_better_solution(res[v],max_qte))){
		  formula_stock=formula_union(t_stock[h][k],t_stock[i][j]);
		  if ( (formula_stock['_nb_']<=max_qte) &&
		    test_a_in_stock_b(formula_stock,orig_stock) ){
		      formula='('+k+' '+symb_combi+' '+j+')';
		      if(!(v in res)){
			res[v]={};
			res[v][formula]=formula_stock;
		      } else if (!exist_equal_formula(formula_stock,res[v])){
			res[v][formula]=formula_stock;
			res[v]=remove_useless_solutions(res[v]);
		      }
		  }
		//~ }
	      }}
	    }}
	    return res;
	}
	function calcul_combinaisons(max_qte){
	  // stocks representation
	  var stock={'_nb_':0};//all components avaible with their quantity
	  var init_set={'_nb_':0};//representation all components avaible without their quantity
	  //values to iterate
	  var i;
	  var v_nb;
	  var v_k;
	  var k;
	  var k_nb;
	  var qte;
	  // build stocks
	  var stock_parse_tab=document.getElementById('mon_stock').value.split(" ");
	  for (i=0; (i <stock_parse_tab.length) && (init_set['_nb_'] < 16); i++){// for best perfomance we limit the number of different resistor
	      //~ console.log(stock_parse_tab[i]);
	      k=stock_parse_tab[i];
	      qte=parseInt(k.replace(/(.*\{)/,'').replace(/(\})/,''));
	      k=k.replace(/(\{.*)/,'');
	      v_k=parse_input(k);
	      if ((v_k in stock) && (k in stock[v_k])){
		v_nb=stock[v_k][k][k]+qte;
	      } else {
		v_nb=qte;
		init_set['_nb_']=init_set['_nb_']+1;
		init_set[v_k]={};
		init_set[v_k][k]={};
		init_set[v_k][k]['_nb_']=1;
		init_set[v_k][k][k]=1;
	      }
	      stock['_nb_']=stock['_nb_']+qte;
	      
	      stock[v_k]={};
	      stock[v_k][k]={};
	      stock[v_k][k]['_nb_']=v_nb;
	      stock[v_k][k][k]=v_nb;
	  }
	  //~ console.log(stock);
	  //~ console.log(init_set);
	  // build combinations
	  var comb_serial_set=populate_combine_stock(init_set,stock,resistances_en_serie,'+',max_qte);
	  var comb_parallel_set=populate_combine_stock(comb_serial_set,stock,resistances_en_parallele,'//',max_qte);
	  //~ console.log(comb_parallel_set);
	  return populate_combine_stock(comb_parallel_set,stock,resistances_en_serie,'+',max_qte);
      }
	function parse_and_recompute_formula(formule,f_stock){
	  var res=formule;
	  res=res.replace(/(^|[ \(\/\+])([0-9.]+([km][0-9]*)?(\[[a-z0-9.,]*\])?)/ig,
	      function(x,y,z){
				  //~ console.log('xyz get values->',x,y,z,'=',f_stock[z]);
				  return y.concat(f_stock[z]);
			    }
	  );
	  while (/\([\s]*([0-9.]+)[\s]*(\/\/|\+)[\s]*([0-9.]+)[\s]*\)/.test(res)){
	    res=res.replace(/\([\s]*([0-9.]+)[\s]*\/\/[\s]*([0-9.]+)[\s]*\)/g,
		function(x,y,z){
				    //~ console.log('xyz compute parrallel->',x,y,z,'=',resistances_en_parallele(y,z));
				    return resistances_en_parallele(y,z);
		}
	      ).replace(/\([\s]*([0-9.]+)[\s]*\+[\s]*([0-9.]+)[\s]*\)/g,
		function(x,y,z){
		  
				    //~ console.log('xyz compute serial->',x,y,z,'=',resistances_en_serie(y,z));
				    return resistances_en_serie(y,z);
		}
	      );
	  }
	  return parseFloat(res);
	}
	
	<!-- functions to find bests results of combinations -->
	function search_group(v_resistance,v_ecart,stock){
	  var res=[];
	  var i=0;
	  var diff;
	  var min_val_stock={};
	  var max_val_stock={};
	  var min_val;
	  var max_val;
	  var val;
	  var tab_desc;
	  var tol;
	  for (var k in stock) {
	      //~ console.log(k,stock[k],v_ecart);
	      var diff=Math.abs(k - v_resistance );
	      if ( diff <= v_ecart ){
		for (var formula in stock[k]){
		  //~ console.log(k,stock[k],formula,v_ecart);
		  if (formula.indexOf("[")>0) {
		    for (var c in stock[k][formula]){
			if (c=="_nb_"){
			    continue;
			}
			if (!(c in min_val_stock)) {
			  tol="";
			  if (c.indexOf("[")>0){ 
			    tab_desc=get_tab_desc_in_desc(c);
			    val=compute_value(tab_desc[0],tab_desc[1],tab_desc[2],tab_desc[3],tab_desc[4],tab_desc[5]);
			    tol=tab_desc[4];
			  } else {
			    val=parse_input(c);
			  }
			  if (tol==""){
			    min_val_stock[c]=val;
			    max_val_stock[c]=val;
			  } else {
			    //~ console.log(c,tab_desc,val,tol,parseFloat(tol)*val);
			    min_val_stock[c]=(val-(parseFloat(tol)*val));
			    max_val_stock[c]=(val+(parseFloat(tol)*val));
			  }
			}
		    }
		    min_val=parse_and_recompute_formula(formula,min_val_stock);
		    max_val=parse_and_recompute_formula(formula,max_val_stock);
		    //~ console.log(formula,min_val,max_val);
		    diff=Math.abs(min_val - v_resistance );
		    var diff_max=Math.abs(max_val - v_resistance );
		    if(diff<diff_max){
			diff=diff_max;
		    }
		  }
		  if ( diff <= v_ecart ){ 
		    res[i]=[Math.round(k),formula,Math.round(diff)];
		    i++;
		  }
		}
	      }
	  }
	  //~ console.log(res);
	  res.sort(function(a, b){return a[2]-b[2]})
	  return res;
	}
	
	<!-- functions for computing combinations -->
	function resistances_en_serie(a,b){
	  return parseInt(a)+parseInt(b);
	}
	function resistances_en_parallele(a,b){
	  var v_a=parseInt(a);
	  var v_b=parseInt(b);
	  if (v_a==v_b){
	    return v_a/2;
	  } else {
	    return ((v_a*v_b)/(v_a+v_b));
	  }
	}
	
    </script>
<!---->
<!--Déchiffrage d'une résistance-->
<script>
	var my_resistor={};
        var my_resistor_mode;
	//mode values
  	var RESISTOR_BOBINE=1;
	var RESISTOR_CMS=2;
	// RESISTOR with rings mode=number of rings

	var color_tab_val={"":"resistor_color_None",
			    0:"resistor_color_Black",
			    1:"resistor_color_Brown",
			    4:"resistor_color_Yellow",
			    7:"resistor_color_Violet",
			    2:"resistor_color_Red",
			    5:"resistor_color_Green",
			    8:"resistor_color_Gray",
			    3:"resistor_color_Orange",
			    6:"resistor_color_Blue",
			    9:"resistor_color_White"};
			    
	var color_tab_mult={"":"resistor_color_None",
			    0.01:"resistor_color_Gold",
			    0.1:"resistor_color_Silver",
			    1:"resistor_color_Black",
			    10:"resistor_color_Brown",
			    100:"resistor_color_Red",
			    1000:"resistor_color_Orange",
			    10000:"resistor_color_Yellow",
			    100000:"resistor_color_Green",
			    1000000:"resistor_color_Blue",
			    10000000:"resistor_color_Violet"};
	var color_tab_tolerance={"":"resistor_color_None",
				  0.20:"resistor_color_None",
				  0.10:"resistor_color_Silver",
				  0.05:"resistor_color_Gold",
				  0.01:"resistor_color_Brown",
				  0.02:"resistor_color_Red",
				  0.005:"resistor_color_Green",
				  0.0025:"resistor_color_Blue",
				  0.001:"resistor_color_Violet"};
	var color_tab_corps={"":"resistor_color_None",
				  "c":"resistor_color_Beige",
				  "m":"resistor_color_Cyan",
				  "mv":"resistor_color_Green",
				  "mr":"resistor_color_Red"};

	function use_abbrv(val){
	  return (val+" ").replace(/(0){6} /g,'m ').replace(/(0){3} /g,'k ').replace(/(0){6}\)/g,'m)').replace(/(0){3}\)/g,'k)').replace(/ $/,'');
	}

	function get_resistor_desc(){
	  var desc="";
	  if (my_resistor_mode>2){
	    desc=desc.concat(
	    ('val1' in my_resistor) ? my_resistor['val1']:"",
	    ",",('val2' in my_resistor) ? my_resistor['val2']:"",
	    ",",('val3' in my_resistor) ? my_resistor['val3']:"",
	    ",",('mult' in my_resistor) ? use_abbrv(my_resistor['mult']):"",
	    ",",('tolerance' in my_resistor) ? my_resistor['tolerance']:"",
	    ",",('corps' in my_resistor) ? my_resistor['corps']:"c");
	  } else if (my_resistor_mode==RESISTOR_CMS){
	    desc=desc.concat(
	    ('val1' in my_resistor) ? my_resistor['val1']:" ",
	    ('val2' in my_resistor) ? my_resistor['val2']:" ",
	    ('val3' in my_resistor) ? my_resistor['val3']:" ");
	  } else if (my_resistor_mode==RESISTOR_BOBINE){
	    desc=desc.concat(use_abbrv(get_resistor_value()),
	    ",",('pow' in my_resistor) ? my_resistor['pow']:" ",
	    ",",('tolerance' in my_resistor) ? my_resistor['tolerance']:"");
	    
	  }
	  return desc;
	}
	function compute_value(val1,val2,val3,mult,tolerance,type){
	  var val="";
	  if (val1.length>0) {
	    val=parseInt(val1);
	    if (val2.length>0) {
	      val=(val*10)+parseInt(val2);
	    }
	    if (val3.length>0) {
	      if (type=="s"){
		val=val*Math.pow(10,val3);
	      } else {
		val=(val*10)+parseInt(val3);
	      }
	    }
	    if (mult.length>0){
	      val=val*parseInt(mult);
	    }
	  }
	  //~ console.log(val1,val2,val3,mult,tolerance,type,'->',val)
	  return val;
	}
	function get_resistor_value(){	  
	  return compute_value(
		  ('val1' in my_resistor)?""+my_resistor['val1']:"",
		  ('val2' in my_resistor)?""+my_resistor['val2']:"",
		  ('val3' in my_resistor)?""+my_resistor['val3']:"",
		  ('mult' in my_resistor)?""+my_resistor['mult']:"",
		  ('tol' in my_resistor)?""+my_resistor['tol']:"",
		  (my_resistor_mode==RESISTOR_CMS)?"s":""
		  );
	}
	function add_resistor_tolerance_value(val){
	  if ('tolerance' in my_resistor){
		val=val + ' (+/- ' + (val*my_resistor['tolerance']) +')' ;
	  }
	  return val;
	}
	function get_resistor_ref(){
	  return use_abbrv(get_resistor_value()).concat('[',get_resistor_desc(),']');
	}
	function my_resistor_is_complete(){
	   return ( ('val1' in my_resistor) &&
	    (('val2' in my_resistor)||((my_resistor_mode!=RESISTOR_CMS)&&(my_resistor_mode<4))) &&
	    (('val3' in my_resistor)||((my_resistor_mode!=RESISTOR_CMS)&&(my_resistor_mode<5))) &&
	    (('mult' in my_resistor)||(my_resistor_mode==RESISTOR_CMS)) &&
	    (('tolerance' in my_resistor)||(my_resistor_mode==RESISTOR_CMS)) &&
	    (('pow' in my_resistor)||(my_resistor_mode!=RESISTOR_BOBINE)) );
	}
        function update_value(do_store){
	  var desc=get_resistor_desc();
	  var desc_field_id=(my_resistor_mode>2)?'resistor_desc':(my_resistor_mode==RESISTOR_BOBINE)?'power_resistor_desc':'cms_resistor_desc';
	  var value_field_id=(my_resistor_mode>2)?'resistor_value':(my_resistor_mode==RESISTOR_BOBINE)?'power_resistor_value':'cms_resistor_value';
	  document.getElementById(desc_field_id).value=desc;
	  if (my_resistor_is_complete() && do_store){
	    var ref=get_resistor_ref();
	    if (is_acceptable(ref)){
	      document.getElementById('mon_stock').value=document.getElementById('mon_stock').value.concat(" ",ref);
	      return true;
	    }
	  } else {
	    var val=get_resistor_value();
	    document.getElementById(value_field_id).innerHTML=( val !="" )?(
		  "R="+use_abbrv(add_resistor_tolerance_value(val))+" <small>Ohm</small>"):"?";
	    document.getElementById('stock_add_btn').disabled=( !(my_resistor_is_complete()) );
	    document.getElementById('stock_add_btn').className=( my_resistor_is_complete() )?'':'button_disabled';
	  }
	  return false;
        }
        function set_mode(val){
          my_resistor_mode=val;
	  document.getElementById('power_resistor_block').style.display = (val==RESISTOR_BOBINE)? 'inline-block' :'none';
	  document.getElementById('cms_resistor_block').style.display = (val==RESISTOR_CMS)? 'inline-block' :'none';
	  document.getElementById('ring_resistor_block').style.display = ((val>2)? 'inline-block' :'none');
	  document.getElementById('mult').style.display = ((val>2)||(val==RESISTOR_BOBINE)) ? 'inline-block' :'none';
          document.getElementById('tol').style.display = ((val>2)||(val==RESISTOR_BOBINE)) ? 'inline-block' :'none';
          document.getElementById('nb_ring').style.display = (val>2) ? 'inline-block' :'none';
	  document.getElementById('value1').style.display = (((val>2)||(val<=2)) ? 'inline-block' :'none');
          document.getElementById('value2').style.display = (((val>3)||(val<=2)) ? 'inline-block' :'none');
          document.getElementById('value3').style.display = (((val>4)||(val<=2)) ? 'inline-block' :'none');
          document.getElementById('coef-temp').style.display = ((val>5) ? 'inline-block' :'none');
          document.getElementById('pow').style.display = ((val==RESISTOR_BOBINE) ? 'inline-block' :'none');

	  //~ if (val<6){
	    //~ document.getElementById('view_ppm').className="resistor_color_None";
	    if (val<5){
	      document.getElementById('view_val3').className="resistor_color_None";
	      delete my_resistor.val3;
	      if (val<4){
		document.getElementById('view_val2').className="resistor_color_None";
		delete my_resistor.val2;
	      }
	      if (val==RESISTOR_CMS){
		delete my_resistor.tolerance;
		delete my_resistor.mult;
	      }
	    }
	  //~ }

          update_value();
        }
	function get_tab_desc_in_desc(desc){//tab_desc format=[val1,val2,val3,mult,tolerance,type];
	  //R[v,v,v,m,t] pour les résistances à bandes
	  //R[vvvm,P,t] pour les résistances bobinées
	  //R[vvm] pour les résistances CMS
	  var pos1=desc.indexOf('[');
	  var pos2=desc.indexOf(']',pos1);
	  var v_desc=((pos1 > -1) &&(pos2 > -1))?desc.substring(pos1+1,pos2):desc;
	  var tab_desc;
	  if (/^[0-9]{3}$/.test(v_desc)){//Type = CMS
	    tab_desc=[v_desc.charAt(0),v_desc.charAt(1),v_desc.charAt(2),"","0","s"];
	  } else {
	    var def;
	    var tab_val=[];
	    tab_desc=v_desc.split(',');
	    //~ console.log(desc,tab_desc);
	    if (/^[0-9.]+[km]*,[0-9.]+W,[0-9.]+$/i.test(v_desc)){//Type = Bobine
	      tab_desc[4]=tab_desc[2];
	      tab_desc[6]=tab_desc[1];
	      def=["0","","","1","0.01","b","1W"];
	    } else {//Type = ring (we assume we don't need to get the desc of others resistor types)
	      def=["0","","","1","0.01","c"];
	    }
	    for (var i=0; i<def.length;i++){//set default if not defined
	      if ((tab_desc.length<i+1) || (tab_desc[i]=="")){
		  tab_desc[i]=def[i];
	      }
	    }
	    if (tab_desc[0].length>1){
	      pos1=tab_desc[0].search(/(k|m)/);
	      pos1=((pos1==-1) && (tab_desc[0].length>3))? 3 : pos1;
	      tab_desc[1]=(pos1>1)? tab_desc[0].charAt(1):"";
	      tab_desc[2]=(pos1>2)? tab_desc[0].charAt(2):"";
	      if (pos1>0){
		if ((/^[0]*[km]$/).test(tab_desc[0].substr(pos1))){
		  tab_desc[3]="1".concat(tab_desc[0].substr(pos1));
		} // else there is an hybrid notation like 7k4 for 7400
	      }
	      tab_desc[0]=tab_desc[0].charAt(0);
	    } 
	    if (tab_desc[3].length>1){
	      tab_desc[3]=tab_desc[3].replace('k','000').replace('m','000000');
	    }
	  }
	  return tab_desc;
	}
	function get_value_from_tab_desc(tab_desc){//tab_desc format=[val1,val2,val3,mult,tolerance,type];
	  return compute_value(tab_desc[0],tab_desc[1],tab_desc[2],tab_desc[3],tab_desc[4],tab_desc[5]);
	}
	function get_resistor_color_tab(desc){
	  var color_tab=['resistor_color_None',
			  'resistor_color_None',
			  'resistor_color_None',
			  'resistor_color_None',
			  'resistor_color_None',
			  'resistor_color_None'];
	  
	  var tab_desc=get_tab_desc_in_desc(desc);
	  color_tab[0]=color_tab_val[tab_desc[0]];
	  color_tab[1]=color_tab_val[tab_desc[1]];
	  color_tab[2]=color_tab_val[tab_desc[2]];
	  color_tab[3]=color_tab_mult[tab_desc[3]];
	  color_tab[4]=color_tab_tolerance[tab_desc[4]];
	  color_tab[5]=color_tab_corps[tab_desc[5]];
	  return color_tab;
	}
	function set_my_resistor(key,val){
	  unblink();
          my_resistor[key]=val;
          update_value();
        }
        set_mode(4);
	</script>
	<!--Setters-->
	<script>
        function val1_set(val){
          if (my_resistor_mode>2){
	    document.getElementById('view_val1').className=color_tab_val[val];
	  }
	  set_my_resistor('val1',val);
        }
        function val2_set(val){
          if (my_resistor_mode>2){
	    document.getElementById('view_val2').className=color_tab_val[val];
	  }
          set_my_resistor('val2',val);
        }
        function val3_set(val){
          if (my_resistor_mode>2){
	    document.getElementById('view_val3').className=color_tab_val[val];
	  }
          set_my_resistor('val3',val);
        }
        function mult_set(val){
          document.getElementById('view_mult').className=color_tab_mult[val];
          set_my_resistor('mult',val);
        }
        function tolerance_set(val){
          document.getElementById('view_tol').className=color_tab_tolerance[val];
          set_my_resistor('tolerance',val);
        }
        function pow_set(val){
          set_my_resistor('pow',val+'W');
        }
        function corps_set(val){
	  var firstchar=val.charAt(0);
	  if ((firstchar=='c') || (firstchar=='m')){
	     set_mode((my_resistor_mode>2)?my_resistor_mode:4);
	     document.getElementById('resistor_body').className="resistor_view "+color_tab_corps[val];
	  } else {
	    set_mode((firstchar=='b')?RESISTOR_BOBINE:RESISTOR_CMS);
	  }
          set_my_resistor('corps',val);
        }
        function ppm_set(val,view_class){
          document.getElementById('view_ppm').className=view_class;
        }
	</script>
<!--Pour la gestion du stock-->
      <script>
	function add_to_stock(data) {
	    document.getElementById('mon_stock').value=document.getElementById('mon_stock').value.concat(" ",data);
	    //~ console.log(document.getElementById('mon_stock').value);
	    update_stock();
	}
	function secure_data(data){
	  return data.replace(/</g,'&lt;').replace(/>/g,'&gt;');
	}
	function is_standard(data){
	  //~ console.log(data,data.search(/^[0-9]+[km]?\[[0-9],[0-9]*,[0-9]*,[0-9]+[km]?,[a-z0-9.]*(,[a-z0-9.]*)?\]$/i));
	  return (/^[0-9.]+([km][0-9]*)?\[[0-9],[0-9]*,[0-9]*,[01.]+[km]?,[a-z0-9.]*(,[a-z0-9.]*)?\]$/i).test(data);
	}
	function is_power_resistor(data){
	  //~ console.log(data,data.search(/^[0-9]+[km]?\[[0-9],[0-9]*,[0-9]*,[0-9]+[km]?,[a-z0-9.]*(,[a-z0-9.]*)?\]$/i));
	  return (/^[0-9.]+([km][0-9]*)?\[[0-9.]+([km][0-9]*)?,[0-9.]*w(,[a-z0-9.]*)?\]$/i).test(data);
	}
	function is_cms_resistor(data){
	  //~ console.log(data,data.search(/^[0-9]+[km]?\[[0-9],[0-9]*,[0-9]*,[0-9]+[km]?,[a-z0-9.]*(,[a-z0-9.]*)?\]$/i));
	  return (/^[0-9.]+([km][0-9]*)?\[[0-9]{3}\]$/i).test(data);
	}
	function is_acceptable(data){
	  //~ console.log(data,data.search(/^[0-9]+[km]?\[[0-9],[0-9]*,[0-9]*,[0-9]+[km]?,[a-z0-9.]*(,[a-z0-9.]*)?\]$/i));
	  return (/^[0-9.]+([km][0-9]*)?(\[[a-z0-9.,]*\])?$/i).test(data);
	}
	function format_for_acceptable(data){
	  return data.replace(/(^|$)/g,' ').replace(/ [^0-9 ]+[^ ]* /,' ');
	}
	function is_valid_stock(inputField){
	  var isValid = (/^(\s)*[0-9.]+([km][0-9]*)?(\[[a-z0-9.,]*\])?(\{[0-9]+\})?((\s)*[0-9.]+([km][0-9]*)?(\[[a-z0-9.,]*\])?(\{[0-9]+\})?)*(\s)*$/i).test(inputField.value);

	  if (isValid) {
	      inputField.style.backgroundColor = '#bfa';
	  } else {
	      inputField.style.backgroundColor = '#fba';
	  }

	  return isValid;
	}
	function remove_operators(data){
	  return data.replace(/(\(|\)|\+|\/\/)+/g," ").replace(/(\s)+/g," ").replace(/(^\s|\s$)/g,"");
	}
	function reformat_input_stock(){
	  var v_stock=document.getElementById('mon_stock').value;
	  var stock_parse_tab=format_for_acceptable(secure_data(remove_operators(v_stock))).split(" ");
	  var v_stock_hash={};
	  var i;
	  var k;
	  var qte;
	  for (i=0; (i <stock_parse_tab.length); i++){
	      k=stock_parse_tab[i];
	      if (k.search('{')>0){
		qte=parseInt(k.replace(/(.*\{)/,'').replace(/(\})/,''));
		k=k.replace(/(\{.*)/,'');
	      } else {
		qte=1;
	      }
	      if (k in v_stock_hash){
		v_stock_hash[k]=v_stock_hash[k]+qte;
	      } else {
		v_stock_hash[k]=qte;
	      }
	  }
	  v_stock="";
	  delete v_stock_hash[''];
	  for (k in v_stock_hash){
	    v_stock=v_stock.concat(k,"{",v_stock_hash[k],"} ");
	  }
	  document.getElementById('mon_stock').value=v_stock.replace(/(^\s|\s$)/g,"");
	}
	function make_view_from_formatted_input_stock(){
	  var stock_parse_tab=document.getElementById('mon_stock').value.split(" ");
	  var i;
	  var k;
	  var qte;
	  var node=document.getElementById('stock_view');
	  while (node.hasChildNodes()) {
	    node.removeChild(node.lastChild);
	  }
	  for (i=0; (i <stock_parse_tab.length); i++){
	      k=stock_parse_tab[i];
	      qte=parseInt(k.replace(/(.*\{)/,'').replace(/(\})/,''));
	      k=k.replace(/(\{.*)/,'');
	      if (k!=""){
		add_to_stock_view(k,qte);
	      }
	  }
	}
	function add_to_stock_view(data,qte){
	    //~ document.getElementById('stock_view').appendChild(document.getElementById('resistor_view'));
	    if (is_acceptable(data)){
	    var div = document.createElement('tmp_div');
	    var tmp_html="<article ><figure id='".concat(data,"'",
	    " class='resistor_view_canvas rotate_item'",
	    " draggable='true'",
	    " ondragstart=\"event.dataTransfer.setData('text','",data,"');\"",
	    ">");
	    if (is_standard(data)){
	      var span_base=["<span class='","'>&nbsp;&nbsp;</span> "];
	      var resistor_coloration=get_resistor_color_tab(data);
	      //~ console.log("-"+data+"-");
	      tmp_html = tmp_html.concat("&mdash;<span class='resistor_view ",
	      resistor_coloration[5],"'> ",
	      span_base[0],resistor_coloration[0],span_base[1],
	      span_base[0],resistor_coloration[1],span_base[1],
	      span_base[0],resistor_coloration[2],span_base[1],
	      span_base[0],resistor_coloration[3],span_base[1],
	      span_base[0],resistor_coloration[4],span_base[1],
	      "</span>&mdash;");
	    } else if (is_power_resistor(data)){
	      tmp_html = tmp_html.concat("&mdash;",
	      "<span class='resistor_color_Green power_resistor_view'>&nbsp;&nbsp;",data.replace(/.*\[/,"").replace(/\]/,""),"&nbsp;&nbsp;</span>",
	      "&mdash;"
	      );
	    } else if (is_cms_resistor(data)){
	      var tab_desc=get_tab_desc_in_desc(data);
	      tmp_html = tmp_html.concat(
	      "<span class='cms_resistor_view'>",
	      "<span class='resistor_color_Silver relief_left'>&nbsp;&nbsp;</span>",
	      "<span class='resistor_color_Black relief'>&nbsp;",tab_desc[0],tab_desc[1],tab_desc[2],"&nbsp;</span>",
	      "<span class='resistor_color_Silver relief_right'>&nbsp;&nbsp;</span>"
	      ,"</span>"
	      );
	    } else {
	      tmp_html = tmp_html.concat("&mdash;",
	      "<span class='resistor_color_Black'>&nbsp;&nbsp;",data,"&nbsp;&nbsp;</span>",
	      "&mdash;"
	      );
	    }
	    tmp_html=tmp_html.concat("<figcaption>",data,"<span class='shown_data' id='qte",data,"'> &times; ",qte,"</span>","</figcaption>",
	      "</figure>",
	      "<span onmouseover=\"blink_data('qte",data,"',0,'blink_data',200,'shown_data',500);\" onmouseout=\"unblink();\" >",
	      "<button  onclick=\"unblink();add_to_stock('",data,"');\">+</button>",
	      "<button  onclick=\"unblink();stock_extraction_from_formatted_stock('"+data+"');\"",
	      ((qte>1)? (">-"):("class='button_deprecated'>X")),
	      "</button>",
	      "</span>",
	    "</article>");
	    div.innerHTML=tmp_html;
	    document.getElementById('stock_view').appendChild(div);
	  }
	}
	function update_stock(){
	    reformat_input_stock();
	    make_view_from_formatted_input_stock();
	}
	function stock_extraction_from_formatted_stock(formule){
	  var grp_parse_tab=formule.replace(/[(+)]/g,function(x){return ' '+x+' '}).replace(/(\s)+/g," ").split(" ");
	  var i;
	  var new_stock=document.getElementById('mon_stock').value.replace(/(^|$)/g," ");
	  var pos, pos2, pos3;
	  var qte;
	  var detailled_componant;
	  var taken_stock="";
	  for (i=0;i<grp_parse_tab.length;i++){
	    if ((grp_parse_tab[i]=='')||(grp_parse_tab[i]=='(')||(grp_parse_tab[i]==')')||(grp_parse_tab[i]=='+')||(grp_parse_tab[i]=='//')){
	      taken_stock=taken_stock.concat(grp_parse_tab[i]);
	    } else {
	      //~ console.log("|"+grp_parse_tab[i]+"|","|"+new_stock+"|");
	      //check if stock still avaible
	      pos=new_stock.indexOf(" "+grp_parse_tab[i]+"{");
	      if (pos<0){//obsolete : alternative checking : usefull if the formula doesn't contains details
		pos=new_stock.indexOf(" "+grp_parse_tab[i]+"\\[");
		if (pos<0){//if not found, exit
		  return "";
		}
		pos2=new_stock.indexOf("]",pos);
		if (pos2<0){
		  alert(new_stock.slice(pos,pos+grp_parse_tab[i].length+2), " est incomplet. Le format pour indiquer la référence est 'valeur[référence]'. ");
		  return "";
		}

		detailled_componant=new_stock.slice(pos+1,pos2+1);
		taken_stock=taken_stock.concat(detailled_componant);
	      
	      } else {
		taken_stock=taken_stock.concat(grp_parse_tab[i]);
	      }
	      pos2=new_stock.indexOf("{",pos);
	      pos3=new_stock.indexOf("}",pos2);
	      qte=new_stock.substring(pos2+1,pos3);
	      //~ console.log(qte,new_stock,pos,pos2,pos3);
	      if (qte=="1"){
		new_stock=new_stock.substring(0,pos+1)+new_stock.substr(pos3+2);
	      } else {
		new_stock=new_stock.substring(0,pos2+1)+(parseInt(qte)-1)+new_stock.substr(pos3);
	      }
	      //~ console.log(taken_stock,"<",new_stock);
	    }
	  }
	  document.getElementById('mon_stock').value=new_stock.replace(/(^\s|\s$)/g,"");
	  update_stock();
	  return taken_stock;
	}
	
	update_stock();
	</script>
<!--Effets graphique et animations-->
	<script>
	var anim={};
	function shake(elem_id){
	  if (!(elem_id in anim)){
	    var elem=document.getElementById(elem_id);
	    anim[elem_id]=elem.className;
	    setTimeout(function(){
		elem.className=anim[elem_id]+" rotate_item_shake";
	      },0);
	    setTimeout(function(){
		elem.className=anim[elem_id];
	      },100);
	    setTimeout(function(){
		elem.className=anim[elem_id]+" rotate_item_shake";
	      },200);
	    setTimeout(function(){
		elem.className=anim[elem_id];
		delete anim[elem_id];
	      },300);
	  }
	}
	function hurt(elem_id){
	  if (!(elem_id in anim)){
	    var elem=document.getElementById(elem_id);
	    anim[elem_id]=elem.className;
	    setTimeout(function(){
		elem.className=anim[elem_id]+" rotate_item_hurt1";
	      },0);
	    setTimeout(function(){
		elem.className=anim[elem_id]+" rotate_item_hurt2";;
	      },100);
	    setTimeout(function(){
		elem.className=anim[elem_id]+" rotate_item_hurt3";
	      },200);
	    setTimeout(function(){
		elem.className=anim[elem_id]+" rotate_item_hurt4";
	      },300);
	    setTimeout(function(){
		elem.className=anim[elem_id]+" rotate_item_hurt5";
	      },400);
	    setTimeout(function(){
		elem.className=anim[elem_id];
		delete anim[elem_id];
	      },500);
	  }
	}
	function blink_data(elem_id,time1,class1,time2,class2,timeinterval){
	    if(current_interval>0){
	      unblink();
	    }
	    var elem=document.getElementById(elem_id);
	    var orig_class=elem.className;
	    //~ console.log(orig_class);
	    current_interval=setInterval(function (){
			  setTimeout(function(){
				elem.className=orig_class+((class1.length>0)?("( "+class1):"");
			    },time1);
			  setTimeout(function(){
				elem.className=orig_class+((class2.length>0)?("( "+class2):"");
			    },time2);
			},timeinterval);
	}
	function unblink(){
	    clearInterval(current_interval);
	    current_interval=0;
	}
	</script>
<!-- Drag and drop et deplacement des vues de résistance-->
	<script>
	var current_interval=0;
	function resitor_drag_from_input(ev,elem_input) {
	    if ((elem_input.value!="")&&(is_acceptable(elem_input.value))){
	      ev.dataTransfer.setData("text", elem_input.value);
	    }
	}
	function resitor_drag(ev) {
	    if (get_resistor_value()!=""){
	      ev.dataTransfer.setData("text", get_resistor_ref());
	    }
	}
	function drop_on_stock(ev) {
	    ev.preventDefault();
	    var data = ev.dataTransfer.getData("text");
	    //~ shake('resistor_img');
	    add_to_stock(data);
	    shake(data);
	}
	function allowDrop(ev) {
	    ev.preventDefault();
	}
      </script>
    </body>
</html>
