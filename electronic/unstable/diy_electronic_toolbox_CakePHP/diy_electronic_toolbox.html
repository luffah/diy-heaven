<!DOCTYPE html>
<html lang="fr" >
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="Electronic DIY toolbox fr" content=
  "Boite à outil pour la récupération de composants électroniques">
    <meta charset="utf-8"/>  <title>Electronic DIY toolbox fr"</title>
  <link rel="stylesheet" href="./webroot/css/base.css"/>  <link rel="stylesheet" href="./webroot/css/cssmenu1.css"/>  <style>

#menu .menu_lvl0{
    text-align:center;
    width:100%;
    max-width:80em;
}

#menu .menu_lvl1{
    top:0;left:0;
    margin:0;padding:0;
    text-transform: uppercase;
}

#menu .menu_lvl0 ul {
    width:100%;
}

#menu .menu_lvl0 li {
    width:25%;
}

#menu .menu_lvl1 li {
    width:100%;
}

#menu .menu_lvl0 li a {
    	-webkit-touch-callout:none;	-webkit-user-select:none;	-khtml-user-select:none;	-moz-user-select:none;	-ms-user-select:none;	user-select:none;;
}

@media screen and (max-width:480px) {
    #menu .longdesc{
        display:none;
    }
    #menu .shortdesc{
        display:inline;
    }
}

@media screen and (min-width:480px) {
    #menu .longdesc{
        display:inline;
    }
    #menu .shortdesc{
        display:none;
    }
}
</style>
<!--add style to element linked to menu_item 'resistor_decoder-->
<!--add style to element linked to menu_item 'block_stock_resistor-->
<link rel="stylesheet" href="./webroot/css/button_style.css"/>
<link rel="stylesheet" href="./webroot/css/electronic_toolbox/electronic_components.css"/>
<link rel="stylesheet" href="./webroot/css/electronic_toolbox/transform.css"/>
<link rel="stylesheet" href="./webroot/css/electronic_toolbox/electronic_component_decoder.css"/>

<!--add style to element linked to menu_item 'block_stock_capacitor-->





<!--add style to element linked to menu_item 'mini_calc-->
<!--add style to element linked to menu_item 'calc_combi_resistance-->
<!--add style to element linked to menu_item 'calcul_puissance-->
<!--add style to element linked to menu_item 'diviseur_tension-->
</head>
<body>
<nav id='menu'><div class='cssmenu menu_lvl0'>
<ul>
  <li id='menu_resistor_decoder'><a draggable='false' href='#'><span class='longdesc'>Ajout...</span><span class='shortdesc' title='Ajout...'>Ajout</span></a>
</li>
  <li id='menu_stock'><a draggable='false' href='#'><span class='longdesc'>Stock...</span><span class='shortdesc' title='Stock...'>Stock</span></a>
  <ul class=' menu_lvl1'>
    <li id='menu_block_stock_resistor'><a draggable='false'href='#'><span class='longdesc'>Mes résistances</span><span class='shortdesc' title='Mes résistances'>Résistances</span></a></li>
    <li id='menu_block_stock_capacitor'><a draggable='false'href='#'><span class='longdesc'>Mes condensateurs</span><span class='shortdesc' title='Mes condensateurs'>Condensateurs</span></a></li>
  </ul>
</li>
  <li id='menu_calcul'><a draggable='false' href='#'><span class='longdesc'>Calcul...</span><span class='shortdesc' title='Calcul...'>Calcul</span></a>
  <ul class=' menu_lvl1'>
    <li id='menu_mini_calc'><a draggable='false'href='#'><span class='longdesc'>Mini calculatrice</span><span class='shortdesc' title='Mini calculatrice'>Mini calc</span></a></li>
    <li id='menu_calc_combi_resistance'><a draggable='false'href='#'><span class='longdesc'>Combinaisons</span><span class='shortdesc' title='Combinaisons'>Combinaisons</span></a></li>
    <li id='menu_calcul_puissance'><a draggable='false'href='#'><span class='longdesc'>Puissance</span><span class='shortdesc' title='Puissance'>Puissance</span></a></li>
  </ul>
</li>
  <li id='menu_montages'><a draggable='false' href='#'><span class='longdesc'>Montages...</span><span class='shortdesc' title='Montages...'>Montages</span></a>
  <ul class=' menu_lvl1'>
    <li id='menu_diviseur_tension'><a draggable='false'href='#'><span class='longdesc'>Diviseur de<br>tension</span><span class='shortdesc' title='Diviseur de tension'>Div.tension</span></a></li>
  </ul>
</li>
</ul>
</div></nav><section><!--content displayed by menu 'menu'-->
  <article id='resistor_decoder' class='app'>
<article class='app' id='resistor_decoder'>
  <header>
    <h3>Lecture/déchiffrage</h3>
  </header>
  <section class='cadre'>
	 <section>
      <div class='resistor_desc' ondrop="dropText(event,get_resistance)"
      ondragover="allowDrop(event);">
      <label for='component_value' class='title'>Valeur :</label>
      <span type='text' id='component_value'>?</span>
      <button onclick='store_resistance()' id='stock_add_btn'
      class='button_disabled' title="Ajouter au stock" disabled
      >+</button>
      <p></p>
      <p><label for='component_desc_'>Desc.:</label> <span class=
      'view mixed_input'  id='component_desc'   onblur='get_resistance();' onkeydown=
      'run_get_resistance(event);'>
      [
      <input ondrop='event.preventDefault()' id='desc_v0' type='number' size=1 min=0 max=9/>,
      <input ondrop='event.preventDefault()' id='desc_v1' type='number' size=1 min=0 max=9/>,
      <input ondrop='event.preventDefault()' id='desc_v2' type='number' size=1 min=0 max=9/>,
      <input ondrop='event.preventDefault()' id='desc_mult' type='string' size=3/>,
      <input ondrop='event.preventDefault()' id='desc_tol' type='string' size=3/>,
      <input ondrop='event.preventDefault()' id='desc_pkg' type='string' size=4/>]
      
      </span></p>
    </div>
    </section>
    <section id='resistor_settings'>
      <article>
        <div class='resistor_mode_list'>
          <ul class='underlined'>
            <li class='title'>Package</li>
            <li id='PACKAGE_RING' name='PACKAGE'>
              <div class='' >
                <small>&mdash;<span id='resistor_body' class=
                'resistor_view cei_color_Beige'>&nbsp;<span
                id='border_view_value0'><span id='view_value0'></span></span
                ><span id='border_view_value1'><span id='view_value1'></span></span
				><span id='border_view_value2'><span id='view_value2'></span></span
				><span id='border_view_mult'><span id='view_mult'></span></span
				><span id='border_view_tol'><span id='view_tol'></span></span
				><span id='border_view_ppm'><span id='view_ppm'></span></span></span>&mdash;</small>
              </div>
            </li>
            <li id='PACKAGE_BOBINE' name='PACKAGE'>
              <div class='up_small_item'>
                o-<span class='power_resistor_view'
                >&nbsp;<span class='template_field text value'
                >R </span>&Omega; <span class='template_field text txtbody'
                >P&gt;1W</span>&nbsp;</span
                >-o
              </div>
            </li>
            <li id='PACKAGE_CERAMIC' name='PACKAGE'>
              <div class=
              'eletrolytic_pkg_view_cylinder ceramic_color_Brown down_small_item'>
              &nbsp;...&nbsp;
              </div>
              <div class=''>
                |&nbsp;|
              </div>
            </li>
            <li id='PACKAGE_PLASTIC' name='PACKAGE'>
              <div class='up_small_item'>
                <small class='plastic_pkg_view cei_color_Blue' 
                ondragover="event.preventDefault();"> &mu;....</small>
              </div>
            </li><!--
electrolytic capacitor
-->
            <li id='PACKAGE_ELECTROLYTIC' name='PACKAGE'>
              <div class='up_big_item'>
                <div class='rotate_item_unvertical'>
                  <span><span><span class=
                  'eletrolytic_pkg_view_cylinder cei_color_Black'><small>
                  <span class=
                  'eletrolytic_pkg_view_round cei_color_Silver'>&nbsp;&nbsp;&nbsp;</span><strong>===</strong></small></span></span></span>
                </div>
              </div>
              <div class=''>
                ||
              </div>
            </li>
          </ul>
        </div>
        <div id='pkg_color' class='resistor_mode_list'>
          <ul>
            <li class='title'>Couleur</li>
            <li id="RESISTOR_CARBON" name='PKG_COLOR' >C (res 0,5W)</li>
            <li id="RESISTOR_METAL_BLUE" name='PKG_COLOR'>B (res 0,4W)</li>
            <li id="RESISTOR_METAL_GREEN" name='PKG_COLOR'>G (res 0,4W)</li>
            <li id="RESISTOR_METAL_RED" name='PKG_COLOR'>R (res 1W)</li>
            <li id="CAPACITOR_PINK" name='PKG_COLOR'>P (cap)</li>
            <li id="CAPACITOR_GREEN" name='PKG_COLOR'>G (cap)</li>
          </ul>
        </div>
        <div id='nb_ring' class='resistor_mode_list' title="Nombre d'anneaux"></div>
      </article>
     <article>
     <div class='cei_color_block'>
        <div class='resistor_prop_title'>
          Valeur
        </div>
        <div id='value0' class='resistor_value_selector'></div>
        <div id='value1' class='resistor_value_selector'></div>
        <div id='value2' class='resistor_value_selector'></div>
     </div>
     <div class='cei_color_block'>
      	  <div class='resistor_prop_title'>
              Multiple
          </div>
          <div id='mult' class='resistor_value_selector'></div>
      </div>
      <div class='cei_color_block'>
          <div class='resistor_prop_title'>
              Tolérance<br><span class='info'>(en %)</span>
          </div>
          <div id='tol' class='resistor_value_selector'>
          </div>
      </div>
      <div class='cei_color_block'>
         <div class='resistor_prop_title'>
				Charge<br>admissible<br><span class='info'>(en W)</span>
		 </div>
         <div id='pow' class='resistor_value_selector'>
         </div>
      </div>
      
      <ul class='cei_color_list font-small resistor_value_selector'
      id='ppm'>
        <li >
          <div class='resistor_prop_title'>Coef.temp.</div>
        </li>
        <li class='cei_color_Black' onclick=
        'ppm_set(200,"cei_color_Black")'>200ppm</li>
        <li class='cei_color_Brown' onclick=
        'ppm_set(100,"cei_color_Brown")'>100ppm</li>
        <li class='cei_color_Red' onclick=
        'ppm_set(50,"cei_color_Red")'>50ppm</li>
        <li class='cei_color_Orange' onclick=
        'ppm_set(15,"cei_color_Orange")'>15ppm</li>
        <li class='cei_color_Yellow' onclick=
        'ppm_set(25,"cei_color_Yellow")'>25ppm</li>
      </ul>
      </article>
    </section>
  </section>
</article>

  </article>
  <article id='block_stock_resistor' class='app'>

		<section id='stock_view_resistor' ></section>
		<section class='block_stock'>
			<div class='title'>
			  <label for="my_stock_resistor">Stock de résistances <small>(en Ohm, séparées par des espaces)</small>:<br></label>
			</div>
			<form>
			  <textarea  id="my_stock_resistor"
			  title="Aide : les notations m=e-3 k=e3 M=e6 sont reconnues par ce programme"
			   rows="4" cols=
			  "50"></textarea>
			</form>
		</section>

  </article>
  <article id='block_stock_capacitor' class='app'>

		<section id='stock_view_capacitor' ></section>
		<section class='block_stock'>
			<div class='title'>
			  <label for="my_stock_capacitor">Stock de condensateurs <small>(en Farad, séparées par des espaces)</small>:<br></label>
			</div>
			<form>
			  <textarea  id="my_stock_capacitor"
			  title="Aide : les notations u=e-6 n=e-9 p=e-12  sont reconnues par ce programme"
			   rows="4" cols=
			  "50"></textarea>
			</form>
		</section>

  </article>
  <article id='mini_calc' class='app'>
<article class='app' id="mini_calc">
  <header>
    <h3>Mini calculatrice</h3>
  </header>
  <section class='block_form0'>
    <p class="info">Opérateurs : ( R1 <strong>+</strong> R2 )
    &rarr; composants en série; ( R1 <strong>//</strong> R2 )
    &rarr; composants en parallèle.</p>
    <p class="info">Grandeurs : <strong>p</strong>ico(10^-12);
    <strong>n</strong>ano(10^-9); <strong>u</strong>:micro(10^-6);
    <strong>m</strong>illi(10^-3); <strong>k</strong>ilo(10^3);
    <strong>M</strong>ega(10^-6)</p>
    <div>
      Résistance &mdash;[/\/\/]- <span><input type="text" value=""
      name="calc_in_resistance" id="calc_in_resistance" size="20"
      onchange="mini_calc_resistance()" placeholder=
      "r // ( ((a+b)*(a-b)) / c )"></span>=<span id=
      "calc_out_resistance"></span> Ohm
    </div>
    <div>
      Capacitance &mdash;| |&mdash; <span><input type="text" value=
      "" name="calc_in_capacitance" id="calc_in_capacitance" size=
      "20" onchange="mini_calc_capacitance()" placeholder=
      "r // ( ((a+b)*(a-b)) / c )"></span>=<span id=
      "calc_out_capacitance"></span> Farad
    </div>
  </section>
</article>
  </article>
  <article id='calc_combi_resistance' class='app'>
  </article>
  <article id='calcul_puissance' class='app'>
<article class='app' id="calcul_puissance">
  <header>
    <h3>Vérification de puissance</h3>
  </header>
  <section class='block_form0 cadre'>
    <form>
      <label for="resistance_link">Résistance</label><input size=
      "8" name="resistance" id="resistance_link"> <label for=
      "tension">Tension aux bornes<small>(en Volt)</small></label>
      <input size="6" value="9" name="tension" id="tension">
      <label for="puissance">Puissance à dissiper<small>(en
      Watt)</small></label> <input size="6" value="" name=
      "puissance" id="puissance" disabled> <button onclick=
      "calcul_puissance();return false;" title=
      "Vérifier la puissance">Calculer !</button>
    </form><span><small id="indication_puissance"></small></span>
  </section>
</article>

  </article>
  <article id='diviseur_tension' class='app'>
  </article>
</section>
</body>
<script src="./webroot/js/lib/lib_html.js"></script>
<script src="./webroot/js/JSMenu.js"></script>
<!--add event to element linked to menu_item 'resistor_decoder-->

<script src="./webroot/js/lib/lib_js.js"></script>
<script src="./webroot/js/lib/lib_unittest.js"></script>
<script src="./webroot/js/lib/lib_unitconv.js"></script>
<script src="./webroot/js/lib/lib_calc.js"></script>
<script src="./webroot/js/electronic_toolbox/lib_cei_colors.js"></script>
<script src="./webroot/js/electronic_toolbox/model/lib_component_desc.js"></script>
<script>
var my_component=new ComponentDesc();
function store_resistance() {
	t=PKG_CHAR_TO_ID[my_component.package];
	if (updateComponentValueView(true)) {
		shake(t);
		updateStock();
		shake(my_component.getRef());
	} else {
		hurt(t);
	}
}
function get_resistance(desc) {
	if (!(desc != null )){ 
		desc='['+
		htElem('desc_v0').value+','+
		htElem('desc_v1').value+','+
		htElem('desc_v2').value+','+
		htElem('desc_mult').value+','+
		htElem('desc_tol').value+','+
		htElem('desc_pkg').value+']';
	}
	var tab_desc=get_tab_desc_in_desc(desc);
	if (tab_desc.length>=5) {
		val_set(0,tab_desc[0]);
		val_set(1,tab_desc[1]);
		val_set(2,tab_desc[2]);
		mult_set(tab_desc[3]);
		tolerance_set(tab_desc[4]);
		if(/[wW]$/.test(tab_desc[5])){
			package_set('PACKAGE_BOBINE');
			pow_set(tab_desc[5].replace(/[wW]/,''));
		} else if (/[A-Z]/.test(tab_desc[5])){
			package_set('PACKAGE_RING');
			corps_set(PKG_COLOR_CHAR_TO_ID[tab_desc[5]]);
		} else if (/c/.test(tab_desc[5])){
			package_set('PACKAGE_CERAMIC');
		} else if (/e/.test(tab_desc[5])){
			package_set('PACKAGE_ELECTROLYTIC');
		}
		if(my_component.mode==''){
			my_component.autosetMode();
			mode_set(my_component.mode);//imply update value and delete useless values
		}
	} else {
		alert("Format de référence non reconnu");
	}
}
function run_get_resistance(event) {
	if (event.which == 13 || event.keyCode == 13) {
		get_resistance();
		return false;
	}
	return true;
}
function format_component_value_with_tolerance(val,lettre,unite) {
	if (my_component.tolerance > 0) {
		var tol=val*my_component.tolerance;
		val=formatUnit(val-tol) + ' <small>'+ unite +
		'</small> &le; ' + lettre +' &le; '+
		formatUnit(val+tol) +' <small>'+unite+'</small>';
	}
	else{
		val=lettre + '= ' +formatUnit(val) +' <small>'+ unite+'</small>';
	}
	return val;
}
function updateComponentValueView(do_store) {
	var desc=my_component.getDesc();
	var complete=my_component.isComplete();
	var measure_and_unit=my_component.getMeasureAndUnit();
	var component_stock_text=(my_component.type=='CAPACITOR')?'my_stock_capacitor':
	'my_stock_resistor';
	
	var add_btn_id='stock_add_btn';
	var add_btn_disabled_class='button_disabled';
	var val;
	htElem('component_desc').value=desc;
	if ( complete && do_store) {
		val=my_component.getRef();
		if (isValidStockFormat(val)) {
			htElem(component_stock_text).value=htElem(component_stock_text).value.concat(" ",val);
			return true;
		}
	} else {
		val=my_component.getValue();
		htElem('component_value').innerHTML=( val != "" )?(
			format_component_value_with_tolerance(val,measure_and_unit[0],measure_and_unit[1])):"?";
		htElem(add_btn_id).disabled=( !complete );
		htElem(add_btn_id).className=complete?'':add_btn_disabled_class;
	}
	return false;
}
function mode_to_view(val){
	var prereq={};
	var pim=PKG_ID_TO_MODE;
	var nb=pim['PACKAGE_RING'];
	prereq['mult']=true;
	prereq['tol']=true;
	prereq['nb_ring']=(val>=nb);
	prereq['pkg_color']=(val>=nb); 
	prereq['value0']=true; 
	prereq['value1']=((val>=(nb+1))||(val<nb));
	prereq['value2']=((val>=(nb+2))||(val<nb) && (val!=pim['PACKAGE_CERAMIC'])&& (val!=pim['PACKAGE_PLASTIC']));
	prereq['ppm']=(val>=(nb+3));
	prereq['pow']=(val==pim['PACKAGE_BOBINE']);
	prereq['view_ppm']=(val>=(nb+3));
	return prereq;
}
function mode_set(val) {
	my_component.setMode(val);
	var prereq=mode_to_view(val);
	for (var k in prereq){
		setVisible(k,prereq[k]);
	}
	if (prereq['nb_ring']) {
		if (my_component.type=='CAPACITOR'){
			corps_set('CAPACITOR_PINK');
		} else {
			corps_set('RESISTOR_CARBON');
		}	
		if (!(prereq['ppm'])) {	setClass('view_ppm',"cei_color_None");
			if (!(prereq['value2'])) {	setClass('view_value2',"cei_color_None");
				my_component.setValue(2,'');
				if (!(prereq["value1"])) {	setClass('view_value1',"cei_color_None");
					my_component.setValue(1,'');
				}
			}
		}
		val=val-PKG_ID_TO_MODE['PACKAGE_RING']+3;
		switchClass(['NBANNEAUX'+val],'active',last_button['NBANNEAUX']);
		last_button['NBANNEAUX'][0]='NBANNEAUX'+val;
	}
	updateComponentValueView();
}
function val_set(n,val){
	if (val!=null){
		var new_last_button=[];
		setClass('view_value'+n, color_tab_val[val]);
		setInputValue('desc_v'+n,val);
		if (my_component.package===PKG_ID_TO_CHAR.PACKAGE_RING) {
			if (my_component.mode < (PKG_ID_TO_MODE.PACKAGE_RING + n)) {
				mode_set(PKG_ID_TO_MODE.PACKAGE_RING + n);
			}
		}
		my_component.setValue(n,val);
		if ( (val + "") != "" ){
			new_last_button[0]='VAL'+n+'_'+val;
		}
		switchClass(new_last_button,'active',last_button['VAL'+n]);
		last_button['VAL'+n]=new_last_button;
		updateComponentValueView();
	}
}
function mult_set(val) {
	if (val!=null){
		setClass('view_mult',color_tab_mult[val]);
		setInputValue('desc_mult',val);
		my_component.setMult(val);
		switchClass(['MULT'+val],'active',last_button['MULT']);
		last_button['MULT'][0]='MULT'+val;
		updateComponentValueView();
	}
}
function tolerance_set(val) {
	if (val!=null){
		setClass('view_tol',color_tab_tolerance[val]);
		setInputValue('desc_tol',val);
		my_component.setTolerance(val);
		switchClass(['TOLERANCE'+val],'active',last_button['TOLERANCE']);
		last_button['TOLERANCE'][0]='TOLERANCE'+val;
		updateComponentValueView();
	}
}
function pow_set(val) {
	if (val!=null){
		my_component.setPower(val+'W');
		setInputValue('desc_pkg',val+'W');
		var tmpid='POW'+val;
		switchClass([tmpid],'active',last_button['POW']);
		last_button['POW'][0]=tmpid;
		updateComponentValueView();
	}
}
function package_set(val) {
	if (val!=null){
		my_component.setPackage(PKG_ID_TO_CHAR[val]);
		translateContents('MULT',PKG_ID_TO_CONTENTS_MULT[val]);
		if (val=='PACKAGE_RING') {
			mode_set(PKG_ID_TO_MODE[val]+
				(my_component.value[1]+""+my_component.value[2]).length);
		} else {
			mode_set(PKG_ID_TO_MODE[val]);
			my_component.setType(PKG_ID_TO_TYPE_DEF[val]);
			my_component.setCorps(PKG_ID_TO_CHAR[val]);
			if (val!='PACKAGE_BOBINE') {
				setInputValue('desc_pkg',PKG_ID_TO_CHAR[val]);
			}
		}
		switchClass([val],'active',last_button['PACKAGE']);
		last_button['PACKAGE'][0]=val;
		updateComponentValueView();
	}
}
function corps_set(val) {
	if (val!=null){
		htElem('resistor_body').className="resistor_view "+color_tab_corps[val];
		my_component.setType(val.match(/^(CAPACITOR|RESISTOR)/)[0]);
		my_component.setCorps(PKG_COLOR_ID_TO_CHAR[val]);
		setInputValue('desc_pkg',PKG_COLOR_ID_TO_CHAR[val]);
		switchClass([val],'active',last_button['PKG_COLOR']);
		last_button['PKG_COLOR'][0]=val;
		updateComponentValueView();
	}
}
function ppm_set(val,view_class) {
	if (val!=null){
		htElem('view_ppm').className=view_class;
	}
}
function init_decoder_tool() {
	var elems;
	var elem;
	var val;
	var tab_fill;
	var i, j, k, val;
	tab_fill=['value0','value1','value2','mult','tol','ppm']
	for (i=0, length = tab_fill.length; i<length; i++){
		//~ console.log(tab_fill[i]);
		elem=htElem(tab_fill[i]);
		htSetClassOnEvents(elem,'border_view_'+tab_fill[i],
			{onmouseover:'resistor_blink_val',onmouseout:'resistor_blink_val_hidden'});	
		elem=htElem('border_view_'+tab_fill[i]);
		elem.className='resistor_blink_val_hidden';
		htSetHover(elem,tab_fill[i],"{parent:'highlight'}");		
		setClass('view_'+tab_fill[i],'cei_color_None');
		setInnerHTML('view_'+tab_fill[i],'&nbsp;');
	}
	elems=document.getElementsByName('PKG_COLOR');
	last_button['PKG_COLOR']=[];
	for (i = 0, length = elems.length; i < length; i++) {
		elems[i].className=color_tab_corps[elems[i].id];
		elems[i].setAttribute('onClick','corps_set("'+elems[i].id+'")');
	}
	elems=document.getElementsByName('PACKAGE');
	last_button['PACKAGE']=[];
	for (i = 0, length = elems.length; i < length; i++) {
		elems[i].setAttribute('onClick','package_set("'+elems[i].id+'")');
	}
	
	last_button['NBANNEAUX']=[];
	htElem('nb_ring').innerHTML=htmlMatrix(
		[['title',3,4,5,6]],
		'ul',
		{ 	title : '<li class="title">'+htElem('nb_ring').title+'</li>',
			default : function(elt){
				return '<li id="NBANNEAUX'+elt+'" onClick="mode_set('+
				(PKG_ID_TO_MODE['PACKAGE_RING']+(elt-3))+')" >'+ elt+'</li> ';
				
			}
		}
		);
	
	
	last_button['MULT']=[];
	htElem('mult').innerHTML=htmlMatrix(
		[[0,1,4,7,],[-1,2,5,'x'],[-2,3,6,'x']],
		'ul',
		{ x:'<li onClick="mult_set(1)">&nbsp;</li>',
			default : function(elt){
				var val=Math.pow(10,elt);
				return '<li class="'+color_tab_mult[val]+
				'" id="MULT'+val+
				'" onClick="mult_set('+val+')" title="x'+formatUnit(val)+'" >'+
				elt+'</li> ';
			}
		}
		);
	last_button['TOLERANCE']=[];
	htElem('tol').innerHTML=htmlMatrix(
		[[0.01,0.001,0.05],[0.02,0.0025,0.1],[0,0.005,0.2]],
		'ul',
		{ 0:'<li id="TOLERANCE0" onClick="tolerance_set(0)">&nbsp;</li>',
			default : function(elt){
				return '<li id="TOLERANCE'+elt+
				'" class="'+color_tab_tolerance[elt] +
				'" onClick="tolerance_set('+elt+')">&nbsp;'+ 
				((elt*100)+"").replace(/0(\.[0-9][0-9])/,function(a,b){return b;}) +
				'&nbsp;</li> ';
			}
		}
		);
	last_button['POW']=[];
	htElem('pow').innerHTML=htmlMatrix(
		[[1,2,2.5,3,4],[5,7,11,12,20],[25,30,50,90,100],[180,250,300]],
		'ul',
		{ x:'<li>&nbsp;</li>',
			default : function(elt){
				return '<li id="POW'+elt+'" onClick="pow_set('+elt+')">'+elt+'</li>';
			}
		}
		);
	
 	for (var j=0 ; j<3 ; j++ ){
		last_button['VAL'+j]=[];
		
		htElem('value'+j).innerHTML=htmlMatrix(
			[[0,1,4,7,],['x',2,5,8],['x',3,6,9]],
			'ul',
			{ x: ('<li onClick="val_set('+j+",''"+')">&nbsp;</li>'),
				default : function(elt){
					return '<li class="'+color_tab_val[elt]+
					'"id="VAL'+j+'_'+elt+
					'" onClick="val_set('+j+','+elt+')">'+
					elt+'</li> ';
				}
			});
	}
	package_set('PACKAGE_RING');
}
//memory for last activated buttons
var last_button={};
//init graphical elements
init_decoder_tool();
</script>
<!--add event to element linked to menu_item 'block_stock_resistor-->
<script src="./webroot/js/lib/lib_anim.js"></script>
<script src="./webroot/js/electronic_toolbox/controller/lib_stock_combine.js"></script>
<script src="./webroot/js/electronic_toolbox/view/lib_component_view.js"></script>
<script src="./webroot/js/electronic_toolbox/view/lib_stock_view.js"></script>
<script>

addEventListener('my_stock_resistor', 'keyup',
	function (event) {
		declareInputChanged();
	});
addEventListener('my_stock_resistor', 'drop',
	function (event) {
		add_to_stock(event.dataTransfer.getData('text'))
	});
addEventListener('my_stock_resistor','dragover',
	function (event) {
		allowDrop(event);
	});
addEventListener('my_stock_resistor', 'mouseout',
	function (event) {
		updateStock(); is_valid_stock(this);
	});
addEventListener('my_stock_resistor', 'blur',
	function (event) {
		updateStock(); is_valid_stock(this);
	});
addEventListener('stock_view_resistor', 'drop',
	function (event) {
		dropOnStock(event);
	});
addEventListener('stock_view_resistor', 'drop',
	function (event) {
		dropOnStock(event);
		
	});
addEventListener('stock_view_resistor', 'dragover',
	function (event) {
		allowDrop(event);
	});
addClass('stock_view_resistor', "droppable");
</script>


<!--add event to element linked to menu_item 'block_stock_capacitor-->
<script>

addEventListener('my_stock_capacitor', 'keyup',
	function (event) {
		declareInputChanged();
	});
addEventListener('my_stock_capacitor', 'drop',
	function (event) {
		add_to_stock(event.dataTransfer.getData('text'))
	});
addEventListener('my_stock_capacitor','dragover',
	function (event) {
		allowDrop(event);
	});
addEventListener('my_stock_capacitor', 'mouseout',
	function (event) {
		updateStock(); is_valid_stock(this);
	});
addEventListener('my_stock_capacitor', 'blur',
	function (event) {
		updateStock(); is_valid_stock(this);
	});
addEventListener('stock_view_capacitor', 'drop',
	function (event) {
		dropOnStock(event);
	});
addEventListener('stock_view_capacitor', 'drop',
	function (event) {
		dropOnStock(event);
		
	});
addEventListener('stock_view_capacitor', 'dragover',
	function (event) {
		allowDrop(event);
	});
addClass('stock_view_capacitor', "droppable");
</script>


<!--add event to element linked to menu_item 'mini_calc-->
<script>
function mini_calc_resistance() {
	var user_input=document.getElementById('calc_in_resistance').value.replace(
	/[abcdfghijloqrstvwxyzABCDEFGHIJKLNOPQRSTUVWXYZ]+[a-zA-Z]*/g,'');
	document.getElementById('calc_out_resistance').innerHTML=formatUnit(
	parseAndCompute(user_input,combine_resistance),true);
}
function mini_calc_capacitance() {
	var user_input=document.getElementById('calc_in_capacitance').value.replace(
	/[abcdfghijloqrstvwxyzABCDEFGHIJKLNOPQRSTUVWXYZ]+[a-zA-Z]*/g,'');
	while (/(e[0-9]+)([^Mkmnup]|$)/.test(user_input)) { // unite standard : picofarad
		user_input=user_input.replace(/(^|[^0-9])([0-9]+e[0-9]+)([^Mkmnup]|$)/g,
		function (a,b,c,d) {
			return b + c + "p" + d;
		});
	}
	document.getElementById('calc_out_capacitance').innerHTML=formatUnit(
	parseAndCompute(user_input,combine_capacitance),true);
}
</script>
<!--add event to element linked to menu_item 'calc_combi_resistance-->
<!--add event to element linked to menu_item 'calcul_puissance-->
<script>
htElem('resistance_link').value=htElem('resistance').value;

function calcul_puissance() {
	setTimeout(function(){
		do_calcul_puissance();
	},0);
}

function do_calcul_puissance() {
	var v_U=parseUnit(htElem('tension').value);
	var v_R=parseUnit(htElem('resistance_link').value);
	var v_P=(v_U*v_U)/v_R;
	var msg="ndef";
	if (v_P>=1) {
		msg="Attention : seul des resistances de puissance".concat(((v_P>=3)?" bobinées ":" "),"peuvent supporter plus de ",((v_P>=3)?3:1), "W !");
	} else if (v_P>=0.5) {
		msg="Attention : il faut utiliser des résistances haute tension ou des résistances de puissance pour supporter plus de 0,5W !";
	} else {
		msg="Note : les résistances métalliques (bleu ou vert) génèrent moins de bruit que des résistances carbone (marron).";
	}
	htElem('puissance').value=Math.round(v_P*1000)/1000;
	htElem('indication_puissance').innerHTML=msg;
}

</script>
<!--add event to element linked to menu_item 'diviseur_tension-->
<script>
// set view switching (based on the id of the HTML block) on clicks events 
jsmenu_event_add_batch(
		{"menu_stock":true,"menu_calcul":true,"menu_montages":true},
		{
			dragover:jsmenu_show
		}, function (menu_item_id,unused){}
)
jsmenu_event_add_batch(
		{"menu_resistor_decoder":"resistor_decoder","menu_block_stock_resistor":"block_stock_resistor","menu_block_stock_capacitor":"block_stock_capacitor","menu_mini_calc":"mini_calc","menu_calc_combi_resistance":"calc_combi_resistance","menu_calcul_puissance":"calcul_puissance","menu_diviseur_tension":"diviseur_tension"},
		{
			click:jsmenu_switch,
			dragover:jsmenu_switch
		}, function (menu_item_id,div_id){
			setDisplay(div_id,'none');
		}
)
</script>

<script src="./webroot/js/testing/buttons.js"></script>
</html>

